<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Collada.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">loaders</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">animators</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">animators</span>.<span class="ActionScriptDefault_Text">bones</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">arcane</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">containers</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">loaders</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">loaders</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;
    
    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;
    
    <span class="ActionScriptASDoc">/**
    * File loader for the Collada file format with animation.
    */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">Collada</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AbstractParser</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">animationLibrary</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AnimationLibrary</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channelLibrary</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelLibrary</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">symbolLibrary</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_face</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Face</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_moveVector</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_geometryArray</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_geometryArrayLength</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_channelArray</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_channelArrayLength</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_defaultAnimationClip</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AnimationData</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_haveClips</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_containers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_skinControllers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">SkinController</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">SkinController</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_skinController</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SkinController</span>;
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bothsides</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">useIDAsName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">buildContainers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">containerData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ContainerData</span>, <span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ObjectContainer3D</span>, <span class="ActionScriptDefault_Text">depth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">spaces</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0 ; <span class="ActionScriptDefault_Text">s</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">depth</span> ; <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">spaces</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot; &quot;</span>;
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; + Build Container : &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">spaces</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">containerData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_objectData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ObjectData</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">containerData</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">BoneData</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_boneData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BoneData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">BoneData</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bone</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Bone</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Bone</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">bone</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_boneData</span>.<span class="ActionScriptDefault_Text">name</span>;
                    <span class="ActionScriptDefault_Text">_boneData</span>.<span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bone</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span>;
                    
                    <span class="ActionScriptDefault_Text">_containers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">bone</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bone</span>;
                    
                    <span class="ActionScriptComment">//ColladaMaya 3.05B
</span>                    <span class="ActionScriptDefault_Text">bone</span>.<span class="ActionScriptDefault_Text">boneId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_boneData</span>.<span class="ActionScriptDefault_Text">id</span>;
                    
                    <span class="ActionScriptDefault_Text">bone</span>.<span class="ActionScriptDefault_Text">transform</span>.<span class="ActionScriptDefault_Text">matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_boneData</span>.<span class="ActionScriptDefault_Text">transform</span>;
                    
                    <span class="ActionScriptDefault_Text">bone</span>.<span class="ActionScriptDefault_Text">joint</span>.<span class="ActionScriptDefault_Text">transform</span>.<span class="ActionScriptDefault_Text">matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_boneData</span>.<span class="ActionScriptDefault_Text">jointTransform</span>;
                    
                    <span class="ActionScriptDefault_Text">buildContainers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_boneData</span>, <span class="ActionScriptDefault_Text">bone</span>.<span class="ActionScriptDefault_Text">joint</span>, <span class="ActionScriptDefault_Text">depth</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bone</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_containerData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ContainerData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ContainerData</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">objectContainer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ObjectContainer3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">name</span>;
                    
                    <span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">transform</span>.<span class="ActionScriptDefault_Text">matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">transform</span>;
                    
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptBracket/Brace">)</span>    <span class="ActionScriptComment">// The container is also mesh
</span>                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">fillMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">objectContainer</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Mesh</span>, <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MeshData</span>, <span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_containers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectContainer</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptDefault_Text">_containers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectContainer</span>;
                    
                    <span class="ActionScriptDefault_Text">buildContainers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_containerData</span>, <span class="ActionScriptDefault_Text">objectContainer</span>, <span class="ActionScriptDefault_Text">depth</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    
                    <span class="ActionScriptComment">//TODO: set bounding values (max/min) on _containerData objects
</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerMeshes</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">children</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">//center children in container for better bounding radius calulations
</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">children</span>.<span class="ActionScriptDefault_Text">length</span>;
                        <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">minX</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;
                        <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">minY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;
                        <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_containerData</span>.<span class="ActionScriptDefault_Text">minZ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;
                        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">x</span>;
                            <span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">y</span>;
                            <span class="ActionScriptDefault_Text">objectContainer</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">z</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptComment">//objectContainer.transform.matrix3D.appendTranslation(_moveVector.x, _moveVector.y, _moveVector.z);
</span>                        <span class="ActionScriptComment">//_moveVector = objectContainer.transform.matrix3D.transformVector(_moveVector);
</span>                        <span class="ActionScriptComment">//objectContainer.x += _moveVector.x;
</span>                        <span class="ActionScriptComment">//objectContainer.y += _moveVector.y;
</span>                        <span class="ActionScriptComment">//objectContainer.z += _moveVector.z;
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">objectContainer</span><span class="ActionScriptBracket/Brace">)</span>;
                    
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Mesh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">buildMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MeshData</span>, <span class="ActionScriptDefault_Text">parent</span>, <span class="ActionScriptDefault_Text">depth</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_containers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>;

                    <span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">buildMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_meshData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MeshData</span>, <span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ObjectContainer3D</span>, <span class="ActionScriptDefault_Text">depth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Mesh</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">spaces</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;&quot;</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0 ; <span class="ActionScriptDefault_Text">s</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">depth</span> ; <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">spaces</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptString">&quot; &quot;</span>;
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; + Build Mesh      : &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">spaces</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Mesh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Mesh</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">fillMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span>, <span class="ActionScriptDefault_Text">_meshData</span>, <span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mesh</span>;
        <span class="ActionScriptBracket/Brace">}</span>
                
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">fillMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Mesh</span>, <span class="ActionScriptDefault_Text">_meshData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MeshData</span>, <span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">name</span>;
            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">transform</span>.<span class="ActionScriptDefault_Text">matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">transform</span>;
            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">bothsides</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">bothsides</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_geometryData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">GeometryData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">geometry</span>;
            
            <span class="ActionScriptComment">//set materialdata for each face
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_faceData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FaceData</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_meshMaterialData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MeshMaterialData</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">materials</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_faceListIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_meshMaterialData</span>.<span class="ActionScriptDefault_Text">faceList</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_faceData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_faceListIndex</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">FaceData</span>;
                    <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">materialData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">symbolLibrary</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_meshMaterialData</span>.<span class="ActionScriptDefault_Text">symbol</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//set skincontrollers parent value
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_skinController</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SkinController</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">skinControllers</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_skinController</span>.<span class="ActionScriptDefault_Text">parent</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parent</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialData</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i0</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">uvtData</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_faceData</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//set face materials
</span>                <span class="ActionScriptDefault_Text">_materialData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">materialData</span>;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_faceMaterials</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//set vertices
</span>                <span class="ActionScriptDefault_Text">i0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">v0</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i0</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i0</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i0</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">buildSkinVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>, <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">v0</span>, <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">buildSkinVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>, <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">v1</span>, <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">buildSkinVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>, <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">v2</span>, <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//set uvData
</span>                <span class="ActionScriptDefault_Text">i0</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">uv0</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">uv1</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_faceData</span>.<span class="ActionScriptDefault_Text">uv2</span><span class="ActionScriptOperator">*</span>3;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i0</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i0</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i0</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">])</span>;
                
                <span class="ActionScriptComment">//set indices
</span>                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_indices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>, <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span>, <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//set facelengths
</span>                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_faceLengths</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//store mesh material reference for later setting by the materialLibrary
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialData</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">meshes</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">buildFaces</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptComment">//store element material reference for later setting by the materialLibrary
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_face</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_faces</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_materialData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">faces</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_face</span>.<span class="ActionScriptDefault_Text">faceIndex</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">materialData</span><span class="ActionScriptBracket/Brace">))</span>
                    <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">faces</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_face</span><span class="ActionScriptBracket/Brace">)</span>;
                    
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerMeshes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">/</span>3;
                <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">minX</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;
                <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">minY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;
                <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">minZ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;
                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">x</span>;
                    <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">y</span>;
                    <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">z</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">transform</span>.<span class="ActionScriptDefault_Text">matrix3D</span>.<span class="ActionScriptDefault_Text">appendTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;.Collada&quot;</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">buildSkinVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">GeometryData</span>, <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">skinVertices</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">skinController</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SkinController</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">skinVertex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SkinVertex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">skinVertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptDefault_Text">skinVertex</span>.<span class="ActionScriptDefault_Text">updateVertices</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 3, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skinController</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">skinControllers</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">skinController</span>.<span class="ActionScriptDefault_Text">skinVertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skinVertex</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">buildAnimations</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bone</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Bone</span>;
            
            <span class="ActionScriptComment">//hook up bones to skincontrollers
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_skinController</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_skinControllers</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">bone</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">getBoneByName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_skinController</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bone</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_skinController</span>.<span class="ActionScriptDefault_Text">joint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bone</span>.<span class="ActionScriptDefault_Text">joint</span>;
                    <span class="ActionScriptDefault_Text">_skinController</span>.<span class="ActionScriptDefault_Text">update</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScriptDefault_Text">warning</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;no joint found for &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_skinController</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptBracket/Brace">}</span>
               
               <span class="ActionScriptComment">//process animations
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_animationData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AnimationData</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">animationLibrary</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">animationType</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">AnimationData</span>.<span class="ActionScriptDefault_Text">SKIN_ANIMATION</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">animation</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BonesAnimator</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BonesAnimator</span><span class="ActionScriptBracket/Brace">()</span>;
                        
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_skinController</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_skinControllers</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">animation</span>.<span class="ActionScriptDefault_Text">addSkinController</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_skinController</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rZ</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sZ</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                        
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channelData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelData</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">channels</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Channel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">channel</span>;
                            
                            <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_containers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span>;
                            <span class="ActionScriptDefault_Text">animation</span>.<span class="ActionScriptDefault_Text">addChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptBracket/Brace">)</span>;
                            
                            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">times</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span>;
                            
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>
                                <span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                            
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">times</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">])</span>
                                <span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">times</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 1<span class="ActionScriptBracket/Brace">]</span>;
                            
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">Bone</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;jointRotationX&quot;</span>;
                                <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;jointRotationY&quot;</span>;
                                <span class="ActionScriptDefault_Text">rZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;jointRotationZ&quot;</span>;
                                <span class="ActionScriptDefault_Text">sX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;jointScaleX&quot;</span>;
                                <span class="ActionScriptDefault_Text">sY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;jointScaleY&quot;</span>;
                                <span class="ActionScriptDefault_Text">sZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;jointScaleZ&quot;</span>;
                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;rotationX&quot;</span>;
                                <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;rotationY&quot;</span>;
                                <span class="ActionScriptDefault_Text">rZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;rotationZ&quot;</span>;
                                <span class="ActionScriptDefault_Text">sX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;scaleX&quot;</span>;
                                <span class="ActionScriptDefault_Text">sY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;scaleY&quot;</span>;
                                <span class="ActionScriptDefault_Text">sZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;scaleZ&quot;</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            
                            <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translateX&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translationX&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;transform(3)(0)&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;x&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span>
                                            <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">scaling</span>;
                                    <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span>
                                            <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">scaling</span>;
                                    <span class="ActionScriptBracket/Brace">}</span>
                                    <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translateY&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translationY&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;transform(3)(1)&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;y&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;z&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                    
                                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">scaling</span>;
                                     <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translateZ&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translationZ&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;transform(3)(2)&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;z&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;y&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                    
                                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">scaling</span>;
                                     <span class="ActionScriptReserved">break</span>;
                                 <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;jointOrientX&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotateXANGLE&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotateX&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;RotX&quot;</span><span class="ActionScriptOperator">:</span>
                                     <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rX</span><span class="ActionScriptBracket/Brace">]</span>;
                                     
                                     <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span>
                                            <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span>1;
                                     <span class="ActionScriptReserved">break</span>;
                                 <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;jointOrientY&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotateYANGLE&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotateY&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;RotY&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rY</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rZ</span><span class="ActionScriptBracket/Brace">]</span>;
                                    
                                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span>1;
                                     <span class="ActionScriptReserved">break</span>;
                                 <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;jointOrientZ&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotateZANGLE&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotateZ&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;RotZ&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rZ</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rY</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;scaleX&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;transform(0)(0)&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sX</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;scaleY&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;transform(1)(1)&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sY</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sZ</span><span class="ActionScriptBracket/Brace">]</span>;
                                     <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;scaleZ&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;transform(2)(2)&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sZ</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sY</span><span class="ActionScriptBracket/Brace">]</span>;
                                     <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translate&quot;</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translation&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;x&quot;</span>, <span class="ActionScriptString">&quot;y&quot;</span>, <span class="ActionScriptString">&quot;z&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                            <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">scaling</span>;
                                            <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">scaling</span>;
                                            <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptBracket/Brace">}</span>
                                     <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                         <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;x&quot;</span>, <span class="ActionScriptString">&quot;z&quot;</span>, <span class="ActionScriptString">&quot;y&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                         <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                             <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">scaling</span>;
                                             <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">scaling</span>;
                                            <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptBracket/Brace">}</span>
                                     <span class="ActionScriptBracket/Brace">}</span>
                                    <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;scale&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sX</span>, <span class="ActionScriptDefault_Text">sY</span>, <span class="ActionScriptDefault_Text">sZ</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">sX</span>, <span class="ActionScriptDefault_Text">sZ</span>, <span class="ActionScriptDefault_Text">sY</span><span class="ActionScriptBracket/Brace">]</span>;
                                     <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotate&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rX</span>, <span class="ActionScriptDefault_Text">rY</span>, <span class="ActionScriptDefault_Text">rZ</span><span class="ActionScriptBracket/Brace">]</span>;
                                     <span class="ActionScriptReserved">else</span>
                                        <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">rX</span>, <span class="ActionScriptDefault_Text">rZ</span>, <span class="ActionScriptDefault_Text">rY</span><span class="ActionScriptBracket/Brace">]</span>;
                                     
                                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span>
                                        <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">*=</span> <span class="ActionScriptOperator">-</span>1;
                                    <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;transform&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;transform&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">break</span>;
                                
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;visibility&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;visibility&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                                    <span class="ActionScriptReserved">break</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptDefault_Text">animation</span>.<span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">start</span>;
                        <span class="ActionScriptDefault_Text">animation</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">start</span>;
                        
                        <span class="ActionScriptDefault_Text">_animationData</span>.<span class="ActionScriptDefault_Text">animation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">animation</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptDefault_Text">AnimationData</span>.<span class="ActionScriptDefault_Text">VERTEX_ANIMATION</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">spaced</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">spaced</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">spaced</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;\r\n&quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">strings</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">spaced</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numbers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">totalStrings</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">strings</span>.<span class="ActionScriptDefault_Text">length</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">totalStrings</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">strings</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">numbers</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">strings</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]))</span>;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">numbers</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;#&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * A scaling factor for all geometry in the model. Defaults to 1.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
        
        <span class="ActionScriptASDoc">/**
         * Controls the use of shading materials when color textures are encountered. Defaults to false.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shading</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
        
        <span class="ActionScriptASDoc">/**
         * Controls the automatic centering of geometry data in the model, improving culling and the accuracy of bounding dimension values. Defaults to false.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerMeshes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
        
        <span class="ActionScriptASDoc">/**
         * Container data object used for storing the parsed collada data structure.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">containerData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ContainerData</span>;
        
        <span class="ActionScriptASDoc">/**
         * Creates a new &lt;code&gt;Collada&lt;/code&gt; object.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Collada</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptDefault_Text">scaling</span> <span class="ActionScriptOperator">=</span> 1;
            
            <span class="ActionScriptComment">//create the container
</span>            <span class="ActionScriptDefault_Text">_container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_container</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;collada&quot;</span>;
            
            <span class="ActionScriptDefault_Text">_container</span>.<span class="ActionScriptDefault_Text">materialLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialLibrary</span>;
            <span class="ActionScriptDefault_Text">_container</span>.<span class="ActionScriptDefault_Text">geometryLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryLibrary</span>;
            
            <span class="ActionScriptDefault_Text">animationLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">container</span>.<span class="ActionScriptDefault_Text">animationLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AnimationLibrary</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">channelLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ChannelLibrary</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">symbolLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">binary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prepareData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptComment">// void junk byte, flash player bug
</span>            <span class="ActionScriptReserved">try</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">collada</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Cast</span>.<span class="ActionScriptDefault_Text">xml</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
               <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">catch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">){</span>
                   <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScriptDefault_Text">warning</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Junk byte!?&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                   <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_pos</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&lt;/COLLADA&gt;&quot;</span><span class="ActionScriptBracket/Brace">)</span>; 
                  <span class="ActionScriptDefault_Text">collada</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>0, <span class="ActionScriptDefault_Text">_pos</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&lt;/COLLADA&gt;&quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">))</span>;
               <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptReserved">default</span> <span class="ActionScriptDefault_Text">xml</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span>.<span class="ActionScriptDefault_Text">namespace</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! ------------- Begin Parse Collada -------------&quot;</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">// Get up axis
</span>            <span class="ActionScriptDefault_Text">yUp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;asset&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">up_axis</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;Y_UP&quot;</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">||</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;asset&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">up_axis</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">parseScene</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptDefault_Text">parseAnimationClips</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseNext</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_parsedChunks</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_geometryArrayLength</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">parseMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryArray</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">_parsedChunks</span><span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">parseChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channelArray</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">_geometryArrayLength</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_parsedChunks</span><span class="ActionScriptBracket/Brace">])</span>;
            
            <span class="ActionScriptDefault_Text">_parsedChunks</span><span class="ActionScriptOperator">++</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_parsedChunks</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">_totalChunks</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//build materials
</span>                <span class="ActionScriptDefault_Text">buildMaterials</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptComment">//build the containers
</span>                <span class="ActionScriptDefault_Text">buildContainers</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">containerData</span>, <span class="ActionScriptDefault_Text">container</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span>, 0<span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//build animations
</span>                <span class="ActionScriptDefault_Text">buildAnimations</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptDefault_Text">notifySuccess</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">notifyProgress</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
                
        <span class="ActionScriptASDoc">/**
         * Converts the scene heirarchy to an away3dlite data structure
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseScene</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">scene</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_visual_scenes&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">visual_scene</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;scene&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">instance_visual_scene</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">))[</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">scene</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! ------------- No scene to parse -------------&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! ------------- Begin Parse Scene -------------&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">containerData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">()</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">scene</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;node&quot;</span><span class="ActionScriptBracket/Brace">])</span>
                <span class="ActionScriptDefault_Text">parseNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>, <span class="ActionScriptDefault_Text">containerData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! ------------- End Parse Scene -------------&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_geometryArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryLibrary</span>.<span class="ActionScriptDefault_Text">getGeometryArray</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_geometryArrayLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryArray</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptDefault_Text">_totalChunks</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_geometryArrayLength</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Converts a single scene node to a BoneData ContainerData or MeshData object.
         * 
         * @see away3dlite.loaders.data.BoneData
         * @see away3dlite.loaders.data.ContainerData
         * @see away3dlite.loaders.data.MeshData
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>, <span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>    
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_transform</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Matrix3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_objectData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ObjectData</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_light&quot;</span><span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptString">&quot;&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_camera&quot;</span><span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
            
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_controller&quot;</span><span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_geometry&quot;</span><span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>.@<span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;JOINT&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">BoneData</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_node&quot;</span><span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;node&quot;</span><span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">))</span>
                        <span class="ActionScriptReserved">return</span>;
                    <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//ColladaMaya 3.05B
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>.@<span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;JOINT&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.@<span class="ActionScriptDefault_Text">sid</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span>.@<span class="ActionScriptDefault_Text">id</span>;
            
            <span class="ActionScriptComment">/* Deprecated for ColladaMaya 3.02
            if(String(node.@name) != &quot;&quot;)
            {
                _objectData.name = String(node.@name);
               }else{
                   _objectData.name = String(node.@id);
               }
               */</span>
               
               <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>.@<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>;
   
            <span class="ActionScriptDefault_Text">_transform</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">transform</span>;
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; + Parse Node : &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot; : &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nodeName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
               <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">geo</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>;
               <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ctrlr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>;
               <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sid</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">instance_material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">boneData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">BoneData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">BoneData</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">childNode</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">nodeName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">()[</span><span class="ActionScriptString">&quot;localName&quot;</span><span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nodeName</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;translate&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">arrayChild</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">_transform</span>.<span class="ActionScriptDefault_Text">prependTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">else</span>
                            <span class="ActionScriptDefault_Text">_transform</span>.<span class="ActionScriptDefault_Text">prependTranslation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptReserved">break</span>;

                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;rotate&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">arrayChild</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">childNode</span>.@<span class="ActionScriptDefault_Text">sid</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">BoneData</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;rotateX&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;rotateY&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;rotateZ&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;rotX&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;rotY&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;rotZ&quot;</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">boneData</span>.<span class="ActionScriptDefault_Text">jointTransform</span>.<span class="ActionScriptDefault_Text">prependRotation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]))</span>;
                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">boneData</span>.<span class="ActionScriptDefault_Text">jointTransform</span>.<span class="ActionScriptDefault_Text">prependRotation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]))</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">_transform</span>.<span class="ActionScriptDefault_Text">prependRotation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]))</span>;
                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">_transform</span>.<span class="ActionScriptDefault_Text">prependRotation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]))</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptReserved">break</span>;
                        
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;scale&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">arrayChild</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>    <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>    <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>    <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">BoneData</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                <span class="ActionScriptDefault_Text">boneData</span>.<span class="ActionScriptDefault_Text">jointTransform</span>.<span class="ActionScriptDefault_Text">prependScale</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span>;
                            <span class="ActionScriptReserved">else</span>
                                <span class="ActionScriptDefault_Text">boneData</span>.<span class="ActionScriptDefault_Text">jointTransform</span>.<span class="ActionScriptDefault_Text">prependScale</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>;
                        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                <span class="ActionScriptDefault_Text">_transform</span>.<span class="ActionScriptDefault_Text">prependScale</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span>;
                            <span class="ActionScriptReserved">else</span>
                                <span class="ActionScriptDefault_Text">_transform</span>.<span class="ActionScriptDefault_Text">prependScale</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">arrayChild</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptReserved">break</span>;
                        
                    <span class="ActionScriptComment">// Baked transform matrix
</span>                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;matrix&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">arrayChild</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">()</span>;
                        <span class="ActionScriptDefault_Text">m</span>.<span class="ActionScriptDefault_Text">rawData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">array2matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">arrayChild</span>, <span class="ActionScriptDefault_Text">yUp</span>, <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_transform</span>.<span class="ActionScriptDefault_Text">prepend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">break</span>;
                        
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;node&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptComment">//3dsMax 11 - Feeling ColladaMax v3.05B
</span>                        <span class="ActionScriptComment">//&lt;node&gt;&lt;node/&gt;&lt;/node&gt;
</span>                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">))</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptComment">//WRONG: parseNode(childNode, parent as ContainerData);
</span>                            
                            <span class="ActionScriptComment">// _objectData is a Mesh but ALSO a container!!!
</span>                            <span class="ActionScriptComment">// WE MUST preserve the hierarchy because if animation is applied onto the mesh _objectData
</span>                            <span class="ActionScriptComment">// then its children must apply this animation too.
</span>                            <span class="ActionScriptComment">// We could use the fact that an ObjectContainer3D is also a Mesh, but on the loader side
</span>                            <span class="ActionScriptComment">// ContainerData doesn&apos;t derive from MeshData.
</span>                            <span class="ActionScriptComment">// So I have added this missing derivative to ContainerData class.
</span>                            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fooContainer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ContainerData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">()</span>;
                            <span class="ActionScriptDefault_Text">_objectData</span>.<span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fooContainer</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">fooContainer</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptDefault_Text">parseNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span>, <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptReserved">break</span>;

                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;instance_node&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">parseNode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_nodes&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">node</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">))[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ContainerData</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptReserved">break</span>;

                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;instance_geometry&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;lines&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                            
                            <span class="ActionScriptComment">//add materials to materialLibrary
</span>                            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance_material</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">childNode</span>..<span class="ActionScriptDefault_Text">instance_material</span><span class="ActionScriptBracket/Brace">)</span>
                                <span class="ActionScriptDefault_Text">parseMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance_material</span>.@<span class="ActionScriptDefault_Text">symbol</span>, <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance_material</span>.@<span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">))</span>;
                            
                            <span class="ActionScriptDefault_Text">geo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_geometries&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">))[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                            
                            <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryLibrary</span>.<span class="ActionScriptDefault_Text">addGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geo</span>.@<span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptDefault_Text">geo</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        
                        <span class="ActionScriptReserved">break</span>;
                    
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;instance_controller&quot;</span><span class="ActionScriptOperator">:</span>
                        
                        <span class="ActionScriptComment">//add materials to materialLibrary
</span>                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance_material</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">childNode</span>..<span class="ActionScriptDefault_Text">instance_material</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">parseMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance_material</span>.@<span class="ActionScriptDefault_Text">symbol</span>, <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">instance_material</span>.@<span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">))</span>;
                        
                        <span class="ActionScriptDefault_Text">ctrlr</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_controllers&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">controller</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">))[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptDefault_Text">geo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_geometries&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ctrlr</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;skin&quot;</span><span class="ActionScriptBracket/Brace">][</span>0<span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">))[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                        
                        <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryLibrary</span>.<span class="ActionScriptDefault_Text">addGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geo</span>.@<span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptDefault_Text">geo</span>, <span class="ActionScriptDefault_Text">ctrlr</span><span class="ActionScriptBracket/Brace">)</span>;
                        
                        <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">skeleton</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childNode</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;skeleton&quot;</span><span class="ActionScriptBracket/Brace">])</span>;
                        <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">parent</span>.<span class="ActionScriptDefault_Text">children</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_objectData</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Converts a material definition to a MaterialData object
         * 
         * @see away3dlite.loaders.data.MaterialData
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">symbol</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
               <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">materialLibrary</span>.<span class="ActionScriptDefault_Text">addMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">symbolLibrary</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">symbol</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialData</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">symbol</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;FrontColorNoCulling&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">SHADING_MATERIAL</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">textureFileName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getTextureFileName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">textureFileName</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">TEXTURE_MATERIAL</span>;
                <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">shading</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">SHADING_MATERIAL</span>;
                    <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">COLOR_MATERIAL</span>;
                    
                    <span class="ActionScriptDefault_Text">parseColorMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">materialName</span>, <span class="ActionScriptDefault_Text">_materialData</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Parses geometry data.
         * 
         * @see away3dlite.loaders.data.GeometryData
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseMesh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">GeometryData</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; + Parse Geometry : &quot;</span><span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">// Triangles
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">trianglesXMLList</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">geoXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mesh&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">triangles</span>;
            
            <span class="ActionScriptComment">// C4D
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">isC4D</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">trianglesXMLList</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">==</span>0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">geoXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mesh&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">polylist</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isC4D</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">trianglesXMLList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">geoXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mesh&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">polylist</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">triangles</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">trianglesXMLList</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Input
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">field</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
                
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">triangles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;input&quot;</span><span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">semantic</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span>.@<span class="ActionScriptDefault_Text">semantic</span>;
                    <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">semantic</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;VERTEX&quot;</span><span class="ActionScriptOperator">:</span>
                            <span class="ActionScriptDefault_Text">deserialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">input</span>, <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">geoXML</span>, <span class="ActionScriptString">&quot;Vertex&quot;</span>, <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;TEXCOORD&quot;</span><span class="ActionScriptOperator">:</span>
                            <span class="ActionScriptDefault_Text">deserialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">input</span>, <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">geoXML</span>, <span class="ActionScriptString">&quot;UV&quot;</span>, <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">uvtData</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">default</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">field</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">input</span>.@<span class="ActionScriptDefault_Text">semantic</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">data</span>     <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">triangles</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;p&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos; &apos;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span>      <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">triangles</span>.@<span class="ActionScriptDefault_Text">count</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">symbol</span> <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">triangles</span>.@<span class="ActionScriptDefault_Text">material</span>;
                
                <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; + Parse MeshMaterialData&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_meshMaterialData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MeshMaterialData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MeshMaterialData</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">_meshMaterialData</span>.<span class="ActionScriptDefault_Text">symbol</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">symbol</span>;
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">materials</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_meshMaterialData</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptComment">//if (!materialLibrary[material])
</span>                <span class="ActionScriptComment">//    parseMaterial(material, material);
</span>                    
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_faceData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FaceData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FaceData</span><span class="ActionScriptBracket/Brace">()</span>;

                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">vn</span> <span class="ActionScriptOperator">&lt;</span> 3; <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fld</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">field</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fld</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;VERTEX&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptDefault_Text">_faceData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;v&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>;
                                    <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;TEXCOORD&quot;</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptDefault_Text">_faceData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;uv&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vn</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>;
                                    <span class="ActionScriptReserved">break</span>;
                                <span class="ActionScriptReserved">default</span><span class="ActionScriptOperator">:</span>
                                    <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">shift</span><span class="ActionScriptBracket/Brace">()</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    
                    <span class="ActionScriptDefault_Text">_meshMaterialData</span>.<span class="ActionScriptDefault_Text">faceList</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">faces</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">faces</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_faceData</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//center vertex points in mesh for better bounding radius calulations
</span>            <span class="ActionScriptComment">//TODO: discount vertices that are not used in faces
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerMeshes</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Infinity</span>;
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Infinity</span>;
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Infinity</span>;
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Infinity</span>;
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Infinity</span>;
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Infinity</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">/</span>3;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexZ</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">vertexX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">vertexY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">vertexZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">vertexX</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertexX</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minX</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">vertexX</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertexX</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">vertexY</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertexY</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minY</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">vertexY</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertexY</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">vertexZ</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertexZ</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minZ</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">vertexZ</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">minZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertexZ</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// Double Side
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">geoXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;extra&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">technique</span>.<span class="ActionScriptDefault_Text">double_sided</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">bothsides</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">geoXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;extra&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">technique</span>.<span class="ActionScriptDefault_Text">double_sided</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;1&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">bothsides</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;
            
            <span class="ActionScriptComment">// force bothsides by script
</span>            <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">bothsides</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">bothsides</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">bothsides</span>;
            
            <span class="ActionScriptComment">//parse controller
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">ctrlXML</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">ctrlXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;skin&quot;</span><span class="ActionScriptBracket/Brace">][</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">jointId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;joints&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">input</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">semantic</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;JOINT&quot;</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tmp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;source&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">jointId</span><span class="ActionScriptBracket/Brace">)[</span><span class="ActionScriptString">&quot;Name_array&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptComment">//Blender?
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">tmp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">tmp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;source&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">jointId</span><span class="ActionScriptBracket/Brace">)[</span><span class="ActionScriptString">&quot;IDREF_array&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">tmp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">\n</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">g</span>, <span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nameArray</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bind_shape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">bind_shape</span>.<span class="ActionScriptDefault_Text">rawData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">array2matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;bind_shape_matrix&quot;</span><span class="ActionScriptBracket/Brace">][</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>, <span class="ActionScriptDefault_Text">yUp</span>, <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bindMatrixId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;joints&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">input</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">semantic</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;INV_BIND_MATRIX&quot;</span><span class="ActionScriptBracket/Brace">)</span>.@<span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">float_array</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;source&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">bindMatrixId</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">float_array</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Matrix3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">skinController</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SkinController</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">float_array</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">nameArray</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">/</span> 16<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">rawData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">array2matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">float_array</span>.<span class="ActionScriptDefault_Text">slice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span>, <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">+</span>16<span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptDefault_Text">yUp</span>, <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">prepend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bind_shape</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">skinControllers</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skinController</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SkinController</span><span class="ActionScriptBracket/Brace">())</span>;
                <span class="ActionScriptDefault_Text">skinController</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">name</span>;
                <span class="ActionScriptDefault_Text">skinController</span>.<span class="ActionScriptDefault_Text">bindMatrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">matrix</span>;
                <span class="ActionScriptDefault_Text">_skinControllers</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skinController</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> 16;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; + SkinWeight&quot;</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptDefault_Text">tmp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;vertex_weights&quot;</span><span class="ActionScriptBracket/Brace">][</span>0<span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">count</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">weightsId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;vertex_weights&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">input</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">semantic</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;WEIGHT&quot;</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">tmp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;source&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">weightsId</span><span class="ActionScriptBracket/Brace">)[</span><span class="ActionScriptString">&quot;float_array&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">weights</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">tmp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;vertex_weights&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">vcount</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vcount</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">tmp</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">skin</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;vertex_weights&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">v</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tmp</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">skinVertex</span>    <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SkinVertex</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span>            <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">count</span>        <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;
            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">/</span>3<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vcount</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">skinVertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">skinVertex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SkinVertex</span><span class="ActionScriptBracket/Brace">())</span>;
                <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">=</span>0;
                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">skinVertex</span>.<span class="ActionScriptDefault_Text">controllers</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometryData</span>.<span class="ActionScriptDefault_Text">skinControllers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptBracket/Brace">])])</span>;
                    <span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptDefault_Text">skinVertex</span>.<span class="ActionScriptDefault_Text">weights</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">weights</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptBracket/Brace">])]))</span>;
                    <span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">++</span>;
                    <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Detects and parses all animation clips
         */</span> 
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseAnimationClips</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            
            <span class="ActionScriptComment">//Check for animations
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">anims</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_animations&quot;</span><span class="ActionScriptBracket/Brace">][</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">anims</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! ------------- No animations to parse -------------&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//Check to see if animation clips exist
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">clips</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_animation_clips&quot;</span><span class="ActionScriptBracket/Brace">][</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! Animation Clips Exist : &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_haveClips</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! ------------- Begin Parse Animation -------------&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_channel_id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> 0;
            
            <span class="ActionScriptComment">//loop through all animations and for each through all its channels
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_channelName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_channels</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">anims</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;animation&quot;</span><span class="ActionScriptBracket/Brace">][</span><span class="ActionScriptString">&quot;animation&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">animation</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">anims</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;animation&quot;</span><span class="ActionScriptBracket/Brace">])</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">animation</span>.@<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_channelName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">animation</span>.@<span class="ActionScriptDefault_Text">id</span>;
                    <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">// COLLADAMax NextGen;  Version: 1.1.0;  Platform: Win32;  Configuration: Release Max2009
</span>                        <span class="ActionScriptComment">// issue#1 : missing channel.@id -&gt; use automatic id instead
</span>                        <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! COLLADAMax2009 id : _&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_channel_id</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_channelName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;_&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channel_id</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>

                    <span class="ActionScriptDefault_Text">_channels</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">animation</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;channel&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channels</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptDefault_Text">channelLibrary</span>.<span class="ActionScriptDefault_Text">addChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channelName</span>, <span class="ActionScriptDefault_Text">animation</span>, 0<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channelIndex</span> <span class="ActionScriptOperator">=</span> 0 ; <span class="ActionScriptDefault_Text">channelIndex</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_channels</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> ; <span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_channels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">target</span>;
                            <span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span>;
                            
                            <span class="ActionScriptDefault_Text">channelLibrary</span>.<span class="ActionScriptDefault_Text">addChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channelName</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;_subAnim_&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">type</span>, <span class="ActionScriptDefault_Text">animation</span>, <span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">// C4D 
</span>            <span class="ActionScriptComment">// issue#1 : animation -&gt; animation.animation
</span>            <span class="ActionScriptComment">// issue#2 : missing channel.@id -&gt; use automatic id instead
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">animation</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">anims</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;animation&quot;</span><span class="ActionScriptBracket/Brace">][</span><span class="ActionScriptString">&quot;animation&quot;</span><span class="ActionScriptBracket/Brace">])</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">animation</span>.@<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_channelName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">animation</span>.@<span class="ActionScriptDefault_Text">id</span>;
                <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptReserved">else</span><span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! C4D id : _&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">_channel_id</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_channelName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;_&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channel_id</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
                <span class="ActionScriptDefault_Text">_channels</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">animation</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;channel&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channels</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> 1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">channelLibrary</span>.<span class="ActionScriptDefault_Text">addChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channelName</span>, <span class="ActionScriptDefault_Text">animation</span>, 0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channelIndex</span> <span class="ActionScriptOperator">=</span> 0 ; <span class="ActionScriptDefault_Text">channelIndex</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">_channels</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> ; <span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_channels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">target</span>;
                        <span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span>;
                        
                        <span class="ActionScriptDefault_Text">channelLibrary</span>.<span class="ActionScriptDefault_Text">addChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_channelName</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;_subAnim_&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">type</span>, <span class="ActionScriptDefault_Text">animation</span>, <span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
                    
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">clips</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//loop through all animation clips
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">clip</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">clips</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;animation_clip&quot;</span><span class="ActionScriptBracket/Brace">])</span>
                    <span class="ActionScriptDefault_Text">parseAnimationClip</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">clip</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">//create default animation clip
</span>            <span class="ActionScriptDefault_Text">_defaultAnimationClip</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">animationLibrary</span>.<span class="ActionScriptDefault_Text">addAnimation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;default&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channelData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelData</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">channelLibrary</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">_defaultAnimationClip</span>.<span class="ActionScriptDefault_Text">channels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelData</span>;
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! ------------- End Parse Animation -------------&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_channelArray</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelLibrary</span>.<span class="ActionScriptDefault_Text">getChannelArray</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_channelArrayLength</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_channelArray</span>.<span class="ActionScriptDefault_Text">length</span>;
            <span class="ActionScriptDefault_Text">_totalChunks</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">_channelArrayLength</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseAnimationClip</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">clip</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">animationClip</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">AnimationData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">animationLibrary</span>.<span class="ActionScriptDefault_Text">addAnimation</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">clip</span>.@<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptComment">//TODO: Is there a need to handle case where there is multiple channels inside an animation channel (_subAnim_) ?
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">clip</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_animation&quot;</span><span class="ActionScriptBracket/Brace">])</span>
                <span class="ActionScriptDefault_Text">animationClip</span>.<span class="ActionScriptDefault_Text">channels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channel</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">)]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelLibrary</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channel</span>.@<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptBracket/Brace">)]</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseChannel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channelData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChannelData</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">xml</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channels</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;channel&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channelChunk</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">channelIndex</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelChunk</span>.@<span class="ActionScriptDefault_Text">target</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! No animation type detected&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// C4D : didn&apos;t have @id, Maya 7 exporter has X/Y/Z split on translate
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">node</span>.@<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0 <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 1 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">type</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 1<span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">type</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;image&quot;</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">node</span>.@<span class="ActionScriptDefault_Text">id</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;frameExtension&quot;</span><span class="ActionScriptBracket/Brace">))</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">//TODO : Material Animation
</span>                    <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! Material animation not yet implemented&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">return</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">type</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;.&quot;</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">channel</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Channel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">channel</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Channel</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            
            <span class="ActionScriptDefault_Text">_defaultAnimationClip</span>.<span class="ActionScriptDefault_Text">channels</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channelData</span>;
            
            <span class="ActionScriptDefault_Text">Debug</span>.<span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! channelType : &quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sourceName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">channelChunk</span>.@<span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sampler</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;sampler&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">sourceName</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">sampler</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;input&quot;</span><span class="ActionScriptBracket/Brace">])</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">src</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">node</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;source&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">input</span>.@<span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">))[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">list</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">src</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;float_array&quot;</span><span class="ActionScriptBracket/Brace">])</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">src</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;technique_common&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">accessor</span>.@<span class="ActionScriptDefault_Text">count</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">src</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;technique_common&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">accessor</span>.@<span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">semantic</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span>.@<span class="ActionScriptDefault_Text">semantic</span>;
                
                <span class="ActionScriptComment">//C4D : no stride defined
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptOperator">=</span>1;
                
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">p</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                
                <span class="ActionScriptReserved">switch</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">semantic</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;INPUT&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">list</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">))</span>;
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_defaultAnimationClip</span>.<span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>
                            <span class="ActionScriptDefault_Text">_defaultAnimationClip</span>.<span class="ActionScriptDefault_Text">start</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                        
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_defaultAnimationClip</span>.<span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">])</span>
                            <span class="ActionScriptDefault_Text">_defaultAnimationClip</span>.<span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">times</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">]</span>;
                        
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;OUTPUT&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;
                        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                           <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
                            
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">==</span> 16<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">m</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Matrix3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix3D</span><span class="ActionScriptBracket/Brace">()</span>;
                                <span class="ActionScriptDefault_Text">m</span>.<span class="ActionScriptDefault_Text">rawData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">array2matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">list</span>.<span class="ActionScriptDefault_Text">slice</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">stride</span>, <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">+</span> 16<span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptDefault_Text">yUp</span>, <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">)</span>;
                                <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">m</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0;
                                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">list</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]))</span>;
                                    <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span>;
                                <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;INTERPOLATION&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">list</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">interpolations</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">p</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;IN_TANGENT&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;
                        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">inTangent</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
                            <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0;
                            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">inTangent</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">list</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">list</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]))</span>;
                                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;OUT_TANGENT&quot;</span><span class="ActionScriptOperator">:</span>
                        <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0;
                        <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">outTangent</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
                            <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0;
                            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">stride</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">channel</span>.<span class="ActionScriptDefault_Text">outTangent</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">list</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">list</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">stride</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]))</span>;
                                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">j</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">break</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptDefault_Text">channelData</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">type</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Retrieves the filename of a material
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getTextureFileName</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_materials&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">material</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">materialName</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
    
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">effectId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_effect&quot;</span><span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">effect</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_effects&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">effect</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">effectId</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
    
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">texture</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">texture</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">texture</span>;
    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sampler</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">newparam</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">textureId</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
    
                <span class="ActionScriptComment">// Blender
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">imageId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">textureId</span>;
    
                <span class="ActionScriptComment">// Not Blender
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">sampler</span> <span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sourceId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sampler</span>..<span class="ActionScriptDefault_Text">source</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">newparam</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">sid</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">sourceId</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
    
                    <span class="ActionScriptDefault_Text">imageId</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">source</span>..<span class="ActionScriptDefault_Text">init_from</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptBracket/Brace">}</span>
    
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_images&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">image</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">imageId</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
    
                <span class="ActionScriptComment">//3dsMax 11 - Feeling ColladaMax v3.05B.
</span>                <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">image</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_images&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">image</span>.<span class="ActionScriptDefault_Text">init_from</span>.<span class="ActionScriptDefault_Text">text</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">image</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;init_from&quot;</span><span class="ActionScriptBracket/Brace">]</span>;
    
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">filename</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>0, 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;./&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">filename</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">filename</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span> 2 <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">filename</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Fills the 3d matrix object with values from an array with 3d matrix values
         * ordered from right to left and up to down.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">array2matrix</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>, <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">(</span>16<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>8<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>12<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>9<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>13<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>8<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>9<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>10<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>10<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>14<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>11<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
            <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>8<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>12<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>8<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>10<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>9<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>9<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>13<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>11<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>10<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>14<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
            <span class="ActionScriptBracket/Brace">}</span>
                         
            <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>12<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>13<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>11<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>14<span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">rawData</span><span class="ActionScriptBracket/Brace">[</span>15<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span>  <span class="ActionScriptDefault_Text">ar</span><span class="ActionScriptBracket/Brace">[</span>15<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">rawData</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Retrieves the color of a material
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseColorMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">colorName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">materialData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialData</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_materials&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">material</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">colorName</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
            
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">effectId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getId</span><span class="ActionScriptBracket/Brace">(</span> <span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;instance_effect&quot;</span><span class="ActionScriptBracket/Brace">]</span>.@<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">effect</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;library_effects&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">effect</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">effectId</span><span class="ActionScriptBracket/Brace">)[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                
                <span class="ActionScriptDefault_Text">materialData</span>.<span class="ActionScriptDefault_Text">ambientColor</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getColorValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">ambient</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">materialData</span>.<span class="ActionScriptDefault_Text">diffuseColor</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getColorValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">diffuse</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">materialData</span>.<span class="ActionScriptDefault_Text">specularColor</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getColorValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">specular</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>;
                <span class="ActionScriptDefault_Text">materialData</span>.<span class="ActionScriptDefault_Text">shininess</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">effect</span>..<span class="ActionScriptDefault_Text">shininess</span>.<span class="ActionScriptDefault_Text">float</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getColorValue</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">colorXML</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">colorXML</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">colorXML</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> 0<span class="ActionScriptDefault_Text">xFFFFFF</span>;
            
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">colorXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;color&quot;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">colorXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;color&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> 0<span class="ActionScriptDefault_Text">xFFFFFF</span>;
            
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">colorArray</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">colorXML</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;color&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">colorArray</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&lt;=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> 0<span class="ActionScriptDefault_Text">xFFFFFF</span>;
            
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">colorArray</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>255 <span class="ActionScriptOperator">&lt;&lt;</span> 16<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">|</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">colorArray</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>255 <span class="ActionScriptOperator">&lt;&lt;</span> 8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">|</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">colorArray</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>255<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptASDoc">/**
         * Converts a data string to an array of objects. Handles vertex and uv objects
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">deserialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">input</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>, <span class="ActionScriptDefault_Text">geo</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span>, <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">output</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">input</span>.@<span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;#&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span>;

            <span class="ActionScriptComment">// Source?
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">acc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geo</span>..<span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)[</span><span class="ActionScriptString">&quot;technique_common&quot;</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">accessor</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">acc</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">XMLList</span><span class="ActionScriptBracket/Brace">())</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Build source floats array
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">floId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">acc</span>.@<span class="ActionScriptDefault_Text">source</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;#&quot;</span><span class="ActionScriptBracket/Brace">)[</span>1<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">floXML</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">collada</span>..<span class="ActionScriptDefault_Text">float_array</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">floId</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">floStr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>  <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">floXML</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">floats</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>   <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">floStr</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">float</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
                <span class="ActionScriptComment">// Build params array
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">param</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
                
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">par</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">acc</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;param&quot;</span><span class="ActionScriptBracket/Brace">])</span>
                    <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">par</span>.@<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptComment">// Build output array
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">floats</span>.<span class="ActionScriptDefault_Text">length</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;
                <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">len</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;Vertex&quot;</span><span class="ActionScriptOperator">:</span>
                            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">float</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">floats</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;X&quot;</span><span class="ActionScriptOperator">:</span>
                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                            <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">float</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptReserved">else</span>
                                            <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">float</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptReserved">break</span>;
                                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;Y&quot;</span><span class="ActionScriptOperator">:</span>
                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                            <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">float</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptReserved">else</span>
                                            <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">float</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptReserved">break</span>;
                                        <span class="ActionScriptReserved">break</span>;
                                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;Z&quot;</span><span class="ActionScriptOperator">:</span>
                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yUp</span><span class="ActionScriptBracket/Brace">)</span>
                                            <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">float</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptReserved">else</span>
                                            <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">float</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>;
                                        <span class="ActionScriptReserved">break</span>;
                                        <span class="ActionScriptReserved">break</span>;
                                    <span class="ActionScriptReserved">default</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptBracket/Brace">}</span>
                                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;UV&quot;</span><span class="ActionScriptOperator">:</span>
                            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptDefault_Text">float</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">floats</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">param</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;S&quot;</span><span class="ActionScriptOperator">:</span>
                                        <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">float</span>;
                                        <span class="ActionScriptReserved">break</span>;
                                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;T&quot;</span><span class="ActionScriptOperator">:</span>
                                        <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 1 <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">float</span>;
                                        <span class="ActionScriptReserved">break</span>;
                                    <span class="ActionScriptReserved">default</span><span class="ActionScriptOperator">:</span>
                                <span class="ActionScriptBracket/Brace">}</span>
                                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span>;
                            <span class="ActionScriptBracket/Brace">}</span>
                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">default</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">output</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">value</span>.<span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// Store indexes if no source
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">recursive</span> <span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">XMLList</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">geo</span>..<span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptBracket/Brace">(</span>@<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)[</span><span class="ActionScriptString">&quot;input&quot;</span><span class="ActionScriptBracket/Brace">]</span>;

                <span class="ActionScriptDefault_Text">deserialize</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">recursive</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">geo</span>, <span class="ActionScriptDefault_Text">type</span>, <span class="ActionScriptDefault_Text">output</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
