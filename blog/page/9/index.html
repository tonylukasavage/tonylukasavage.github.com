
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tony Lukasavage</title>
  <meta name="author" content="Tony Lukasavage">

  
  <meta name="description" content="→ Click here or the image above for the demo.
&rarr; View the source code.
NOTE: You&#8217;ll need to download away3dlite, googleas3api, and &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tonylukasavage.github.com/blog/page/9/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Tony Lukasavage" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/fancybox/source/jquery.fancybox.css?v=2.1.4" media="screen" />

<style type="text/css">
ul#grid {
  padding: 0;
  list-style: none;
  margin: 20px auto 0;
  width: 100%;  
  }

#grid li {
  float: left;
  padding: 0;
  margin: 0 5px 10px 5px;
  } 

#grid li a {
  display: block;
  }

#grid li img {
  background-color: white;
  padding: 7px; margin: 0;
  border: 1px dotted #58595b;
  width: 140px;
  height: 120px;
  }
</style>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39965828-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup id="theHeader">
  <h1><a href="/">Tony Lukasavage</a></h1>
  
    <h2>Caffeine. Whiskey. Code. Mostly the last one.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tonylukasavage.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/27/johnny-cash-in-flash/">Johnny Cash in Flash</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-27T09:56:00-04:00" pubdate data-updated="true">Sep 27<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/cash/cash.html" class="fancybox.iframe"><img title="face_picking" src="/images/cash.jpg" alt="" width="559" height="421" /></a></p>


<p>→ <a class="fancybox.iframe" href="/demos/cash/cash.html">Click here</a> or the image above for the demo.
&rarr; View the <a href="/demos/cash/srcview/index.html">source code</a>.
<b>NOTE:</b> You&#8217;ll need to download <a href="http://away3d.com/away3d-lite-v1-0-fastest-and-smallest-3d-engine-in-flash" target="_blank">away3dlite</a>, <a href="http://code.google.com/p/googleas3api/" target="_blank">googleas3api</a>, and <a href="http://github.com/mikechambers/as3corelib" target="_blank">AS3CoreLib</a> to compile the code.</p>

<p>Inspired by the legendary Johnny Cash I decided to dive into a few AS3 development topics I haven&#8217;t gotten to yet to create a 3d equalizer and tribute to the Man in Black.  Those topics, along with some other more familiar ones, include:</p>

<ul>
    <li>Playing audio in Flash with Sound and SoundChannel</li>
    <li>Using the <a href="http://www.adobe.com/livedocs/flash/9.0/ActionScriptLangRefV3/flash/media/SoundMixer.html" target="_blank">SoundMixer</a> to generate values based on the audio</li>
    <li>Searching for images with the Google API via <a href="http://code.google.com/p/googleas3api/" target="_blank">googleas3api</a></li>
    <li>Creating a PHP proxy for beating <a href="http://www.onegiantmedia.com/as3---load-a-remote-image-from-any-domain-with-no-security-sandbox-errors" target="_blank">Flash cross-domain security issues</a></li>
    <li>Using <a href="http://away3d.com/away3d-lite-v1-0-fastest-and-smallest-3d-engine-in-flash" target="_blank">Away3dLite</a> for speedy 3d visualization (I even get 15 FPS on my phone!)</li>
    <li>Using <a href="http://www.closier.nl/prefab/" target="_blank">Prefab</a> to export 3d models as native AS3 code for Away3d or Away3dLite.</li>
</ul>


<p>This demo has a good bit more code than I usually post up.  It also uses a couple external libraries, namely <a href="http://away3d.com/away3d-lite-v1-0-fastest-and-smallest-3d-engine-in-flash" target="_blank">away3dlite</a> (3d rendering), <a href="http://code.google.com/p/googleas3api/" target="_blank">googleas3api</a> (Google API), and <a href="http://github.com/mikechambers/as3corelib" target="_blank">AS3CoreLib</a> (super useful AS3 utilities).  Rather than overwhelm you with mountains of tutorial-like rambling, instead I&#8217;ll leave this demo here to be enjoyed, make the source code available, and break down each of these topics into smaller tutorials/guides in the near future.</p>

<p>Sometimes your muse doesn&#8217;t need to be even slightly related to your field of creativity.  In fact, that can often make for the most interesting inspiration.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/14/reflection-in-away3d--take-2/">Reflection in Away3D, Take 2</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-14T07:33:00-04:00" pubdate data-updated="true">Sep 14<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/reflect_camera2/reflect_camera.html" class="fancybox.iframe"><img title="reflect_camera" src="/images/bigreflect.jpg" alt="" width="574" height="346" /></a></p>


<p>About 13 seconds after I finished my last &#8220;Reflections in Away3D&#8221; demo I thought up a much better way to do it.  I guess that&#8217;s what happens when you apply loosely applicable code to a new scenario.  This method, while a bit more resource intensive, is MUCH more functional. Instead of doing a simple Bitmap inversion with a gradient mask and locking the view to only 2 out of 3 planes at a time, I use Away3D Plane objects and multiple views/cameras to create real-time reflections.  This is a 3D engine after all.</p>

<p>The revision I&#8217;m presenting here is just a proof of concept.  In the near future I hope to release a class that encapsulates reflections much like SimpleShadow in Away3D.  You&#8217;ll recognize SimpleShadow from the my Away3D shadows demo, which was written by the bad-ass Away3D dev and <a href="http://www.closier.nl/prefab/" target="_blank">Prefab</a> creator <a href="http://blog.closier.nl/" target="_blank">Fabrice Closier</a>.  Inspiration for this code definitely comes from his motivational work.  The reflections aren&#8217;t perfect, the overlapping isn&#8217;t perfect, but it does help to add a little more dimension to the scene.</p>

<p><strong>UPDATE:</strong> Normally I would release the source code, but in my ignorance and zeal to get this done I totally missed the <a href="http://www.lidev.com.ar/?p=161" target="_blank">Away3D ReflectivePlane class</a>.  It is designed to do exactly what this plane does using a lot more math, but only one additional camera/view per reflective plane.  It also does realistic reflections relative to the position of the viewing camera.  In other words, way better than what I was offering!</p>

<p>The only problem with ReflectivePlane is that it was designed a few Away3D revisions back and now has some intermittent initialization glitches.  It seemed to me to be better for the Away3d community that I try to recruit ReflectivePlane&#8217;s author, <a href="http://www.lidev.com.ar/" target="_blank">Alejandro Santander (AKA, &#8220;Li&#8221;)</a>, to help troubleshoot the problems rather than muddy the waters by adding another solution to an already solved scenario.  When we have a resolution to this problem, I&#8217;ll be sure to let you know&#8230; in the form of a demo WITH source code this time!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/13/video--google-project--flash-builder-4--and-subclipse/">Video: Google Project, Flash Builder 4, and Subclipse</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-13T07:36:00-04:00" pubdate data-updated="true">Sep 13<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><object classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" width="480" height="385" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"><param name="allowFullScreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="src" value="http://www.youtube.com/v/DYcEm2KCSeM?fs=1&amp;hl=en_US" /><param name="allowfullscreen" value="true" /><embed type="application/x-shockwave-flash" width="480" height="385" src="http://www.youtube.com/v/DYcEm2KCSeM?fs=1&amp;hl=en_US" allowscriptaccess="always" allowfullscreen="true"></embed></object>


<p>You&#8217;ll get to see exactly how to create a Google Project Hosting Subversion repository, install the <a href="http://subclipse.tigris.org/" target="_blank">Subclipse SVN plugin</a> for Flash Builder 4, and integrate the repository into your development environment.</p>

<p>You&#8217;ll have to forgive the very amateur nature of the video, this was my first time using <a href="http://www.adobe.com/products/captivate/" target="_blank">Adobe Captivate</a> .  Its a pretty intuitive software, but I&#8217;m totally ignorant to the finer points of video guide creation.  I&#8217;m sure that will start to change in the near future, though, especially if people actually take the time to watch this one.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/07/jiglib-flash-and-away3d/">JigLib Flash and Away3D</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-07T16:00:00-04:00" pubdate data-updated="true">Sep 7<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/jiglib_away3d/jiglib_away3d.html" class="fancybox.iframe"><img title="jiglib_away3d" src="/images/jiglib_big.jpg" alt="" width="556" height="323" /></a></p>


<p>&rarr; Click the above image or <a href="/demos/jiglib_away3d/jiglib_away3d.html">here</a> to play the demo
&rarr; <a href="/demos/jiglib_away3d/srcview/index.html">View the source code</a></p>

<h1>The Overview</h1>


<p>Toying around with <a href="http://www.jiglibflash.com/blog/" target="_blank">JigLib Flash</a> in <a href="http://away3d.com" target="_blank">Away3D</a> today was both interesting and sobering.  For those who don&#8217;t know, JigLib is a 3D physics engine, and JigLib Flash is the AS3 port of it.  While my expectations weren&#8217;t too high since this is complex mathematical processing in Flash, I was hoping for a little more.  Don&#8217;t get me wrong, though, there&#8217;s some very cool potential here.  Be sure to check the tutorials and demos added by people who didn&#8217;t give up quite as quickly as me: <a href="http://www.jiglibflash.com/blog/2009/07/23/collection-of-jiglibflash-examplestutorials-3d-physic-engine/" target="_blank">JigLib Flash demos and tutorials</a>.  I particularly enjoyed some of the car physics demos using this library.</p>

<p>I was setting out to do a basic Jenga-like game.  Its just a tower of zig zagging blocks, 3 blocks to a row, 18 rows total.  It quickly became evident that this just wasn&#8217;t going to happen.  After about 4 rows of blocks the frame rate dropped down into single digits and there was tons of &#8220;jitter&#8221; among the blocks in the scene.  I assume the jitter has to do with the fact that Flash can&#8217;t process the collisions fast enough and Jiglib is trying to correct rigid body penetrations.  I did A LOT of tinkering with the <a href="http://code.google.com/p/jiglibflash/source/browse/trunk/fp10/src/jiglib/cof/JConfig.as" target="_blank">JConfig</a> settings, which are a group of static settings that manipulate how the physics is calculated, but couldn&#8217;t make it work for me.  In the end, I think JigLib Flash just needs a lot of work on &#8220;stacking&#8221; and rigid bodies with many simultaneous points of contact.</p>

<p>OK, now that I&#8217;ve had my purge of frustration, let me at least talk about a half decent example of Away3D and JigLib running very well together.  In the demo at the top of this post I just have a whole bunch of spheres falling into a box with JigLib taking care of the collisions.  It works very well and even maintains a good frame rate.  So good in fact that I even took the time to add some simple shadows to the falling spheres.</p>

<h1>The Code</h1>


<p>&rarr; <a href="/demos/jiglib_away3d/srcview/index.html">full source code (download link at bottom)</a>
jiglib_away3d.mxml:</p>

<div style="height:400px; overflow:auto;">

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">mx</span><span class="o">:</span><span class="n">Application</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">mx</span><span class="o">=</span><span class="s2">&quot;http://www.adobe.com/2006/mxml&quot;</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;absolute&quot;</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">local</span><span class="o">=</span><span class="s2">&quot;*&quot;</span>
</span><span class='line'>              <span class="n">creationComplete</span><span class="o">=</span><span class="s2">&quot;init();&quot;</span> <span class="n">frameRate</span><span class="o">=</span><span class="s2">&quot;60&quot;</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600&quot;</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;800&quot;</span>
</span><span class='line'>              <span class="n">viewSourceURL</span><span class="o">=</span><span class="s2">&quot;srcview/index.html&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="n">mx</span><span class="o">:</span><span class="n">Script</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;![</span><span class="n">CDATA</span><span class="o">[</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.primitives.Plane</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.core.base.Mesh</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">__AS3__.vec.Vector</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.materials.BitmapMaterial</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">jiglib.physics.RigidBody</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">jiglib.plugin.away3d.</span><span class="o">*;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">mx.core.UIComponent</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.primitives.Sphere</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.core.math.Number3D</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.core.utils.Cast</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="kd">private</span> <span class="kd">var</span> <span class="n">_physics</span><span class="p">:</span><span class="kt">Away3DPhysics</span><span class="o">;</span>
</span><span class='line'>          <span class="kd">private</span> <span class="kd">var</span> <span class="n">_shadows</span><span class="p">:</span><span class="kt">Vector.&lt;Plane&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Vector.&lt;Plane&gt;</span><span class="o">();</span>
</span><span class='line'>          <span class="kd">private</span> <span class="kd">var</span> <span class="n">_bodies</span><span class="p">:</span><span class="kt">Vector.&lt;RigidBody&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Vector.&lt;RigidBody&gt;</span><span class="o">();</span>
</span><span class='line'>          <span class="o">[</span><span class="n">Embed</span><span class="o">(</span><span class="s2">&quot;shadow.png&quot;</span><span class="o">)]</span> <span class="kd">private</span> <span class="kd">var</span> <span class="n">pngShadow</span><span class="p">:</span><span class="kt">Class</span><span class="o">;</span>
</span><span class='line'>          <span class="o">[</span><span class="n">Embed</span><span class="o">(</span><span class="s2">&quot;water.jpg&quot;</span><span class="o">)]</span> <span class="kd">private</span> <span class="kd">var</span> <span class="n">jpgPaper</span><span class="p">:</span><span class="kt">Class</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="kd">private</span> <span class="kd">function </span><span class="nf">init</span><span class="o">():</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="o">(</span><span class="n">stage</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">initAway3D</span><span class="o">();</span>
</span><span class='line'>              <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                  <span class="k">this</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">ADDED_TO_STAGE</span><span class="o">,</span> <span class="kd">function</span><span class="o">(</span><span class="n">e</span><span class="o">:</span><span class="n">Event</span><span class="o">):</span><span class="kc">void</span> <span class="o">{</span> <span class="n">initAway3D</span><span class="o">();</span> <span class="o">});</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="kd">private</span> <span class="kd">function </span><span class="nf">initAway3D</span><span class="o">():</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">stage</span><span class="o">.</span><span class="na">quality</span> <span class="o">=</span> <span class="n">flash</span><span class="o">.</span><span class="na">display</span><span class="o">.</span><span class="na">StageQuality</span><span class="o">.</span><span class="na">LOW</span><span class="o">;</span>
</span><span class='line'>              <span class="n">stage</span><span class="o">.</span><span class="na">scaleMode</span> <span class="o">=</span> <span class="n">StageScaleMode</span><span class="o">.</span><span class="na">NO_SCALE</span><span class="o">;</span>
</span><span class='line'>              <span class="n">_drawBackground</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">// prepare physics</span>
</span><span class='line'>              <span class="kd">var</span> <span class="n">walls</span><span class="p">:</span><span class="kt">Vector.&lt;RigidBody&gt;</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Vector.&lt;RigidBody&gt;</span><span class="o">();</span>
</span><span class='line'>              <span class="n">_physics</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Away3DPhysics</span><span class="o">(</span><span class="n">away3dMain</span><span class="o">.</span><span class="na">view</span><span class="o">,</span> <span class="mi">5</span><span class="o">);</span>
</span><span class='line'>              <span class="n">walls</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">_physics</span><span class="o">.</span><span class="na">createCube</span><span class="o">({</span><span class="n">width</span><span class="o">:</span><span class="mi">1000</span><span class="o">,</span> <span class="n">height</span><span class="o">:</span><span class="mi">10</span><span class="o">,</span> <span class="n">depth</span><span class="o">:</span><span class="mi">1000</span><span class="o">}));</span>
</span><span class='line'>              <span class="n">walls</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">_physics</span><span class="o">.</span><span class="na">createCube</span><span class="o">({</span><span class="n">width</span><span class="o">:</span><span class="mi">10</span><span class="o">,</span> <span class="n">height</span><span class="o">:</span><span class="mi">1000</span><span class="o">,</span> <span class="n">depth</span><span class="o">:</span><span class="mi">1000</span><span class="o">}));</span>
</span><span class='line'>              <span class="n">walls</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">_physics</span><span class="o">.</span><span class="na">createCube</span><span class="o">({</span><span class="n">width</span><span class="o">:</span><span class="mi">1000</span><span class="o">,</span> <span class="n">height</span><span class="o">:</span><span class="mi">1000</span><span class="o">,</span> <span class="n">depth</span><span class="o">:</span><span class="mi">10</span><span class="o">}));</span>
</span><span class='line'>              <span class="n">walls</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">_physics</span><span class="o">.</span><span class="na">createCube</span><span class="o">({</span><span class="n">width</span><span class="o">:</span><span class="mi">10</span><span class="o">,</span> <span class="n">height</span><span class="o">:</span><span class="mi">1000</span><span class="o">,</span> <span class="n">depth</span><span class="o">:</span><span class="mi">1000</span><span class="o">}));</span>
</span><span class='line'>
</span><span class='line'>              <span class="kd">var</span> <span class="n">sprite</span><span class="p">:</span><span class="kt">Sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>              <span class="kd">var</span> <span class="n">matrix</span><span class="p">:</span><span class="kt">Matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Matrix</span><span class="o">();</span>
</span><span class='line'>              <span class="n">matrix</span><span class="o">.</span><span class="na">createGradientBox</span><span class="o">(</span><span class="mi">512</span><span class="o">,</span><span class="mi">512</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'>              <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginGradientFill</span><span class="o">(</span><span class="s2">&quot;radial&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mh">0xdddddd</span><span class="o">,</span><span class="mh">0x000000</span><span class="o">],</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">255</span><span class="o">],</span> <span class="n">matrix</span><span class="o">);</span>
</span><span class='line'>              <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">512</span><span class="o">,</span><span class="mi">512</span><span class="o">);</span>
</span><span class='line'>              <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>              <span class="kd">var</span> <span class="n">bmd</span><span class="p">:</span><span class="kt">BitmapData</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapData</span><span class="o">(</span><span class="mi">512</span><span class="o">,</span><span class="mi">512</span><span class="o">,</span><span class="kc">false</span><span class="o">);</span>
</span><span class='line'>              <span class="n">bmd</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">sprite</span><span class="o">);</span>
</span><span class='line'>              <span class="kd">var</span> <span class="n">mat</span><span class="p">:</span><span class="kt">BitmapMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapMaterial</span><span class="o">(</span><span class="n">bmd</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>              <span class="k">for</span> <span class="o">(</span><span class="kd">var</span> <span class="n">j</span><span class="p">:</span><span class="kt">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">walls</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">j</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="kd">var</span> <span class="n">body</span><span class="p">:</span><span class="kt">RigidBody</span> <span class="o">=</span> <span class="n">walls</span><span class="o">[</span><span class="n">j</span><span class="o">];</span>
</span><span class='line'>                  <span class="kd">var</span> <span class="n">mesh</span><span class="p">:</span><span class="kt">Mesh</span> <span class="o">=</span> <span class="n">Away3dMesh</span><span class="o">(</span><span class="n">body</span><span class="o">.</span><span class="na">skin</span><span class="o">).</span><span class="n">mesh</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">body</span><span class="o">.</span><span class="na">movable</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">mesh</span><span class="o">.</span><span class="na">material</span> <span class="o">=</span> <span class="n">mat</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">mesh</span><span class="o">.</span><span class="na">ownCanvas</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">mesh</span><span class="o">.</span><span class="na">pushback</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>                  <span class="k">switch</span><span class="o">(</span><span class="n">j</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                      <span class="k">case</span> <span class="mi">1</span><span class="o">:</span>
</span><span class='line'>                          <span class="n">body</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">505</span><span class="o">;</span>
</span><span class='line'>                          <span class="n">body</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">495</span><span class="o">;</span>
</span><span class='line'>                          <span class="k">break</span><span class="o">;</span>
</span><span class='line'>                      <span class="k">case</span> <span class="mi">2</span><span class="o">:</span>
</span><span class='line'>                          <span class="n">body</span><span class="o">.</span><span class="na">z</span> <span class="o">=</span> <span class="mi">505</span><span class="o">;</span>
</span><span class='line'>                          <span class="n">body</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">495</span><span class="o">;</span>
</span><span class='line'>                          <span class="k">break</span><span class="o">;</span>
</span><span class='line'>                      <span class="k">case</span> <span class="mi">3</span><span class="o">:</span>
</span><span class='line'>                          <span class="n">body</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="o">-</span><span class="mi">505</span><span class="o">;</span>
</span><span class='line'>                          <span class="n">body</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">495</span><span class="o">;</span>
</span><span class='line'>                          <span class="k">break</span><span class="o">;</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>              <span class="kd">var</span> <span class="n">paper</span><span class="p">:</span><span class="kt">BitmapMaterial</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapMaterial</span><span class="o">(</span><span class="n">Cast</span><span class="o">.</span><span class="na">bitmap</span><span class="o">(</span><span class="n">jpgPaper</span><span class="o">));</span>
</span><span class='line'>              <span class="k">for</span> <span class="o">(</span><span class="kd">var</span> <span class="n">i</span><span class="p">:</span><span class="kt">int</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="kd">var</span> <span class="n">sphere</span><span class="p">:</span><span class="kt">RigidBody</span> <span class="o">=</span> <span class="n">_physics</span><span class="o">.</span><span class="na">createSphere</span><span class="o">({</span><span class="n">radius</span><span class="o">:</span><span class="mi">30</span><span class="o">,</span> <span class="n">segmentsW</span><span class="o">:</span><span class="mi">6</span><span class="o">,</span> <span class="n">segmentsH</span><span class="o">:</span><span class="mi">6</span><span class="o">});</span>
</span><span class='line'>                  <span class="n">_bodies</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">sphere</span><span class="o">);</span>
</span><span class='line'>                  <span class="n">sphere</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">100</span> <span class="o">-</span> <span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">200</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">sphere</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">700</span> <span class="o">+</span> <span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">3000</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">sphere</span><span class="o">.</span><span class="na">z</span> <span class="o">=</span> <span class="mi">200</span> <span class="o">-</span> <span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">100</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">sphere</span><span class="o">.</span><span class="na">material</span><span class="o">.</span><span class="na">restitution</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>                  <span class="c1">// This is how to access the engine specific mesh/do3d</span>
</span><span class='line'>                  <span class="n">_physics</span><span class="o">.</span><span class="na">getMesh</span><span class="o">(</span><span class="n">sphere</span><span class="o">).</span><span class="n">material</span> <span class="o">=</span> <span class="n">paper</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>                  <span class="kd">var</span> <span class="n">plane</span><span class="p">:</span><span class="kt">Plane</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Plane</span><span class="o">({</span><span class="n">material</span><span class="o">:</span><span class="k">new</span> <span class="kt">BitmapMaterial</span><span class="o">(</span><span class="n">Cast</span><span class="o">.</span><span class="na">bitmap</span><span class="o">(</span><span class="n">pngShadow</span><span class="o">)),</span> <span class="n">height</span><span class="o">:</span><span class="mi">80</span><span class="o">,</span> <span class="n">width</span><span class="o">:</span><span class="mi">80</span><span class="o">,</span> <span class="n">bothsides</span><span class="o">:</span><span class="kc">true</span><span class="o">});</span>
</span><span class='line'>                  <span class="n">plane</span><span class="o">.</span><span class="na">ownCanvas</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">plane</span><span class="o">.</span><span class="na">pushback</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">plane</span><span class="o">.</span><span class="na">filters</span> <span class="o">=</span> <span class="o">[</span><span class="k">new</span> <span class="kt">BlurFilter</span><span class="o">(</span><span class="mi">8</span><span class="o">,</span><span class="mi">8</span><span class="o">)];</span>
</span><span class='line'>                  <span class="n">plane</span><span class="o">.</span><span class="na">blendMode</span> <span class="o">=</span> <span class="n">BlendMode</span><span class="o">.</span><span class="na">SUBTRACT</span><span class="o">;</span>
</span><span class='line'>                  <span class="n">away3dMain</span><span class="o">.</span><span class="na">view</span><span class="o">.</span><span class="na">scene</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">plane</span><span class="o">);</span>
</span><span class='line'>                  <span class="n">_shadows</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">plane</span><span class="o">);</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">// create away3d scene</span>
</span><span class='line'>              <span class="n">away3dMain</span><span class="o">.</span><span class="na">title</span> <span class="o">=</span> <span class="s2">&quot;SavageLook.com -- Away3D JigLib Demo&quot;</span><span class="o">;</span>
</span><span class='line'>              <span class="n">away3dMain</span><span class="o">.</span><span class="na">camera</span><span class="o">.</span><span class="na">position</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Number3D</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">700</span><span class="o">,</span> <span class="o">-</span><span class="mi">1500</span><span class="o">);</span>
</span><span class='line'>              <span class="n">away3dMain</span><span class="o">.</span><span class="na">camera</span><span class="o">.</span><span class="na">lookAt</span><span class="o">(</span><span class="k">new</span> <span class="kt">Number3D</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">// assign pre and post render functions</span>
</span><span class='line'>              <span class="n">away3dMain</span><span class="o">.</span><span class="na">preRender</span> <span class="o">=</span> <span class="kd">function</span><span class="o">():</span><span class="kc">void</span> <span class="o">{</span>
</span><span class='line'>                  <span class="k">for</span> <span class="o">(</span><span class="kd">var</span> <span class="n">k</span><span class="p">:</span><span class="kt">uint</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">k</span> <span class="o">&lt;</span> <span class="n">_shadows</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">k</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>                      <span class="k">if</span> <span class="o">(</span><span class="n">_shadows</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mi">505</span> <span class="o">||</span> <span class="n">_shadows</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">x</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">505</span> <span class="o">||</span> <span class="n">_shadows</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">z</span> <span class="o">&gt;</span> <span class="mi">505</span> <span class="o">||</span> <span class="n">_shadows</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">z</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">505</span> <span class="o">||</span> <span class="n">_bodies</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">y</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">10</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                          <span class="n">_shadows</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">visible</span> <span class="o">=</span> <span class="kc">false</span><span class="o">;</span>
</span><span class='line'>                      <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>                          <span class="n">_shadows</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">x</span> <span class="o">=</span> <span class="n">_bodies</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">x</span><span class="o">;</span>
</span><span class='line'>                          <span class="n">_shadows</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">z</span> <span class="o">=</span> <span class="n">_bodies</span><span class="o">[</span><span class="n">k</span><span class="o">].</span><span class="n">z</span><span class="o">;</span>
</span><span class='line'>                      <span class="o">}</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>                  <span class="n">_physics</span><span class="o">.</span><span class="na">step</span><span class="o">();</span>
</span><span class='line'>              <span class="o">};</span>
</span><span class='line'>              <span class="n">away3dMain</span><span class="o">.</span><span class="na">postRender</span> <span class="o">=</span> <span class="kd">function</span><span class="o">():</span><span class="kc">void</span> <span class="o">{</span> <span class="nf">trace</span><span class="o">(</span><span class="s2">&quot;postRender&quot;</span><span class="o">);</span> <span class="o">};</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="kd">private</span> <span class="kd">function </span><span class="nf">_drawBackground</span><span class="o">():</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>              <span class="kd">var</span> <span class="n">sprite</span><span class="p">:</span><span class="kt">Sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>              <span class="kd">var</span> <span class="n">ui</span><span class="p">:</span><span class="kt">UIComponent</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">UIComponent</span><span class="o">();</span>
</span><span class='line'>              <span class="kd">var</span> <span class="n">matrix</span><span class="p">:</span><span class="kt">Matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Matrix</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>              <span class="n">matrix</span><span class="o">.</span><span class="na">createGradientBox</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">height</span><span class="o">,</span> <span class="n">Math</span><span class="o">.</span><span class="na">PI</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>              <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginGradientFill</span><span class="o">(</span><span class="s2">&quot;linear&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mh">0x888888</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">],</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span><span class="mi">1</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span><span class="mi">255</span><span class="o">],</span> <span class="n">matrix</span><span class="o">);</span>
</span><span class='line'>              <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="k">this</span><span class="o">.</span><span class="na">height</span><span class="o">);</span>
</span><span class='line'>              <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>              <span class="n">ui</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">sprite</span><span class="o">);</span>
</span><span class='line'>              <span class="k">this</span><span class="o">.</span><span class="na">addChildAt</span><span class="o">(</span><span class="n">ui</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>          <span class="o">}</span>
</span><span class='line'>      <span class="o">]]&gt;</span>
</span><span class='line'>    <span class="o">&lt;/</span><span class="n">mx</span><span class="o">:</span><span class="n">Script</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">local</span><span class="o">:</span><span class="n">AwayUIC</span> <span class="n">id</span><span class="o">=</span><span class="s2">&quot;away3dMain&quot;</span>  <span class="n">x</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;0&quot;</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600&quot;</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;800&quot;</span><span class="o">/&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">mx</span><span class="o">:</span><span class="n">Application</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>
</div>


<p>AwayUIC.mxml:</p>

<div style="height:400px; overflow:auto;">

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="o">&lt;?</span><span class="n">xml</span> <span class="n">version</span><span class="o">=</span><span class="s2">&quot;1.0&quot;</span> <span class="n">encoding</span><span class="o">=</span><span class="s2">&quot;utf-8&quot;</span><span class="o">?&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="n">mx</span><span class="o">:</span><span class="n">UIComponent</span> <span class="n">xmlns</span><span class="o">:</span><span class="n">mx</span><span class="o">=</span><span class="s2">&quot;http://www.adobe.com/2006/mxml&quot;</span> <span class="n">width</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;100%&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="n">mx</span><span class="o">:</span><span class="n">Script</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;![</span><span class="n">CDATA</span><span class="o">[</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.debug.AwayStats</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.core.math.Number3D</span><span class="o">;</span>
</span><span class='line'>          <span class="k">import</span> <span class="nn">away3d.cameras.TargetCamera3D</span><span class="o">;</span>
</span><span class='line'>            <span class="k">import</span> <span class="nn">away3d.containers.View3D</span><span class="o">;</span>
</span><span class='line'>            <span class="k">import</span> <span class="nn">away3d.core.render.Renderer</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">var</span> <span class="n">view</span><span class="p">:</span><span class="kt">View3D</span><span class="o">;</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">var</span> <span class="n">camera</span><span class="p">:</span><span class="kt">TargetCamera3D</span><span class="o">;</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">var</span> <span class="n">doRender</span><span class="p">:</span><span class="kt">Boolean</span><span class="o">;</span>
</span><span class='line'>            <span class="kd">private</span> <span class="kd">var</span> <span class="n">_title</span><span class="p">:</span><span class="kt">String</span><span class="o">;</span>
</span><span class='line'>            <span class="kd">private</span> <span class="kd">var</span> <span class="n">_link</span><span class="p">:</span><span class="kt">String</span><span class="o">;</span>
</span><span class='line'>            <span class="kd">private</span> <span class="kd">var</span> <span class="n">_titleText</span><span class="p">:</span><span class="kt">TextField</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">var</span> <span class="n">preRender</span><span class="p">:</span><span class="kt">Function</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">var</span> <span class="n">postRender</span><span class="p">:</span><span class="kt">Function</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">override</span> <span class="kd">protected</span> <span class="kd">function </span><span class="nf">createChildren</span><span class="o">():</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>                <span class="kd">super</span><span class="o">.</span><span class="na">createChildren</span><span class="o">();</span>
</span><span class='line'>                <span class="n">doRender</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// setup camera</span>
</span><span class='line'>                <span class="n">camera</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">TargetCamera3D</span><span class="o">();</span>
</span><span class='line'>                <span class="n">camera</span><span class="o">.</span><span class="na">position</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Number3D</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">-</span><span class="mi">1000</span><span class="o">);</span>
</span><span class='line'>              <span class="n">camera</span><span class="o">.</span><span class="na">lookAt</span><span class="o">(</span><span class="k">new</span> <span class="kt">Number3D</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">,</span><span class="mi">0</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// setup view</span>
</span><span class='line'>                <span class="n">view</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">View3D</span><span class="o">({</span><span class="n">camera</span><span class="o">:</span><span class="n">camera</span><span class="o">,</span> <span class="n">renderer</span><span class="o">:</span><span class="n">Renderer</span><span class="o">.</span><span class="na">BASIC</span><span class="o">});</span>
</span><span class='line'>                <span class="n">view</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">unscaledWidth</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span>
</span><span class='line'>                <span class="n">view</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="k">this</span><span class="o">.</span><span class="na">unscaledHeight</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span>
</span><span class='line'>                <span class="k">this</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>                <span class="c1">// add stats and title</span>
</span><span class='line'>                <span class="kd">var</span> <span class="n">stats</span><span class="p">:</span><span class="kt">AwayStats</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">AwayStats</span><span class="o">(</span><span class="n">view</span><span class="o">);</span>
</span><span class='line'>                <span class="k">this</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">stats</span><span class="o">);</span>
</span><span class='line'>                <span class="n">_title</span> <span class="o">=</span> <span class="s2">&quot;SavageLook.com&quot;</span><span class="o">;</span>
</span><span class='line'>                <span class="n">_link</span> <span class="o">=</span> <span class="s2">&quot;http://savagelook.com/blog&quot;</span><span class="o">;</span>
</span><span class='line'>                <span class="n">_setText</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">this</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">ENTER_FRAME</span><span class="o">,</span> <span class="kd">function</span><span class="o">(</span><span class="n">e</span><span class="o">:</span><span class="n">Event</span><span class="o">):</span><span class="kc">void</span> <span class="o">{</span> <span class="n">_render</span><span class="o">();</span> <span class="o">});</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">private</span> <span class="kd">function </span><span class="nf">_setText</span><span class="o">():</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="o">(</span><span class="n">_titleText</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">_titleText</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">TextField</span><span class="o">();</span>
</span><span class='line'>                  <span class="k">this</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">_titleText</span><span class="o">);</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>                <span class="n">_titleText</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="n">_title</span><span class="o">;</span>
</span><span class='line'>                <span class="n">_titleText</span><span class="o">.</span><span class="na">setTextFormat</span><span class="o">(</span><span class="k">new</span> <span class="kt">TextFormat</span><span class="o">(</span><span class="s2">&quot;arial&quot;</span><span class="o">,</span> <span class="mi">14</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="n">_link</span><span class="o">));</span>
</span><span class='line'>                <span class="n">_titleText</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">150</span><span class="o">;</span>
</span><span class='line'>                <span class="n">_titleText</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
</span><span class='line'>                <span class="n">_titleText</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="n">_titleText</span><span class="o">.</span><span class="na">textWidth</span> <span class="o">*</span> <span class="mf">1.1</span><span class="o">;</span>
</span><span class='line'>                <span class="n">_titleText</span><span class="o">.</span><span class="na">filters</span> <span class="o">=</span> <span class="o">[</span><span class="k">new</span> <span class="kt">DropShadowFilter</span><span class="o">()];</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">function</span> <span class="kd">get</span> <span class="n">link</span><span class="o">():</span><span class="n">String</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">_link</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">function</span> <span class="kd">set</span> <span class="n">link</span><span class="o">(</span><span class="n">value</span><span class="o">:</span><span class="n">String</span><span class="o">):</span><span class="kc">void</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">_link</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>              <span class="n">_setText</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">function</span> <span class="kd">get</span> <span class="n">title</span><span class="o">():</span><span class="n">String</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">return</span> <span class="n">_title</span><span class="o">;</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">public</span> <span class="kd">function</span> <span class="kd">set</span> <span class="n">title</span><span class="o">(</span><span class="n">value</span><span class="o">:</span><span class="n">String</span><span class="o">):</span><span class="kc">void</span> <span class="o">{</span>
</span><span class='line'>              <span class="n">_title</span> <span class="o">=</span> <span class="n">value</span><span class="o">;</span>
</span><span class='line'>              <span class="n">_setText</span><span class="o">();</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">override</span> <span class="kd">protected</span> <span class="kd">function </span><span class="nf">updateDisplayList</span><span class="o">(</span><span class="n">unscaledWidth</span><span class="o">:</span><span class="kt">Number</span><span class="o">,</span> <span class="n">unscaledHeight</span><span class="o">:</span><span class="kt">Number</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>                <span class="kd">super</span><span class="o">.</span><span class="na">updateDisplayList</span><span class="o">(</span><span class="n">unscaledWidth</span><span class="o">,</span> <span class="n">unscaledHeight</span><span class="o">);</span>
</span><span class='line'>                <span class="n">view</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">unscaledWidth</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span>
</span><span class='line'>                <span class="n">view</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">unscaledHeight</span><span class="o">/</span><span class="mi">2</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>                <span class="k">if</span> <span class="o">(</span><span class="n">view</span><span class="o">.</span><span class="na">stage</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="n">_render</span><span class="o">();</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>            <span class="kd">private</span> <span class="kd">function </span><span class="nf">_render</span><span class="o">():</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="o">(</span><span class="n">doRender</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                  <span class="k">if</span> <span class="o">(</span><span class="n">preRender</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">preRender</span><span class="o">();</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>                  <span class="n">view</span><span class="o">.</span><span class="na">render</span><span class="o">();</span>
</span><span class='line'>                  <span class="k">if</span> <span class="o">(</span><span class="n">postRender</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>                      <span class="n">postRender</span><span class="o">();</span>
</span><span class='line'>                  <span class="o">}</span>
</span><span class='line'>              <span class="o">}</span>
</span><span class='line'>            <span class="o">}</span>
</span><span class='line'>        <span class="o">]]&gt;</span>
</span><span class='line'>  <span class="o">&lt;/</span><span class="n">mx</span><span class="o">:</span><span class="n">Script</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">mx</span><span class="o">:</span><span class="n">UIComponent</span><span class="o">&gt;</span>
</span></code></pre></td></tr></table></div></figure>

</div>




<h1>The Summary</h1>


<p>My hasty opinion in this case is that JigLib is fun to play with, but don&#8217;t get excited about doing anything super complex&#8230; yet.  I follow a few of the developers and contributors and they are constantly working on it.  They even just recently added support for <a href="http://away3d.com/away3d-lite-v1-0-fastest-and-smallest-3d-engine-in-flash" target="_blank">Away3dLite</a> so you can use all that quick rendering goodness along with it.  I fully intend to follow this project closely as it matures.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/31/reflection-in-away3d/">Reflection in Away3D</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-31T15:57:00-04:00" pubdate data-updated="true">Aug 31<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/reflect_away3d/reflect_away3d.html" class="fancybox.iframe"><img title="reflect_away3d" src="/images/reflect3.jpg" alt="" width="584" height="304" /></a></p>


<p>→ <a class="fancybox.iframe" href="/demos/reflect_away3d/reflect_away3d.html">Click here</a> or the image above for the reflection demo
→ <a href="/demos/reflect_away3d/srcview/index.html">View the source code</a></p>

<p>I alluded to a desire to implement reflections in Away3D in my prior post on reflections in AS3.  Well here it is.  It wasn&#8217;t quite as easy of a translation as I thought it would be, but with lots of digging through the <a href="http://groups.google.com/group/away3d-dev/browse_thread/thread/4b520ebf4f7953d7/0052eb24c4178190" target="_blank">Away3D dev list</a>, as well as spotting a good example at <a href="http://www.geepers.co.uk/software/viewreflection.html" target="_blank">geepers.co.uk</a>, I managed to get a basic demo up and running.</p>

<p>While there&#8217;s a good bit of code that goes into this demo, the secret sauce is right here:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="c1">// must render before making the following calls</span>
</span><span class='line'><span class="n">_view</span><span class="o">.</span><span class="na">render</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// find 2d bounding box of sphere</span>
</span><span class='line'><span class="n">_drawn</span> <span class="o">=</span> <span class="o">(</span><span class="n">_view</span><span class="o">.</span><span class="na">session</span><span class="o">.</span><span class="na">getContainer</span><span class="o">(</span><span class="n">_view</span><span class="o">)</span> <span class="k">as</span> <span class="n">DisplayObjectContainer</span><span class="o">).</span><span class="n">getChildAt</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
</span><span class='line'><span class="n">_bounds</span> <span class="o">=</span> <span class="n">_drawn</span><span class="o">.</span><span class="na">getRect</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>What this code does is give us the DisplayObject that contains our 3D object within the given view.  We are also able to determine the bounds of the DisplayObject and its 2 dimensional position within the view.  With this information we are able to effectively create a snapshot of the visible 3d object.  From there we need to create BitmapData that is the inverse of the DisplayObject.  To do that we apply the appropriate matrix (invert the y scale) to the DisplayObject when it is drawn to BitmapData.  After that we assign the BitmapData to the display Bitmap and then position it according to the bounds of the DisplayObject.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="c1">// redraw reflection</span>
</span><span class='line'><span class="n">_bmd</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapData</span><span class="o">(</span><span class="n">_drawn</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">_drawn</span><span class="o">.</span><span class="na">height</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="mh">0x00ffffff</span><span class="o">);</span>
</span><span class='line'><span class="n">_matrix</span><span class="o">.</span><span class="na">createBox</span><span class="o">(</span><span class="n">_xscale</span><span class="o">,</span> <span class="o">-</span><span class="n">_yscale</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_drawn</span><span class="o">.</span><span class="na">width</span><span class="sr">/2, _drawn.height * _yscale /</span> <span class="mi">2</span><span class="o">);</span>
</span><span class='line'><span class="n">_bmd</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">_drawn</span><span class="o">,</span> <span class="n">_matrix</span><span class="o">);</span>
</span><span class='line'><span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">bitmapData</span> <span class="o">=</span> <span class="n">_bmd</span><span class="o">;</span>
</span><span class='line'><span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">_bounds</span><span class="o">.</span><span class="na">x</span><span class="o">;</span>
</span><span class='line'><span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageHeight</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">_distance</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Finally we create an alpha gradient mask that will be applied to the Bitmap in order to give it that cool, fading reflection look.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="c1">// redraw gradient mask for reflection</span>
</span><span class='line'><span class="n">_matrix</span><span class="o">.</span><span class="na">createGradientBox</span><span class="o">(</span><span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">height</span> <span class="o">*</span> <span class="n">_yscale</span> <span class="sr">/ 2, Math.PI /</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'><span class="n">_bitmapReflectGradient</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span><span class='line'><span class="n">_bitmapReflectGradient</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginGradientFill</span><span class="o">(</span><span class="s2">&quot;linear&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mh">0xffffff</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">],</span> <span class="o">[</span><span class="mf">0.9</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">],</span> <span class="n">_matrix</span><span class="o">);</span>
</span><span class='line'><span class="n">_bitmapReflectGradient</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">height</span><span class="o">);</span>
</span><span class='line'><span class="n">_bitmapReflectGradient</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'><span class="n">_bitmapReflectGradient</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">x</span><span class="o">;</span>
</span><span class='line'><span class="n">_bitmapReflectGradient</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">_bitmapReflect</span><span class="o">.</span><span class="na">y</span><span class="o">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And there you go, reflections in Away3D.  There are a number of limitations to this method, though:</p>

<ul>
    <li>It can only draw reflections of objects currently visible in the view.  In fact, there should be a check on the
<em>(_view.session.getContainer(_view) as DisplayObjectContainer).getChildAt(0) </em>
call to make sure that the view contains any children.</li>
    <li>The reflection is drawn of the entire view, not just the object in question.  That&#8217;s why this works best with only one object in the view.  You can use multiple views to get reflections for multiple objects.</li>
    <li>This example only does reflections of the view as its manipulated along the X &amp; Y planes.  Moving the object along the Z plane will not effect the reflection properly.  I&#8217;m sure a method utilizing planes could do better.</li>
</ul>


<p>If those limitations don&#8217;t bother you, then go to town.  If they do, be patient.  I&#8217;m working on another idea for reflection in Away3D that will be a lot more flexible, though more complex and processor intensive.</p>

<p>Remember how my previous blog post on shadows (of course you do) showed how you can easily enhance the 3D feel of your site?  Of course you do.  Now you can add reflections to that repetoire.  It&#8217;s all about subtle changes to give your work a more polished look and feel.  Have fun and let me know if you create reflections this way, or if you have an implementation of your own.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/25/reflection-in-as3/">Reflection in AS3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-25T15:41:00-04:00" pubdate data-updated="true">Aug 25<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Inspired by this <a href="http://www.adobe.com/devnet/flash/articles/reflect_class_as3.html" target="_blank">tutorial on reflections in AS3</a> at adobe devnet, I decided to play with reflections in Actionscript3.  As usual I can never follow a tutorial or step by step process without constantly trying to tweak it.</p>

<p>In my process of tweaking I found a slight short coming in the example given.  While it does a fantastic job of handling standard DisplayObjects, I found that things get a little messed up when you add filters to these objects.  Notice how the edges of the first image are cut off and sharp, whereas the the second image that accounts for the filters&#8217; impact on DisplayObjects&#8217; dimensions looks smooth:</p>

<div style="margin-left: auto; margin-right: auto; width: 450px;">

</div>


<p>In my efforts to remedy this problem I came across a very useful function for BitmapData called <a href="http://www.adobe.com/livedocs/flash/9.0/ActionScriptLangRefV3/flash/display/BitmapData.html#generateFilterRect()" target="_blank">generateFilterRect()</a>.  Given a Rectangle and a BitmapFilter this function will return the Rectangle that would actually encompass the DisplayObject along with its filter.  With a simple bit of iteration we can traverse an object&#8217;s list of filters and determine what the max dimensions will be.  Here&#8217;s the function I added to take care of it:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="kd">private</span> <span class="kd">function </span><span class="nf">_createReflectionBitmapData</span><span class="o">(</span><span class="n">obj</span><span class="o">:</span><span class="kt">Sprite</span><span class="o">):</span><span class="kt">BitmapData</span> <span class="o">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">filterRect</span><span class="p">:</span><span class="kt">Rectangle</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">width</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">width</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">height</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">height</span><span class="o">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">bmd</span><span class="p">:</span><span class="kt">BitmapData</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapData</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="n">matrix</span><span class="p">:</span><span class="kt">Matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Matrix</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// filters can cause a display object to render outside of its rectangle</span>
</span><span class='line'>  <span class="k">for</span> <span class="k">each</span> <span class="o">(</span><span class="kd">var</span> <span class="n">filter</span><span class="p">:</span><span class="kt">BitmapFilter</span> <span class="k">in</span> <span class="n">obj</span><span class="o">.</span><span class="na">filters</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">filterRect</span> <span class="o">=</span> <span class="n">bmd</span><span class="o">.</span><span class="na">generateFilterRect</span><span class="o">(</span><span class="n">bmd</span><span class="o">.</span><span class="na">rect</span><span class="o">,</span> <span class="n">filter</span><span class="o">);</span>
</span><span class='line'>    <span class="n">width</span> <span class="o">=</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">width</span> <span class="o">&gt;</span> <span class="n">width</span> <span class="o">?</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">width</span> <span class="o">:</span> <span class="n">width</span><span class="o">;</span>
</span><span class='line'>    <span class="n">height</span> <span class="o">=</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">height</span> <span class="o">&gt;</span> <span class="n">height</span> <span class="o">?</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">height</span> <span class="o">:</span> <span class="n">height</span><span class="o">;</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// create, invert, and position relfection bitmapdata</span>
</span><span class='line'>  <span class="n">bmd</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapData</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">);</span>
</span><span class='line'>  <span class="n">matrix</span><span class="o">.</span><span class="na">createBox</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="na">width</span><span class="o">)/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span> <span class="o">-</span> <span class="o">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="na">height</span><span class="o">)/</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'>  <span class="n">bmd</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">matrix</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="n">bmd</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The end result is BitmapData that contains our inverted DisplayObject, now properly sized and positioned.  We can now pass this into a Bitmap object and continue on with the code in the tutorial mentioned at the beginning of this post.  Or&#8230; you can use my stripped down and less functional version to get a simple view of how reflections are achieved in AS3:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="kd">package</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.display.Bitmap</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.display.BitmapData</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.display.DisplayObject</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.display.Sprite</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.events.Event</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.filters.BitmapFilter</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.filters.GlowFilter</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.geom.Matrix</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.geom.Rectangle</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="cm">/**</span>
</span><span class='line'><span class="cm">   * ...</span>
</span><span class='line'><span class="cm">   * @author Tony Lukasavage - SavageLook.com</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="n">Main</span> <span class="kd">extends</span> <span class="n">Sprite</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">Main</span><span class="o">():</span><span class="kt">void</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">stage</span><span class="o">)</span> <span class="n">init</span><span class="o">();</span>
</span><span class='line'>      <span class="k">else</span> <span class="n">addEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">ADDED_TO_STAGE</span><span class="o">,</span> <span class="n">init</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">function </span><span class="nf">init</span><span class="o">(</span><span class="n">e</span><span class="o">:</span><span class="kt">Event</span> <span class="o">=</span> <span class="kc">null</span><span class="o">):</span><span class="kt">void</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="n">removeEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">ADDED_TO_STAGE</span><span class="o">,</span> <span class="n">init</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// create main glow circle</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">obj</span><span class="p">:</span><span class="kt">Sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">matrix</span><span class="p">:</span><span class="kt">Matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Matrix</span><span class="o">();</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">radius</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="mi">100</span><span class="o">;</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">.</span><span class="na">createGradientBox</span><span class="o">(</span><span class="n">radius</span><span class="o">*</span><span class="mi">2</span><span class="o">,</span> <span class="n">radius</span><span class="o">*</span><span class="mi">2</span><span class="o">,</span> <span class="n">Math</span><span class="o">.</span><span class="na">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="o">);</span>
</span><span class='line'>      <span class="n">obj</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginGradientFill</span><span class="o">(</span><span class="s2">&quot;linear&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mh">0x888888</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">],</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">],</span> <span class="n">matrix</span><span class="o">);</span>
</span><span class='line'>      <span class="n">obj</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawCircle</span><span class="o">(</span><span class="n">radius</span><span class="o">,</span> <span class="n">radius</span><span class="o">,</span> <span class="n">radius</span><span class="o">);</span>
</span><span class='line'>      <span class="n">obj</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>      <span class="n">obj</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageWidth</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">radius</span><span class="o">;</span>
</span><span class='line'>      <span class="n">obj</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageHeight</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">radius</span><span class="o">*</span><span class="mf">1.5</span><span class="o">;</span>
</span><span class='line'>      <span class="n">obj</span><span class="o">.</span><span class="na">filters</span> <span class="o">=</span> <span class="o">[</span><span class="k">new</span> <span class="kt">GlowFilter</span><span class="o">(</span><span class="mh">0xffffff</span><span class="o">,</span> <span class="mi">1</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">20</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">1</span><span class="o">)];</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// create reflection</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">bmd</span><span class="p">:</span><span class="kt">BitmapData</span> <span class="o">=</span> <span class="n">_createReflectionBitmapData</span><span class="o">(</span><span class="n">obj</span><span class="o">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">bitmapReflect</span><span class="p">:</span><span class="kt">Bitmap</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Bitmap</span><span class="o">(</span><span class="n">bmd</span><span class="o">);</span>
</span><span class='line'>      <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageWidth</span> <span class="sr">/ 2 - bitmapReflect.width/</span><span class="mi">2</span><span class="o">;</span>
</span><span class='line'>      <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">y</span> <span class="o">+</span> <span class="n">radius</span><span class="o">*</span><span class="mi">2</span><span class="o">;</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">bitmapReflect</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// create gradient for reflection</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">grad</span><span class="p">:</span><span class="kt">Sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">.</span><span class="na">createGradientBox</span><span class="o">(</span><span class="n">bitmapReflect</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">height</span> <span class="sr">/ 2, Math.PI /</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">grad</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginGradientFill</span><span class="o">(</span><span class="s2">&quot;linear&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mh">0xffffff</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">],</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">],</span> <span class="n">matrix</span><span class="o">);</span>
</span><span class='line'>      <span class="n">grad</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">width</span><span class="o">,</span> <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">height</span><span class="o">);</span>
</span><span class='line'>      <span class="n">grad</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">x</span><span class="o">;</span>
</span><span class='line'>      <span class="n">grad</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">y</span><span class="o">;</span>
</span><span class='line'>      <span class="n">grad</span><span class="o">.</span><span class="na">cacheAsBitmap</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>      <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">cacheAsBitmap</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>      <span class="n">bitmapReflect</span><span class="o">.</span><span class="na">mask</span> <span class="o">=</span> <span class="n">grad</span><span class="o">;</span>
</span><span class='line'>      <span class="k">this</span><span class="o">.</span><span class="na">addChild</span><span class="o">(</span><span class="n">grad</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">function </span><span class="nf">_createReflectionBitmapData</span><span class="o">(</span><span class="n">obj</span><span class="o">:</span><span class="kt">Sprite</span><span class="o">):</span><span class="kt">BitmapData</span> <span class="o">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">filterRect</span><span class="p">:</span><span class="kt">Rectangle</span><span class="o">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">width</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">width</span><span class="o">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">height</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="na">height</span><span class="o">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">bmd</span><span class="p">:</span><span class="kt">BitmapData</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapData</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">matrix</span><span class="p">:</span><span class="kt">Matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Matrix</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// filters can cause a display object to render outside of its rectangle</span>
</span><span class='line'>      <span class="k">for</span> <span class="k">each</span> <span class="o">(</span><span class="kd">var</span> <span class="n">filter</span><span class="p">:</span><span class="kt">BitmapFilter</span> <span class="k">in</span> <span class="n">obj</span><span class="o">.</span><span class="na">filters</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">filterRect</span> <span class="o">=</span> <span class="n">bmd</span><span class="o">.</span><span class="na">generateFilterRect</span><span class="o">(</span><span class="n">bmd</span><span class="o">.</span><span class="na">rect</span><span class="o">,</span> <span class="n">filter</span><span class="o">);</span>
</span><span class='line'>        <span class="n">width</span> <span class="o">=</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">width</span> <span class="o">&gt;</span> <span class="n">width</span> <span class="o">?</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">width</span> <span class="o">:</span> <span class="n">width</span><span class="o">;</span>
</span><span class='line'>        <span class="n">height</span> <span class="o">=</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">height</span> <span class="o">&gt;</span> <span class="n">height</span> <span class="o">?</span> <span class="n">filterRect</span><span class="o">.</span><span class="na">height</span> <span class="o">:</span> <span class="n">height</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// create, invert, and position relfection bitmapdata</span>
</span><span class='line'>      <span class="n">bmd</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">BitmapData</span><span class="o">(</span><span class="n">width</span><span class="o">,</span> <span class="n">height</span><span class="o">,</span> <span class="kc">true</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">);</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">.</span><span class="na">createBox</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="o">-</span><span class="mi">1</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="o">(</span><span class="n">width</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="na">width</span><span class="o">)/</span><span class="mi">2</span><span class="o">,</span> <span class="n">height</span> <span class="o">-</span> <span class="o">(</span><span class="n">height</span> <span class="o">-</span> <span class="n">obj</span><span class="o">.</span><span class="na">height</span><span class="o">)/</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'>      <span class="n">bmd</span><span class="o">.</span><span class="na">draw</span><span class="o">(</span><span class="n">obj</span><span class="o">,</span> <span class="n">matrix</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">return</span> <span class="n">bmd</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And thats the basics.  If you want an in depth description of each step and how they are performed, I will again refer you to the <a href="http://www.adobe.com/devnet/flash/articles/reflect_class_as3.html" target="_blank">terrific tutorial by Ben Pritchard</a>.  In the meantime, enjoy your new found knowledge and start putting it to use.  Everyone else is.  Seriously.  Like every image anymore has a reflection under it.  This is really starting to irk my &#8220;swim against the current&#8221; side.  Oh well, nothing a glass of Jack can&#8217;t cure.</p>

<p>Is everyone doing this in Away3D?  No?  Well you can add me to the list soon ;)</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/23/adobe-alchemy/">Adobe Alchemy</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-23T07:26:00-04:00" pubdate data-updated="true">Aug 23<span>rd</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><a href="http://labs.adobe.com/" target="_blank">Adobe Labs</a> has a prerelease project called <a href="http://labs.adobe.com/technologies/alchemy/" target="_blank">Alchemy</a>, which allows you to compile C/C++ code into SWC libraries that are usable in your AS3 code.  For a former C/C++ coder like myself, this is music to my ears, but those without that background might be wondering why the hell you would even bother.  Well, there&#8217;s 2 major points to consider:</p>

<ul>
    <li>You&#8217;ll be able to use the existing mountains of C/C++ libraries in your AS3 without having to create a port.</li>
    <li>To quote the Adobe Alchemy page:  <em>(Its) ideally suited for computation-intensive use cases, such as audio/video transcoding, data manipulation, XML parsing, cryptographic functions or physics simulation, performance can be considerably faster than ActionScript 3.0&#8230;</em></li>
</ul>


<p>Now before you go getting all excited to compile your favorite C/C++ library into an SWC, there are some things to consider:</p>

<ul>
    <li>The more OS and other library dependencies your compiling target has, the less likely it is to work.</li>
    <li>This is a prerelease labs project, so expect bugs and lots of visits to the <a href="http://forums.adobe.com/community/labs/alchemy" target="_blank">Alchemy forums</a>.  This should probably not be used for production code.</li>
    <li>Adobe has not made it clear whether or not they plan to continue development of Alchemy, or whether it will ever be rolled into an official release.</li>
</ul>


<p>If that hasn&#8217;t scared you off I&#8217;d highly suggest going to the <a href="http://labs.adobe.com/technologies/alchemy/" target="_blank">Alchemy project page</a> to get your necessary downloads and then heading immediately to the <a href="http://labs.adobe.com/wiki/index.php/Alchemy:Documentation:Getting_Started" target="_blank">&#8220;Getting Started&#8221; page</a> to setup up your development environment.  See if you can get their basic stringecho.c program working.  Once you have built your environment and compiled your first SWC for use in your AS3 code, it&#8217;s time to actually build your own Alchemy version of a C/C++ library.  Here&#8217;s a few examples of libraries that have been successfully ported to AS3 via Alchemy:</p>

<ul>
    <li>OggVorbis and Crypto from the <a href="http://labs.adobe.com/wiki/index.php/Alchemy:Libraries" target="_blank">Alchemy ports page</a></li>
    <li><a href="http://wiki.github.com/jesses/wck/box2d-flash-alchemy-port" target="_blank">Box2D Physics Engine</a></li>
    <li><a href="http://www.libspark.org/svn/as3/FLARToolKit/branches/alchemy/" target="_blank">FLARToolkit Augmented Reality Library</a></li>
    <li><a href="http://www.peternitsch.net/demo/aa-lib/index.html" target="_blank">aalib Ascii Art Library</a></li>
</ul>


<div style="margin-left: auto; margin-right: auto; width: 450px;">

</div>


<p>Now remember how I said you would inevitably run into bugs?  Yeah, that&#8217;s gonna happen, it wasn&#8217;t just a maybe.  Well, here&#8217;s a list of bugs I&#8217;ve run into so far (in attempting to port <a href="http://www.ijg.org/" target="_blank">IJG&#8217;s JPEG library</a>) and what I had to do to work around them.  And by &#8220;work around them&#8221; I mean &#8220;what people on the Alchemy forums did to work around them.&#8221;</p>

<ul>
    <li>
<h3 style="text-decoration: underline;">adl.exe stuck</h3>
<pre lang="bash">checking whether we are cross compiling... \
$FLEX_HOME/bin/adl.exe c:\\cygwin/tmp/t35f0.0/app.xml \
2> /tmp/adl.trace &amp; echo $!</pre>
Cygwin must installed at C:\cygwin because Swfbridge, which loads AIR apps on the fly during configure scripts, is hardcoded to reference C:\cygwin.  <br><br>If you are working on a Linux system and get a similar error, make sure that you can execute your $FLEX_HOME/bin/adl file successfully.  The executable for the standard Flex 3.2 SDK does not include a valid Linux ADL, only Windows and Mac.  For a Linux version, download the <a href="http://www.adobe.com/products/air/tools/sdk/" target="_blank">AIR SDK for Linux</a> and use its ADL.</li>
    <li>
<h3 style="text-decoration: underline;">Bad regex in achack/gcc</h3>
<pre lang="bash">Compiler] Error #1084: Syntax error: expecting identifier before \
leftbrace.
    91011.achacks.as, Ln 1, Col 18:
    package cmodule. {</pre>
Change line 274 of $ALCHEMY_HOME/achacks/gcc in the following way:
<pre lang="perl">#if($o =~ /([^\.]*)/)
if($o =~ /([^\/\.]+)(\..*)*$/)</pre>
or just replace $ALCHEMY_HOME/achacks/gcc with <a href="http://savagelook.com/misc/gcc">this fixed version</a>.</li>
    <li>
<h3 style="text-decoration: underline;">Missing asmachine.abc</h3>
<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="o">[</span>Compiler<span class="o">]</span> Error <span class="c">#1063: Unable to open file: \</span>
</span><span class='line'><span class="nv">$ALCHEMY_HOME</span>/avm2-libc/lib/asmachine.abc.
</span></code></pre></td></tr></table></div></figure>

Don&#8217;t compile shared libraries, only static.  You can usually set this in a configure script using &#8220;&#8211;enable-shared=no &#8211;enable-static=yes&#8221;.  You can also pass the &#8220;-static&#8221; option to gcc directly when compiling.</li>
</ul>


<p>That&#8217;s the list so far, but I&#8217;m sure there&#8217;ll be more.  When all else fails, be sure to check the your /tmp directory for log files.  I hope its saves anyone reading this a few hours as thats how long it took me to track these all down as an Alchemy noob.  If you have the brains, guts, and patience to churn out an Alchemy port of a C/C++ library, leave a comment and let me know about it.  Hopefully if enough of us do some real head turning work with it Adobe will actually put some serious effort into an actual supported release.  Keep your fingers crossed.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/18/box2dflashas3-v2-1a-helloworld/">Box2DFlashAS3 v2.1a HelloWorld</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-18T14:34:00-04:00" pubdate data-updated="true">Aug 18<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/box2d/box2d.swf" class="fancybox.iframe"><img title="box2d" src="/images/box2d.jpg" alt="" width="516" height="487" /></a></p>


<p>Click the image above for the demo.
<a href="/demos/box2d/srcview/index.html" target="_self">Click here</a> or right click on the demo to view the source code.</p>

<p>Inspired by <a href="http://www.youtube.com/watch?v=mnyynpq-TXo" target="_blank">this clip</a> of Box2D running on Android, I decided to dive into this 2D physics engine I have heard so much about.  While the version of Box2D I used is the AS3 version called <a href="http://www.box2dflash.org/" target="_blank">Box2DFlashAS3</a>, the <a href="http://www.box2d.org/" target="_blank">original version</a> is written in C++.  Basically it very simply lets you apply 2D physics to your objects, or &#8220;bodies,&#8221; in AS3.</p>

<p>Most of the examples and tutorials I saw were lacking 2 things:</p>

<ol>
    <li> A way to apply sprites to my &#8220;bodies&#8221; without the use of a flash project (FLA) file.</li>
    <li>Code that was compatible with the latest version of Box2DFlashAS3, v2.1a at the time of this post.</li>
</ol>


<p>So to resolve that situation, or to account for my search engine deficiency, I present the HelloWorld example from the Box2DFlashAS3 2.1a distribution modified to be pure AS3:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="kd">package</span> <span class="o">{</span>
</span><span class='line'>  <span class="cm">/*</span>
</span><span class='line'><span class="cm">   * Tony Lukasavage - SavageLook.com - 8/18/2010</span>
</span><span class='line'><span class="cm">   * Box2DFlashAS3 2.1a HelloWorld example, minus the need for an accompanying FLA</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   * This the basic Box2DFlashAS3 HelloWorld.as file from the source distribution</span>
</span><span class='line'><span class="cm">   * with some adjustments made so that you do not need an FLA file to compile and</span>
</span><span class='line'><span class="cm">   * run the code.  A simple bonus for us pure AS3 guys.  Also a few minor modifications</span>
</span><span class='line'><span class="cm">   * are made to account for changes between version 2.0 and 2.1, like adding a type</span>
</span><span class='line'><span class="cm">   * for body definitions.  Finally, I threw in an click handler to toggle between</span>
</span><span class='line'><span class="cm">   * normal and debug drawing.</span>
</span><span class='line'><span class="cm">   *</span>
</span><span class='line'><span class="cm">   */</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">import</span> <span class="nn">Box2D.Collision.</span><span class="o">*;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">Box2D.Collision.Shapes.</span><span class="o">*;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">Box2D.Common.Math.</span><span class="o">*;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">Box2D.Dynamics.</span><span class="o">*;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">import</span> <span class="nn">__AS3__.vec.Vector</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">import</span> <span class="nn">com.adobe.viewsource.ViewSource</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.display.Sprite</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.events.Event</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.events.MouseEvent</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.geom.Matrix</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.text.TextField</span><span class="o">;</span>
</span><span class='line'>  <span class="k">import</span> <span class="nn">flash.text.TextFormat</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">[</span><span class="n">SWF</span><span class="o">(</span><span class="n">width</span><span class="o">=</span><span class="s2">&quot;800&quot;</span><span class="o">,</span> <span class="n">height</span><span class="o">=</span><span class="s2">&quot;600&quot;</span><span class="o">,</span> <span class="n">frameRate</span><span class="o">=</span><span class="s2">&quot;30&quot;</span><span class="o">)]</span>
</span><span class='line'>  <span class="kd">public</span> <span class="kd">class</span> <span class="n">box2d</span> <span class="kd">extends</span> <span class="n">Sprite</span>
</span><span class='line'>  <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_world</span><span class="p">:</span><span class="kt">b2World</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_velocityIterations</span><span class="p">:</span><span class="kt">int</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_positionIterations</span><span class="p">:</span><span class="kt">int</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_timeStep</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="mf">30.0</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_showDebug</span><span class="p">:</span><span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_debugSprite</span><span class="p">:</span><span class="kt">Sprite</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">var</span> <span class="n">_bodySprites</span><span class="p">:</span><span class="kt">Vector</span><span class="o">.</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Vector</span><span class="o">.();</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Box2D uses meters for measurement, AS3 uses pixels.  1 meter = 30 pixels</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">var</span> <span class="n">_worldRatio</span><span class="p">:</span><span class="kt">int</span> <span class="o">=</span> <span class="mi">30</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">box2d</span><span class="o">()</span>
</span><span class='line'>    <span class="o">{</span>
</span><span class='line'>      <span class="c1">// Add event for main loop</span>
</span><span class='line'>      <span class="n">addEventListener</span><span class="o">(</span><span class="n">Event</span><span class="o">.</span><span class="na">ENTER_FRAME</span><span class="o">,</span> <span class="n">Update</span><span class="o">,</span> <span class="kc">false</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="kc">true</span><span class="o">);</span>
</span><span class='line'>      <span class="n">stage</span><span class="o">.</span><span class="na">addEventListener</span><span class="o">(</span><span class="n">MouseEvent</span><span class="o">.</span><span class="na">CLICK</span><span class="o">,</span> <span class="n">onClick</span> <span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// add background gradient</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">bg</span><span class="p">:</span><span class="kt">Sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">matrix</span><span class="p">:</span><span class="kt">Matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Matrix</span><span class="o">();</span>
</span><span class='line'>      <span class="n">matrix</span><span class="o">.</span><span class="na">createGradientBox</span><span class="o">(</span><span class="n">stage</span><span class="o">.</span><span class="na">stageWidth</span><span class="o">,</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageHeight</span><span class="o">,</span> <span class="n">Math</span><span class="o">.</span><span class="na">PI</span><span class="o">/</span><span class="mi">2</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
</span><span class='line'>      <span class="n">bg</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginGradientFill</span><span class="o">(</span><span class="s2">&quot;linear&quot;</span><span class="o">,</span> <span class="o">[</span><span class="mh">0x9999ff</span><span class="o">,</span> <span class="mh">0xffffff</span><span class="o">],</span> <span class="o">[</span><span class="mi">1</span><span class="o">,</span> <span class="mi">1</span><span class="o">],</span> <span class="o">[</span><span class="mi">0</span><span class="o">,</span> <span class="mi">255</span><span class="o">],</span> <span class="n">matrix</span><span class="o">);</span>
</span><span class='line'>      <span class="n">bg</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageWidth</span><span class="o">,</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageHeight</span><span class="o">);</span>
</span><span class='line'>      <span class="n">bg</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>      <span class="n">addChild</span><span class="o">(</span><span class="n">bg</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Define the gravity vector</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">gravity</span><span class="p">:</span><span class="kt">b2Vec2</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2Vec2</span><span class="o">(</span><span class="mf">0.0</span><span class="o">,</span> <span class="mf">10.0</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Allow bodies to sleep</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">doSleep</span><span class="p">:</span><span class="kt">Boolean</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Construct a world object</span>
</span><span class='line'>      <span class="n">_world</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2World</span><span class="o">(</span><span class="n">gravity</span><span class="o">,</span> <span class="n">doSleep</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// set debug draw</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">debugDraw</span><span class="p">:</span><span class="kt">b2DebugDraw</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2DebugDraw</span><span class="o">();</span>
</span><span class='line'>      <span class="n">_debugSprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>      <span class="n">addChild</span><span class="o">(</span><span class="n">_debugSprite</span><span class="o">);</span>
</span><span class='line'>      <span class="n">debugDraw</span><span class="o">.</span><span class="na">SetSprite</span><span class="o">(</span><span class="n">_debugSprite</span><span class="o">);</span>
</span><span class='line'>      <span class="n">debugDraw</span><span class="o">.</span><span class="na">SetDrawScale</span><span class="o">(</span><span class="n">_worldRatio</span><span class="o">);</span>
</span><span class='line'>      <span class="n">debugDraw</span><span class="o">.</span><span class="na">SetFillAlpha</span><span class="o">(</span><span class="mf">0.5</span><span class="o">);</span>
</span><span class='line'>      <span class="n">debugDraw</span><span class="o">.</span><span class="na">SetLineThickness</span><span class="o">(</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'>      <span class="n">debugDraw</span><span class="o">.</span><span class="na">SetAlpha</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">debugDraw</span><span class="o">.</span><span class="na">SetFlags</span><span class="o">(</span><span class="n">b2DebugDraw</span><span class="o">.</span><span class="na">e_shapeBit</span> <span class="o">|</span> <span class="n">b2DebugDraw</span><span class="o">.</span><span class="na">e_jointBit</span><span class="o">);</span>
</span><span class='line'>      <span class="n">_world</span><span class="o">.</span><span class="na">SetDebugDraw</span><span class="o">(</span><span class="n">debugDraw</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Vars used to create bodies</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">body</span><span class="p">:</span><span class="kt">b2Body</span><span class="o">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">bodyDef</span><span class="p">:</span><span class="kt">b2BodyDef</span><span class="o">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">boxShape</span><span class="p">:</span><span class="kt">b2PolygonShape</span><span class="o">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">circleShape</span><span class="p">:</span><span class="kt">b2CircleShape</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Adding sprite variable for dynamically creating body userData</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">sprite</span><span class="p">:</span><span class="kt">Sprite</span><span class="o">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">groundHeight</span><span class="p">:</span><span class="kt">int</span> <span class="o">=</span> <span class="mi">60</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>      <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">lineStyle</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>      <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginFill</span><span class="o">(</span><span class="mh">0x444444</span><span class="o">);</span>
</span><span class='line'>      <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(-</span><span class="n">stage</span><span class="o">.</span><span class="na">stageWidth</span><span class="sr">/2, -groundHeight/</span><span class="mi">2</span><span class="o">,</span> <span class="n">stage</span><span class="o">.</span><span class="na">stageWidth</span><span class="o">,</span> <span class="n">groundHeight</span><span class="o">);</span>
</span><span class='line'>      <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">bodyDef</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2BodyDef</span><span class="o">();</span>
</span><span class='line'>      <span class="n">bodyDef</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">b2Body</span><span class="o">.</span><span class="na">b2_staticBody</span><span class="o">;</span>
</span><span class='line'>      <span class="n">bodyDef</span><span class="o">.</span><span class="na">position</span><span class="o">.</span><span class="na">Set</span><span class="o">(</span><span class="n">stage</span><span class="o">.</span><span class="na">stageWidth</span> <span class="sr">/ _worldRatio / 2, (stage.stageHeight - sprite.height/2) /</span> <span class="n">_worldRatio</span><span class="o">);</span>
</span><span class='line'>      <span class="n">bodyDef</span><span class="o">.</span><span class="na">userData</span> <span class="o">=</span> <span class="n">sprite</span><span class="o">;</span>
</span><span class='line'>      <span class="n">addChild</span><span class="o">(</span><span class="n">bodyDef</span><span class="o">.</span><span class="na">userData</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">boxShape</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2PolygonShape</span><span class="o">();</span>
</span><span class='line'>      <span class="n">boxShape</span><span class="o">.</span><span class="na">SetAsBox</span><span class="o">(</span><span class="n">sprite</span><span class="o">.</span><span class="na">width</span><span class="sr">/_worldRatio/2, sprite.height/_worldRatio/</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="kd">var</span> <span class="n">fixtureDef</span><span class="p">:</span><span class="kt">b2FixtureDef</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2FixtureDef</span><span class="o">();</span>
</span><span class='line'>      <span class="n">fixtureDef</span><span class="o">.</span><span class="na">shape</span> <span class="o">=</span> <span class="n">boxShape</span><span class="o">;</span>
</span><span class='line'>      <span class="n">fixtureDef</span><span class="o">.</span><span class="na">friction</span> <span class="o">=</span> <span class="mf">0.3</span><span class="o">;</span>
</span><span class='line'>      <span class="n">fixtureDef</span><span class="o">.</span><span class="na">density</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="c1">// static bodies require zero density</span>
</span><span class='line'>
</span><span class='line'>      <span class="n">body</span> <span class="o">=</span> <span class="n">_world</span><span class="o">.</span><span class="na">CreateBody</span><span class="o">(</span><span class="n">bodyDef</span><span class="o">);</span>
</span><span class='line'>      <span class="n">body</span><span class="o">.</span><span class="na">CreateFixture</span><span class="o">(</span><span class="n">fixtureDef</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Add some objects</span>
</span><span class='line'>      <span class="k">for</span> <span class="o">(</span><span class="kd">var</span> <span class="n">i</span><span class="p">:</span><span class="kt">int</span> <span class="o">=</span> <span class="mi">1</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">20</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// create generic body definition</span>
</span><span class='line'>        <span class="n">bodyDef</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2BodyDef</span><span class="o">();</span>
</span><span class='line'>        <span class="n">bodyDef</span><span class="o">.</span><span class="na">type</span> <span class="o">=</span> <span class="n">b2Body</span><span class="o">.</span><span class="na">b2_dynamicBody</span><span class="o">;</span>
</span><span class='line'>        <span class="n">bodyDef</span><span class="o">.</span><span class="na">position</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">15</span> <span class="o">+</span> <span class="mi">5</span><span class="o">;</span>
</span><span class='line'>        <span class="n">bodyDef</span><span class="o">.</span><span class="na">position</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">*</span> <span class="mi">10</span><span class="o">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">rX</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">rY</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">+</span> <span class="mi">1</span><span class="o">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">spriteX</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">rX</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
</span><span class='line'>        <span class="kd">var</span> <span class="n">spriteY</span><span class="p">:</span><span class="kt">Number</span> <span class="o">=</span> <span class="n">rY</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">*</span> <span class="mi">2</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Box</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">Math</span><span class="o">.</span><span class="na">random</span><span class="o">()</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">lineStyle</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginFill</span><span class="o">(</span><span class="mh">0xff6666</span><span class="o">);</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawRect</span><span class="o">(-</span><span class="n">spriteX</span><span class="sr">/2, -spriteY/</span><span class="mi">2</span><span class="o">,</span> <span class="n">spriteX</span><span class="o">,</span> <span class="n">spriteY</span><span class="o">);</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>          <span class="n">bodyDef</span><span class="o">.</span><span class="na">userData</span> <span class="o">=</span> <span class="n">sprite</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">boxShape</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2PolygonShape</span><span class="o">();</span>
</span><span class='line'>          <span class="n">boxShape</span><span class="o">.</span><span class="na">SetAsBox</span><span class="o">(</span><span class="n">rX</span><span class="o">,</span> <span class="n">rY</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">shape</span> <span class="o">=</span> <span class="n">boxShape</span><span class="o">;</span>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">density</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">;</span>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">friction</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">;</span>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">restitution</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">body</span> <span class="o">=</span> <span class="n">_world</span><span class="o">.</span><span class="na">CreateBody</span><span class="o">(</span><span class="n">bodyDef</span><span class="o">);</span>
</span><span class='line'>          <span class="n">body</span><span class="o">.</span><span class="na">CreateFixture</span><span class="o">(</span><span class="n">fixtureDef</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>        <span class="c1">// Circle</span>
</span><span class='line'>        <span class="k">else</span> <span class="o">{</span>
</span><span class='line'>          <span class="n">sprite</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sprite</span><span class="o">();</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">lineStyle</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">beginFill</span><span class="o">(</span><span class="mh">0x44ff44</span><span class="o">);</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">drawCircle</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="n">spriteX</span><span class="o">/</span><span class="mi">2</span><span class="o">);</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">endFill</span><span class="o">();</span>
</span><span class='line'>          <span class="n">bodyDef</span><span class="o">.</span><span class="na">userData</span> <span class="o">=</span> <span class="n">sprite</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">circleShape</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">b2CircleShape</span><span class="o">(</span><span class="n">rX</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">shape</span> <span class="o">=</span> <span class="n">circleShape</span><span class="o">;</span>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">density</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">;</span>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">friction</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">;</span>
</span><span class='line'>          <span class="n">fixtureDef</span><span class="o">.</span><span class="na">restitution</span> <span class="o">=</span> <span class="mf">0.2</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="n">body</span> <span class="o">=</span> <span class="n">_world</span><span class="o">.</span><span class="na">CreateBody</span><span class="o">(</span><span class="n">bodyDef</span><span class="o">);</span>
</span><span class='line'>          <span class="n">body</span><span class="o">.</span><span class="na">CreateFixture</span><span class="o">(</span><span class="n">fixtureDef</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">_bodySprites</span><span class="o">.</span><span class="na">push</span><span class="o">(</span><span class="n">bodyDef</span><span class="o">.</span><span class="na">userData</span> <span class="k">as</span> <span class="n">Sprite</span><span class="o">);</span>
</span><span class='line'>        <span class="n">addChild</span><span class="o">(</span><span class="n">bodyDef</span><span class="o">.</span><span class="na">userData</span><span class="o">);</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// enable view source</span>
</span><span class='line'>      <span class="n">ViewSource</span><span class="o">.</span><span class="na">addMenuItem</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s2">&quot;srcview/index.html&quot;</span><span class="o">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="n">text</span><span class="p">:</span><span class="kt">TextField</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">TextField</span><span class="o">();</span>
</span><span class='line'>      <span class="n">text</span><span class="o">.</span><span class="na">text</span> <span class="o">=</span> <span class="s2">&quot;Right click to view source&quot;</span><span class="o">;</span>
</span><span class='line'>      <span class="n">text</span><span class="o">.</span><span class="na">setTextFormat</span><span class="o">(</span><span class="k">new</span> <span class="kt">TextFormat</span><span class="o">(</span><span class="s2">&quot;arial&quot;</span><span class="o">,</span> <span class="mi">14</span><span class="o">,</span> <span class="mi">0</span><span class="o">,</span> <span class="kc">true</span><span class="o">));</span>
</span><span class='line'>      <span class="n">text</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
</span><span class='line'>      <span class="n">text</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="mi">20</span><span class="o">;</span>
</span><span class='line'>      <span class="n">text</span><span class="o">.</span><span class="na">width</span> <span class="o">=</span> <span class="mi">200</span><span class="o">;</span>
</span><span class='line'>      <span class="n">addChild</span><span class="o">(</span><span class="n">text</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">onClick</span><span class="o">(</span><span class="n">e</span><span class="o">:</span><span class="kt">MouseEvent</span><span class="o">):</span><span class="kt">void</span> <span class="o">{</span>
</span><span class='line'>      <span class="n">_showDebug</span> <span class="o">=</span> <span class="o">!</span><span class="n">_showDebug</span><span class="o">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(!</span><span class="n">_showDebug</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">_debugSprite</span><span class="o">.</span><span class="na">graphics</span><span class="o">.</span><span class="na">clear</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>      <span class="k">for</span> <span class="k">each</span> <span class="o">(</span><span class="kd">var</span> <span class="n">sprite</span><span class="p">:</span><span class="kt">Sprite</span> <span class="k">in</span> <span class="n">_bodySprites</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">sprite</span><span class="o">.</span><span class="na">visible</span> <span class="o">=</span> <span class="o">!</span><span class="n">_showDebug</span><span class="o">;</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">function </span><span class="nf">Update</span><span class="o">(</span><span class="n">e</span><span class="o">:</span><span class="kt">Event</span><span class="o">):</span><span class="kt">void</span><span class="o">{</span>
</span><span class='line'>      <span class="n">_world</span><span class="o">.</span><span class="na">Step</span><span class="o">(</span><span class="n">_timeStep</span><span class="o">,</span> <span class="n">_velocityIterations</span><span class="o">,</span> <span class="n">_positionIterations</span><span class="o">);</span>
</span><span class='line'>      <span class="k">if</span> <span class="o">(</span><span class="n">_showDebug</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">_world</span><span class="o">.</span><span class="na">DrawDebugData</span><span class="o">();</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// Go through body list and update sprite positions/rotations</span>
</span><span class='line'>      <span class="k">for</span> <span class="o">(</span><span class="kd">var</span> <span class="n">bb</span><span class="p">:</span><span class="kt">b2Body</span> <span class="o">=</span> <span class="n">_world</span><span class="o">.</span><span class="na">GetBodyList</span><span class="o">();</span> <span class="n">bb</span><span class="o">;</span> <span class="n">bb</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="na">GetNext</span><span class="o">()){</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">bb</span><span class="o">.</span><span class="na">GetUserData</span><span class="o">()</span> <span class="k">is</span> <span class="n">Sprite</span><span class="o">){</span>
</span><span class='line'>          <span class="kd">var</span> <span class="n">sprite</span><span class="p">:</span><span class="kt">Sprite</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="na">GetUserData</span><span class="o">()</span> <span class="k">as</span> <span class="n">Sprite</span><span class="o">;</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">x</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="na">GetPosition</span><span class="o">().</span><span class="n">x</span> <span class="o">*</span> <span class="mi">30</span><span class="o">;</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">y</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="na">GetPosition</span><span class="o">().</span><span class="n">y</span> <span class="o">*</span> <span class="mi">30</span><span class="o">;</span>
</span><span class='line'>          <span class="n">sprite</span><span class="o">.</span><span class="na">rotation</span> <span class="o">=</span> <span class="n">bb</span><span class="o">.</span><span class="na">GetAngle</span><span class="o">()</span> <span class="o">*</span> <span class="o">(</span><span class="mi">180</span><span class="o">/</span><span class="n">Math</span><span class="o">.</span><span class="na">PI</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>      <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>  <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Very cool stuff that adds lots of possibilities to your Flash projects.  I can&#8217;t wait to start playing with the more complex aspects like joints, buoyancy and breakable bodies.  More intensely awesome demos sure to follow.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/17/shadowbox-js-for-wordpress/">ShadowBox JS for Wordpress</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-17T21:23:00-04:00" pubdate data-updated="true">Aug 17<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Just a quick update to let you know that my Flash demos will be from now on be displayed in <a href="http://www.shadowbox-js.com/" target="_blank">ShadowBox.js</a> via the <a href="http://sivel.net/wordpress/shadowbox-js/" target="_blank">ShadowBox JS Wordpress plugin</a>.  Its a lightweight javascript library that allows you to show all kinds of media on your website in a slick popup window.  You&#8217;ve probably seen them before on video and image gallery sites.</p>

<p>While the ShadowBox JS plugin will handle all your images, videos, SWFs, etc&#8230; by default, I prefer to manually determine which media will utilize it.  And to do so, its as simple as adding &#8220;rel=shadowbox&#8221; to your anchor tags, which I use in my <a href="http://savagelook.com/blog/code/box2dflashas3-fun">Box2D demo post</a>:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;a</span> <span class="na">rel=</span><span class="s">&quot;shadowbox;height=600;width=800;&quot;</span>
</span><span class='line'>    <span class="na">href=</span><span class="s">&quot;http://savagelook.com/demos/box2d/box2d.swf&quot;</span>
</span><span class='line'>    <span class="na">target=</span><span class="s">&quot;_self&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>  <span class="nt">&lt;img</span> <span class="na">class=</span><span class="s">&quot;  &quot;</span> <span class="na">title=</span><span class="s">&quot;Box2D demo&quot;</span>
</span><span class='line'>         <span class="na">src=</span><span class="s">&quot;http://savagelook.com/images/box2d_full.jpg&quot;</span>
</span><span class='line'>         <span class="na">alt=</span><span class="s">&quot;Box2D demo&quot;</span> <span class="na">width=</span><span class="s">&quot;516&quot;</span> <span class="na">height=</span><span class="s">&quot;487&quot;</span> <span class="nt">/&gt;</span>
</span><span class='line'><span class="nt">&lt;/a&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>I avoided pre-built blogs for the longest time because I&#8217;m a ridiculously customization driven programmer, but with what Wordpress has available for free, I wonder why I wasn&#8217;t using it all along.  I highly suggest ShadowBox.js for your Wordpress blog or any website that needs a little extra eye-catching flair.  And let&#8217;s face it, if you&#8217;ve been around my blog for any amount of time, it&#8217;s all about eye candy.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/08/11/webcam-video-in-actionscript3/">Webcam Video in Actionscript3</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-08-11T22:21:00-04:00" pubdate data-updated="true">Aug 11<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/webcam/webcam.html" class="fancybox.iframe"><img title="webcam" src="/images/webcamp.jpg" alt="" width="449" height="321" /></a></p>


<p>Click the above picture for the webcam demo (webcam required).
Right click on the demo, or <a href="/demos/webcam/srcview/index.html" target="_self">click here for the source code</a>.</p>

<p>This is a pretty simple demo compared to some of my other stuff, but it&#8217;s a key point for a lot of them.  Knowing how to use the webcam independently of an existing library can open up lots of options beside augmented reality.  For that reason, I present this small demo showing off how easy it is to do so in Actionscript3.</p>

<p>Here&#8217;s a slightly modified excerpt from the full source code that is the meat and potatoes of the demo:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="kd">var</span> <span class="n">camera</span><span class="p">:</span><span class="kt">Camera</span> <span class="o">=</span> <span class="n">Camera</span><span class="o">.</span><span class="na">getCamera</span><span class="o">();</span>
</span><span class='line'><span class="n">camera</span><span class="o">.</span><span class="na">setQuality</span><span class="o">(</span><span class="mi">0</span><span class="o">,</span><span class="mi">100</span><span class="o">);</span>
</span><span class='line'><span class="n">camera</span><span class="o">.</span><span class="na">setMode</span><span class="o">(</span><span class="mi">800</span><span class="o">,</span><span class="mi">600</span><span class="o">,</span><span class="mi">60</span><span class="o">,</span><span class="kc">true</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="n">video</span><span class="p">:</span><span class="kt">Video</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Video</span><span class="o">(</span><span class="mi">800</span><span class="o">,</span><span class="mi">600</span><span class="o">);</span>
</span><span class='line'><span class="n">video</span><span class="o">.</span><span class="na">attachCamera</span><span class="o">(</span><span class="n">camera</span><span class="o">);</span>
</span><span class='line'><span class="n">addChild</span><span class="o">(</span><span class="n">video</span><span class="o">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, its as simple as creating a Camera object, attaching it to a Video object and adding the Video object to the main sprite.   The demo will show you how to manipulate image quality, camera frame rate, and viewport size.  For more details on all the properties and methods of each, check out the ASDocs on <a href="http://www.adobe.com/livedocs/flash/9.0/ActionScriptLangRefV3/flash/media/Camera.html" target="_blank">Camera</a> and <a href="http://www.adobe.com/livedocs/flash/9.0/ActionScriptLangRefV3/flash/media/Video.html" target="_blank">Video</a>.</p>

<p>What can you do with this besides making yet another video chat application?  I don&#8217;t know about you, but I&#8217;m planning an Away3DLite project that will involve multiple levels of &#8220;reflection&#8221; based on the images from the webcam.  It will be awesome.  Now I just need to figure out how I&#8217;m going to do it.  Details&#8230;</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/10/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/8/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
	<span>
		<img src="http://www.gravatar.com/avatar/39ebccd822b6fb533e004ee722c38e9d?s=150" alt="Gravatar of Tony Lukasavage " title="Gravatar of Tony Lukasavage" />
	</span>
</section>


  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tonylukasavage" class="twitter-follow-button" data-show-count="true">Follow @tonylukasavage</a>
  

<link href="/stylesheets/github-buttons.css" media="screen, projection" rel="stylesheet" type="text/css">
<span class="github-btn" data-user="tonylukasavage" data-type="follow" data-count="1"></span>
<script type="text/javascript" src="/javascripts/github-buttons.js"></script><style type="text/css">
.gittip-img {
	background-image: url(/images/gittip.png);
	background-repeat: no-repeat;
  background-position: 0 0;
  background-color: transparent;
	display: inline-block;
	height: 24px;
	width: 24px;
	margin-right: 3px;
}
</style>
<p><span class="gittip-img"></span>
<script data-gittip-username="Tony Lukasavage"
        data-gittip-widget="button"
        src="//gttp.co/v1.js"></script></p><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/24/good-bye-appcelerator/">Good-bye Appcelerator</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/24/optional-callbacks-for-flexible-apis-in-javascript/">Callback Spotting: Flexible APIs in Javascript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/21/appcelerator-api-builder-demo/">Appcelerator API Builder Demo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/29/custom-assertions-in-should-dot-js/">Custom assertions in should.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/24/f-ck-you/">F*ck You, Show Me</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/tonylukasavage">@tonylukasavage</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tonylukasavage',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

 <section>
     <h1>Twitter</h1>
     <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/tonylukasavage" data-widget-id="422932897931083776">Tweets by @tonylukasavage</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>


 </section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Tony Lukasavage -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tonylukasavage';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<!-- Add jQuery library -->
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript">
jQuery.noConflict();
</script>

<!-- Add github repo widget -->
<script type="text/javascript" src="/javascripts/jquery.githubRepoWidget.min.js"></script>

<!-- Add fancyBox main JS file -->
<script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.4"></script>

<!-- fire up fancybox -->
<script type="text/javascript">
(function($) {
	$(function() {
		$('[class*=fancybox]').fancybox();
	});
})(jQuery);
</script>

</body>
</html>
