
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Tony Lukasavage</title>
  <meta name="author" content="Tony Lukasavage">

  
  <meta name="description" content="2 things brought about this post: The increased popularity of Away3D with the announcement of &#8220;Molehill&#8221; at AdobeMax 2010.The scarcity &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tonylukasavage.github.com/blog/page/8/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Tony Lukasavage" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/fancybox/source/jquery.fancybox.css?v=2.1.4" media="screen" />

<style type="text/css">
ul#grid {
  padding: 0;
  list-style: none;
  margin: 20px auto 0;
  width: 100%;  
  }

#grid li {
  float: left;
  padding: 0;
  margin: 0 5px 10px 5px;
  } 

#grid li a {
  display: block;
  }

#grid li img {
  background-color: white;
  padding: 7px; margin: 0;
  border: 1px dotted #58595b;
  width: 140px;
  height: 120px;
  }
</style>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39965828-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup id="theHeader">
  <h1><a href="/">Tony Lukasavage</a></h1>
  
    <h2>Caffeine. Whiskey. Code. Mostly the last one.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tonylukasavage.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/29/away3d-people--places--and-tutorials/">Away3d People, Places, and Tutorials</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-29T08:33:00-05:00" pubdate data-updated="true">Nov 29<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>2 things brought about this post:</p>

<ol><li>The increased popularity of <a href="http://away3d.com">Away3D</a> with the announcement of <a href="http://savagelook.com/blog/away3d/adobe-molehill-3d-api-videos" target="_blank">&#8220;Molehill&#8221; at AdobeMax 2010</a>.</li><li>The scarcity and disarray of some of Away3D&#8217;s greatest resources for learning and inspiration.</li></ol>


<p>To fix this I am going to create a collection here of the best available blogs, links, tutorials, demos, and videos from the Away3D community.  With a little help from you, the visitors to this blog, of course.  So <span style="color:#ff0000;">PLEASE</span>, if I miss a team member or a good blog, leave a comment and I&#8217;ll add it to the list.  OK, here we go.</p>

<h2>The twitter list</h2>

<p><a href="http://twitter.com/#!/tonylukasavage/away3d">http://twitter.com/#!/tonylukasavage/away3d</a></p>

<p>Let me know if you want to be added.</p>

<h2>The Project</h2>

<ul>
<li><a href="http://away3d.com">Away3D.com</a> - The official Away3D Flash Engine site</li>
<li><a href="http://away3d.com/tutorials">Away3D tutorials</a> - A list of useful, though slightly dated, tutorials for the engine</li>
<li><a href="http://groups.google.com/group/away3d-dev?pli=1">Away3D Developers Google Group</a> - A growing community where Away3D developers and newbies can interact and ask questions, often addressed by the core team members themselves.</li>
</ul>


<h2>The Team</h2>

<ul>
<li><a href="http://www.infiniteturtles.co.uk/blog/">Rob Bateman</a> - Away3D founder, lead developer, and co-author of <a href="http://flash3dbook.com/">&#8220;The Essential Guide to 3D in Flash&#8221;</a></li>
<li><a href="http://blog.closier.nl/">Fabrice Closier</a> - Away3D developer and creator of <a href="http://www.closier.nl/prefab/">Prefab</a>, the Away3D modeler and workflow enhancer.</li>
<li><a href="http://www.flashten.com/">Peter Kapelyan</a> - Away3D developer</li>
<li><a href="http://www.geepers.co.uk/">Greg Caldwell</a> - Away3D documentation, and the inspiration for my <a href="http://savagelook.com/blog/away3d/reflection-in-away3d-take-2">reflection in Away3D demo</a>.</li>
<li><a href="http://evo.bombsquad.org/">Jalava</a> - Away3D bitmap rendering</li>
<li><a href="http://sleepydesign.blogspot.com/">Katopz</a> - Away3D developer and Collada animation</li>
<li><a href="http://www.lidev.com.ar/?s=away3d">Li</a> - Away3D developer and vector text/shapes</li>
<li><a href="http://blog.richardolsson.se/">Richard Olsson</a> - Away3D developer and co-author of <a href="http://flash3dbook.com/">&#8220;The Essential Guide to 3D in Flash&#8221;</a></li>
<li><a href="http://www.derschmale.com/">David Lenaert</a> - Flash 10 shaders and Pixelbender</li>
</ul>


<h2>The blogs, devs, and links</h2>

<ul>
<li><a href="http://savagelook.com/blog/tag/away3d">Tony Lukasavage</a> (me) - A blog full of Away3D demos, code, and overall goodness.</li>
<li><a href="http://www.flashmagazine.com/Tutorials/category/away3d/">Flash Tutorials (Away3D)</a> - A great collection of Away3D tutorials to help you get started.</li>
<li><a href="http://www.unitzeroone.com/blog/?s=away3d">Ralph Hauwert</a> - Flash 3D wizard with some good Away3D content.</li>
<li><a href="http://www.inear.se/?s=away3d">Einar Ã–berg</a> - Great Flash developer with some awesome Away3D projects.</li>
<li><a href="http://www.everyday3d.com/blog/index.php/category/3d/away3d-3d/">Bartek Drozdz</a> - Now mostly a <a href="http://unity3d.com/" target="_blank">Unity3D</a> blog, it still contains some real Away3D gems.</li>
<li><a href="http://www.allforthecode.co.uk/aftc/forum/user/modules/forum/welcome.php?index=4">Darcey Lloyd</a> - This site has mountains of great Away3d demos and instructional content.</li>
<li><a href="http://www.brighthub.com/hubfolio/matthew-casperson/tags/away3d.aspx">Matthew Casperson</a> - Tons of detailed demos and how-to&#8217;s for Away3D</li>
<li><a href="http://www.harrynorthover.com/blog/?s=away3d">Harry Northover</a> - A bit dated, but still has some good, basic Away3D examples.</li>
<li><a href="http://blog.alladvanced.net/category/away3d/">Advanced Mediocrity</a> - A handful of cool Away3D examples</li>
<li><a href="http://jasonbejot.com/category/away3d">Jason Begot</a> - A couple of great Away3D samples, and he was the inspiration for my <a href="http://savagelook.com/blog/away3d/away3d-mesh-morphing">mesh morphing demo</a>.</li>
<li><a href="http://www.exey.ru/blog/">Exey Panteleev</a> - Flash 3D developer with some Away3D demos, and he inspired my <a href="http://savagelook.com/blog/away3d/dynamic-heightmaps-in-away3d">dynamic height demo</a>.</li>
<li><a href="http://blog.tartiflop.com/category/away3d/">blog.tartiflop</a> - Pretty old Away3D stuff, but it still contains some very useful content for understanding the engine.</li>
<li><a href="http://www.flash-3d.net/">flash-3d.net</a> - A growing collection of Away3D tutorials and examples ported from Papervision3D.</li>
<li><a href="http://john-wilson.110mb.com/">John Wilson</a> - Nice collection of Away3D demos and samples.</li>
<li><a href="http://www.mcfunkypants.com/">McFunkyPants</a> - Indie game developer content with some great Flash 3D material (Including insight on Molehill).</li>
</ul>


<h2>The books</h2>

<ul>
<li><a href="http://flash3dbook.com/">&#8220;The Essential Guide to 3D in Flash&#8221;</a> - written by Rob Bateman and Richard Olsson</li>
<li><a href="https://www.packtpub.com/creating-detailed-animated-and-interactive-3D-worlds-with-away3D-3-6-essentials/book">&#8220;Away3D 3.6 Essentials&#8221;</a> - written by Matthew Casperon</li>
<li><a href="http://izibook.eyrolles.com/produit/1094/9782212416244/La%203D%20en%20Flash%20avec%20Away3D">&#8220;La 3D en Flash avec Away3D&#8221;</a> - written by Sylvain Godbert</li>
</ul>


<h2>The games, videos, and extras</h2>

<ul>
<li><a href="http://www.influxis.com/battlecell/">BattleCell</a> - The incredible Away3D, multi-player, first person shooter.  Grab a friend and blow sh!t up!</li>
<li><a href="http://savagelook.com/blog/away3d/adobe-molehill-3d-api-videos">&#8220;Molehill&#8221; demo videos </a>- Get a preview at the amazing advances coming to Flash 3D</li>
<li><a href="http://www.thetechlabs.com/tech-tutorials/3d/away3d-shootemup-tutorial-sound-effects/">Away3D Shoot &#8216;Em Up with sound</a> - A lengthy tutorial on game building and sound for Away3D.</li>
<li><a href="http://gestureworks.com/support-tutorials/multitouch-away3d-application/">Gesture Works</a> - Shows how to add multi-touch support to your Away3D applications</li>
<li><a href="http://www.infiniteturtles.co.uk/blog/away3d-lite-on-the-nexus-one">Away3D Mobile</a> - See Away3DLite running on mobile devices</li>
</ul>


<p>This list is far from exhaustive and I would <span style="color:#ff0000;">love it</span> if my readers would contribute.  Let me hear what your other Away3D resources are.  I&#8217;m all ears.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/24/adobe--molehill--3d-api-videos/">Adobe &#8220;Molehill&#8221; 3D API Videos</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-24T11:32:00-05:00" pubdate data-updated="true">Nov 24<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In the wake of the <a href="http://adamkinney.posterous.com/molehill-video-new-flash-3d-api-from-adobemax" target="_blank">Adobe Flash &#8220;Molehill&#8221; 3D API</a> being unveiled at AdobeMax this year, interest in 3D Flash has exploded.  Rather than bore you with why I think this is so interesting (though I must mention that it uses the GPU), here&#8217;s some videos to give you an idea of how incredible this API is going to be:</p>

<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/szaXvTsoeVs?fs=1&amp;hl=en_US"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/szaXvTsoeVs?fs=1&amp;hl=en_US" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>




<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/9LAN5GHm5eM?fs=1&amp;hl=en_US"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/9LAN5GHm5eM?fs=1&amp;hl=en_US" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>


<script type="text/javascript"><!--
google_ad_client = "pub-8526874234699762";
/* 728x90, created 12/20/10 */
google_ad_slot = "5105934733";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>


<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/tgwi0lWgX8w?fs=1&amp;hl=en_US"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/tgwi0lWgX8w?fs=1&amp;hl=en_US" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>




<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/m053MqzstVg?fs=1&amp;hl=en_US"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/m053MqzstVg?fs=1&amp;hl=en_US" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>


<script type="text/javascript"><!--
google_ad_client = "pub-8526874234699762";
/* 728x90, created 12/20/10 */
google_ad_slot = "5105934733";
google_ad_width = 728;
google_ad_height = 90;
//-->
</script>


<script type="text/javascript"
src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/hCXxCD_GYTA?fs=1&amp;hl=en_US"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/hCXxCD_GYTA?fs=1&amp;hl=en_US" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>




<object width="640" height="385"><param name="movie" value="http://www.youtube.com/v/s0Nu1OaBXa8?fs=1&amp;hl=en_US"></param><param name="allowFullScreen" value="true"></param><param name="allowscriptaccess" value="always"></param><embed src="http://www.youtube.com/v/s0Nu1OaBXa8?fs=1&amp;hl=en_US" type="application/x-shockwave-flash" allowscriptaccess="always" allowfullscreen="true" width="640" height="385"></embed></object>


<p>Yes, I know, it IS awesome.  But be patient kids, the word is a painfully vague &#8220;mid 2011&#8221; beta release.  In the meantime, though, start sharpening with your 3D Flash engine of choice because Adobe has already stated that its going to let the community build the engines.  And believe me, <a href="http://away3d.com" target="_blank">Away3D</a>, <a href="http://alternativaplatform.com/en/alternativa3d/" target="_blank">Alternativa</a>, and a handful of others will be waiting with their Molehill-ready engines as soon as it is released.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/21/box2d-js---physics-in-html5--amp--javascript-guide/">Box2D JS - Physics in HTML5 &amp; Javascript Guide</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-21T23:29:00-05:00" pubdate data-updated="true">Nov 21<span>st</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/box2djs/helloworld.html" class="fancybox.iframe"><img title="helloworld" src="/images/helloworld_medium.jpg" alt="" width="624" height="275" /></a></p>


<p><strong>I hate to do it, but I highly recommend the <span style="color:#ff0000;">Google Chrome</span> browser for this demo.  In other browsers it may take a while to load and runs slower.</strong></p>

<p>&rarr; Click on the demo above or <a href="/demos/box2djs/helloworld.html">here</a>, then right click to view source
&rarr; Download the <a href="http://sourceforge.net/projects/box2d-js/files/" target="_blank">Box2D JS library</a>
&rarr; Download the <a href="/demos/box2djs/box2djs.js">concatenated version</a> (~350KB)
&rarr; Download the <a href="/demos/box2djs/box2djs.min.js">minified version</a> (~170 KB)</p>

<h2>The Overview</h2>

<p>Some of you might remember the Box2DFlashAS3 demo I did a while ago.  Well here&#8217;s its HTML5 counter-part, with the help of <a href="http://box2d-js.sourceforge.net/" target="_blank">Box2D JS</a>.  Box2D is the Javascript port of the <a href="http://box2dflash.sourceforge.net/" target="_blank">Box2DFlashAS3 library</a>, which in turn is a port of the <a href="http://www.box2d.org/">Box2D C++ library</a>.  Put simply, this library allows you to apply 2 dimensional physics to objects on your HTML5 canvas element.  Just click anywhere on the demo above to see what I mean.</p>

<p>The code behind this is a condensed, easier-to-follow version of the demo code available by viewing the page source at the <a href="http://box2d-js.sourceforge.net/" target="_blank">Box2D JS site</a>.  I personally found it a little tough to follow initially and really wanted to avoid the large amount of individual includes necessary to get it working.  To that end I created the concatenated and minified versions downloadable above.  So basically the includes necessary go from this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">IE</span><span class="p">]</span><span class="o">&gt;&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/excanvas.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;&lt;![endif]--&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/prototype-1.6.0.2.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="c">&lt;!--</span> <span class="nx">box2djs</span> <span class="o">--&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/common/b2Settings.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/common/math/b2Vec2.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/common/math/b2Mat22.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/common/math/b2Math.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2AABB.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2Bound.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2BoundValues.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2Pair.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2PairCallback.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2BufferedPair.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2PairManager.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2BroadPhase.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2Collision.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/Features.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2ContactID.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2ContactPoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2Distance.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2Manifold.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2OBB.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/b2Proxy.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/ClipVertex.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2Shape.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2ShapeDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2BoxDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2CircleDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2CircleShape.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2MassData.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2PolyDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/collision/shapes/b2PolyShape.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2Body.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2BodyDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2CollisionFilter.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2Island.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2TimeStep.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2ContactNode.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2Contact.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2ContactConstraint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2ContactConstraintPoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2ContactRegister.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2ContactSolver.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2CircleContact.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2Conservative.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2NullContact.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2PolyAndCircleContact.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/contacts/b2PolyContact.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2ContactManager.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2World.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/b2WorldListener.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2JointNode.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2Joint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2JointDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2DistanceJoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2DistanceJointDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2Jacobian.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2GearJoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2GearJointDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2MouseJoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2MouseJointDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2PrismaticJoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2PrismaticJointDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2PulleyJoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2PulleyJointDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2RevoluteJoint.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s1">&#39;js/box2d/dynamics/joints/b2RevoluteJointDef.js&#39;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>to this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">IE</span><span class="p">]</span><span class="o">&gt;&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/excanvas.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;&lt;![endif]--&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/prototype-1.6.0.2.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;box2djs.min.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>You still need to download Box2D JS for its dependencies on <a href="http://www.prototypejs.org/" target="_blank">Prototype</a> and <a href="http://excanvas.sourceforge.net/" target="_blank">excanvas</a>, but using my single file versions of the library will make getting started much cleaner and easier.  OK, enough of the back story, on to the code.</p>

<h2>The Code</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
<span class='line-number'>168</span>
<span class='line-number'>169</span>
<span class='line-number'>170</span>
<span class='line-number'>171</span>
<span class='line-number'>172</span>
<span class='line-number'>173</span>
<span class='line-number'>174</span>
<span class='line-number'>175</span>
<span class='line-number'>176</span>
<span class='line-number'>177</span>
<span class='line-number'>178</span>
<span class='line-number'>179</span>
<span class='line-number'>180</span>
<span class='line-number'>181</span>
<span class='line-number'>182</span>
<span class='line-number'>183</span>
<span class='line-number'>184</span>
<span class='line-number'>185</span>
<span class='line-number'>186</span>
<span class='line-number'>187</span>
<span class='line-number'>188</span>
<span class='line-number'>189</span>
<span class='line-number'>190</span>
<span class='line-number'>191</span>
<span class='line-number'>192</span>
<span class='line-number'>193</span>
<span class='line-number'>194</span>
<span class='line-number'>195</span>
<span class='line-number'>196</span>
<span class='line-number'>197</span>
<span class='line-number'>198</span>
<span class='line-number'>199</span>
<span class='line-number'>200</span>
<span class='line-number'>201</span>
<span class='line-number'>202</span>
<span class='line-number'>203</span>
<span class='line-number'>204</span>
<span class='line-number'>205</span>
<span class='line-number'>206</span>
<span class='line-number'>207</span>
<span class='line-number'>208</span>
<span class='line-number'>209</span>
<span class='line-number'>210</span>
<span class='line-number'>211</span>
<span class='line-number'>212</span>
<span class='line-number'>213</span>
<span class='line-number'>214</span>
<span class='line-number'>215</span>
<span class='line-number'>216</span>
<span class='line-number'>217</span>
<span class='line-number'>218</span>
<span class='line-number'>219</span>
<span class='line-number'>220</span>
<span class='line-number'>221</span>
<span class='line-number'>222</span>
<span class='line-number'>223</span>
<span class='line-number'>224</span>
<span class='line-number'>225</span>
<span class='line-number'>226</span>
<span class='line-number'>227</span>
<span class='line-number'>228</span>
<span class='line-number'>229</span>
<span class='line-number'>230</span>
<span class='line-number'>231</span>
<span class='line-number'>232</span>
<span class='line-number'>233</span>
<span class='line-number'>234</span>
<span class='line-number'>235</span>
<span class='line-number'>236</span>
<span class='line-number'>237</span>
<span class='line-number'>238</span>
<span class='line-number'>239</span>
<span class='line-number'>240</span>
<span class='line-number'>241</span>
<span class='line-number'>242</span>
<span class='line-number'>243</span>
<span class='line-number'>244</span>
<span class='line-number'>245</span>
<span class='line-number'>246</span>
<span class='line-number'>247</span>
<span class='line-number'>248</span>
<span class='line-number'>249</span>
<span class='line-number'>250</span>
<span class='line-number'>251</span>
<span class='line-number'>252</span>
<span class='line-number'>253</span>
<span class='line-number'>254</span>
<span class='line-number'>255</span>
<span class='line-number'>256</span>
<span class='line-number'>257</span>
<span class='line-number'>258</span>
<span class='line-number'>259</span>
<span class='line-number'>260</span>
<span class='line-number'>261</span>
<span class='line-number'>262</span>
<span class='line-number'>263</span>
<span class='line-number'>264</span>
<span class='line-number'>265</span>
<span class='line-number'>266</span>
<span class='line-number'>267</span>
<span class='line-number'>268</span>
<span class='line-number'>269</span>
<span class='line-number'>270</span>
<span class='line-number'>271</span>
<span class='line-number'>272</span>
<span class='line-number'>273</span>
<span class='line-number'>274</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span> <span class="nx">PUBLIC</span> <span class="s2">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="s2">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">html</span> <span class="nx">xmlns</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">SavageLook</span><span class="p">.</span><span class="nx">com</span> <span class="o">-</span> <span class="nx">Box2D</span> <span class="nx">JS</span> <span class="nx">Hello</span> <span class="nx">World</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
</span><span class='line'>  <span class="c">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">IE</span><span class="p">]</span><span class="o">&gt;&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/excanvas.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;&lt;![endif]--&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/prototype-1.6.0.2.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;box2djs.min.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">world</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ctx</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasWidth</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasHeight</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasTop</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasLeft</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">drawWorld</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span> <span class="nx">j</span><span class="p">;</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">drawJoint</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span> <span class="nx">b</span><span class="p">;</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">GetShapeList</span><span class="p">();</span> <span class="nx">s</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">;</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">drawShape</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s1">&#39;bold 18px arial&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">textAlign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Click the screen to add more objects&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s1">&#39;bold 14px arial&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Performance will vary by browser&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">drawJoint</span><span class="p">(</span><span class="nx">joint</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">b1</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">m_body1</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">b2</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">m_body2</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">x1</span> <span class="o">=</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">m_position</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">x2</span> <span class="o">=</span> <span class="nx">b2</span><span class="p">.</span><span class="nx">m_position</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">GetAnchor1</span><span class="p">();</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">p2</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">GetAnchor2</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;#00eeee&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
</span><span class='line'>      <span class="k">switch</span> <span class="p">(</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_distanceJoint</span><span class="o">:</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">case</span> <span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_pulleyJoint</span><span class="o">:</span>
</span><span class='line'>          <span class="c1">// TODO</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">default</span><span class="o">:</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nx">b1</span> <span class="o">==</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">b2</span> <span class="o">==</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">drawShape</span><span class="p">(</span><span class="nx">shape</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">density</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
</span><span class='line'>      <span class="k">switch</span> <span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">case</span> <span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="o">:</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">circle</span> <span class="o">=</span> <span class="nx">shape</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">m_position</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">segments</span> <span class="o">=</span> <span class="mf">16.0</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">theta</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">dtheta</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">segments</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">// draw circle</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">segments</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">),</span> <span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">));</span>
</span><span class='line'>                  <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
</span><span class='line'>                  <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>                  <span class="nx">theta</span> <span class="o">+=</span> <span class="nx">dtheta</span><span class="p">;</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>              <span class="c1">// draw radius</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">ax</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">m_R</span><span class="p">.</span><span class="nx">col1</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">pos2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span> <span class="o">*</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">r</span> <span class="o">*</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">pos2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">pos2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="k">case</span> <span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polyShape</span><span class="o">:</span>
</span><span class='line'>          <span class="p">{</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">poly</span> <span class="o">=</span> <span class="nx">shape</span><span class="p">;</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">tV</span> <span class="o">=</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_position</span><span class="p">,</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2MulMV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_R</span><span class="p">,</span> <span class="nx">poly</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">tV</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">tV</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">poly</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_position</span><span class="p">,</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2MulMV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_R</span><span class="p">,</span> <span class="nx">poly</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
</span><span class='line'>                  <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">tV</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">tV</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="k">break</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">createWorld</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">worldAABB</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2AABB</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">worldAABB</span><span class="p">.</span><span class="nx">minVertex</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">worldAABB</span><span class="p">.</span><span class="nx">maxVertex</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">doSleep</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">world</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2World</span><span class="p">(</span><span class="nx">worldAABB</span><span class="p">,</span> <span class="nx">gravity</span><span class="p">,</span> <span class="nx">doSleep</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createGround</span><span class="p">(</span><span class="nx">world</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">world</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">createGround</span><span class="p">(</span><span class="nx">world</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">groundSd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BoxDef</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">groundSd</span><span class="p">.</span><span class="nx">extents</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">groundSd</span><span class="p">.</span><span class="nx">restitution</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">groundBd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BodyDef</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">groundBd</span><span class="p">.</span><span class="nx">AddShape</span><span class="p">(</span><span class="nx">groundSd</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">groundBd</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">470</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">groundBd</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">createBall</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">ballSd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2CircleDef</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">ballSd</span><span class="p">.</span><span class="nx">density</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ballSd</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ballSd</span><span class="p">.</span><span class="nx">restitution</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ballSd</span><span class="p">.</span><span class="nx">friction</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">ballBd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BodyDef</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">ballBd</span><span class="p">.</span><span class="nx">AddShape</span><span class="p">(</span><span class="nx">ballSd</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">ballBd</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">ballBd</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">createHelloWorld</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="c1">// H</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">395</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// E</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// L</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// L</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// O</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// W</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">415</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// O</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">460</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">445</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">460</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// R</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">518</span><span class="p">,</span> <span class="mi">425</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">515</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">525</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">510</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// L</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">560</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">545</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// D</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">595</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// !</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">430</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">380</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">fixed</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">fixed</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="nx">fixed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">boxSd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BoxDef</span><span class="p">();</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fixed</span><span class="p">)</span> <span class="nx">boxSd</span><span class="p">.</span><span class="nx">density</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">boxSd</span><span class="p">.</span><span class="nx">restitution</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">boxSd</span><span class="p">.</span><span class="nx">friction</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">boxSd</span><span class="p">.</span><span class="nx">extents</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">boxBd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BodyDef</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">boxBd</span><span class="p">.</span><span class="nx">AddShape</span><span class="p">(</span><span class="nx">boxSd</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">boxBd</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">boxBd</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">step</span><span class="p">(</span><span class="nx">cnt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">stepping</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">timeStep</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">60</span><span class="p">;</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">iteration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">world</span><span class="p">.</span><span class="nx">Step</span><span class="p">(</span><span class="nx">timeStep</span><span class="p">,</span> <span class="nx">iteration</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvasWidth</span><span class="p">,</span> <span class="nx">canvasHeight</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">drawWorld</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;step(&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">cnt</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// main entry point</span>
</span><span class='line'>  <span class="nx">Event</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">world</span> <span class="o">=</span> <span class="nx">createWorld</span><span class="p">();</span>
</span><span class='line'>      <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="kd">var</span> <span class="nx">canvasElm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">canvasWidth</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">canvasHeight</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">canvasTop</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">canvasLeft</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">createHelloWorld</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">Event</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="c1">//createBox(world, Event.pointerX(e), Event.pointerY(e), 10, 10, false);</span>
</span><span class='line'>                  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                  <span class="nx">createBall</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">pointerX</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">pointerY</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>      <span class="p">});</span>
</span><span class='line'>      <span class="nx">step</span><span class="p">();</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">body</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;margin:0px;&quot;</span><span class="o">&gt;</span>
</span><span class='line'>        <span class="o">&lt;</span><span class="nx">canvas</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&quot;canvas&quot;</span> <span class="nx">width</span><span class="o">=</span><span class="s1">&#39;800&#39;</span> <span class="nx">height</span><span class="o">=</span><span class="s1">&#39;500&#39;</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&quot;background-color:#eeeeee;&quot;</span><span class="o">&gt;&lt;</span><span class="err">/canvas&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span><span class='line'> <span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>




<hr>


<h2>The Breakdown</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span> <span class="nx">PUBLIC</span> <span class="s2">&quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;</span> <span class="s2">&quot;http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;</span><span class="nx">html</span> <span class="nx">xmlns</span><span class="o">=</span><span class="s2">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class="o">&gt;</span>
</span><span class='line'>    <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">meta</span> <span class="nx">http</span><span class="o">-</span><span class="nx">equiv</span><span class="o">=</span><span class="s2">&quot;Content-Type&quot;</span> <span class="nx">content</span><span class="o">=</span><span class="s2">&quot;text/html; charset=utf-8&quot;</span> <span class="o">/&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">SavageLook</span><span class="p">.</span><span class="nx">com</span> <span class="o">-</span> <span class="nx">Box2D</span> <span class="nx">JS</span> <span class="nx">Hello</span> <span class="nx">World</span><span class="o">&lt;</span><span class="err">/title&gt;</span>
</span><span class='line'>  <span class="c">&lt;!--</span><span class="p">[</span><span class="k">if</span> <span class="nx">IE</span><span class="p">]</span><span class="o">&gt;&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/excanvas.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;&lt;![endif]--&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;lib/prototype-1.6.0.2.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="nx">script</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&quot;box2djs.min.js&quot;</span><span class="o">&gt;&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>We start by including the scripts necessary to make Box2D JS work.  In order, we need excanvas (included in the Box2D JS distribution) in order to account for the fact that all current released version of Internet Explorer do not support the HTML canvas element.  Next we include the Prototype Javascript framework, also included with Box2D JS.  Finally we include my minified version of the library.  Now we can get started building physics into our canvas element.</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="o">&lt;</span><span class="nx">script</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&quot;text/javascript&quot;</span><span class="o">&gt;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">world</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ctx</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasWidth</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasHeight</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasTop</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasLeft</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="kd">function</span> <span class="nx">drawWorld</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_jointList</span><span class="p">;</span> <span class="nx">j</span><span class="p">;</span> <span class="nx">j</span> <span class="o">=</span> <span class="nx">j</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">drawJoint</span><span class="p">(</span><span class="nx">j</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_bodyList</span><span class="p">;</span> <span class="nx">b</span><span class="p">;</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">m_next</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">b</span><span class="p">.</span><span class="nx">GetShapeList</span><span class="p">();</span> <span class="nx">s</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">;</span> <span class="nx">s</span> <span class="o">=</span> <span class="nx">s</span><span class="p">.</span><span class="nx">GetNext</span><span class="p">())</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">drawShape</span><span class="p">(</span><span class="nx">s</span><span class="p">,</span> <span class="nx">context</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s1">&#39;bold 18px arial&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">textAlign</span> <span class="o">=</span> <span class="s1">&#39;center&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s1">&#39;#000000&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Click the screen to add more objects&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">20</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">font</span> <span class="o">=</span> <span class="s1">&#39;bold 14px arial&#39;</span><span class="p">;</span>
</span><span class='line'>      <span class="nx">ctx</span><span class="p">.</span><span class="nx">fillText</span><span class="p">(</span><span class="s2">&quot;Performance will vary by browser&quot;</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we declare our global variables that define the &#8220;world&#8221; the physics exist in and the context, dimensions, and position of the canvas element.</p>

<p>Also we have our drawWorld() function that will, as the name implies, draw the shapes and joints that compose the Box2D JS world.  Each of these objects is iterated through and drawn individually.  They are added to the world with the createBody() function.  An important thing to note is that in the case of this demo, drawWorld() will be called with each &#8220;step&#8221;.  Think of your canvas as an animation and each call to drawWorld() as a frame.  Should be a simple concept for you Flash devs out there ;)</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">drawJoint</span><span class="p">(</span><span class="nx">joint</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">b1</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">m_body1</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">b2</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">m_body2</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">x1</span> <span class="o">=</span> <span class="nx">b1</span><span class="p">.</span><span class="nx">m_position</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">x2</span> <span class="o">=</span> <span class="nx">b2</span><span class="p">.</span><span class="nx">m_position</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">p1</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">GetAnchor1</span><span class="p">();</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">p2</span> <span class="o">=</span> <span class="nx">joint</span><span class="p">.</span><span class="nx">GetAnchor2</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;#00eeee&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="nx">joint</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_distanceJoint</span><span class="o">:</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">case</span> <span class="nx">b2Joint</span><span class="p">.</span><span class="nx">e_pulleyJoint</span><span class="o">:</span>
</span><span class='line'>      <span class="c1">// TODO</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">default</span><span class="o">:</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="nx">b1</span> <span class="o">==</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">b2</span> <span class="o">==</span> <span class="nx">world</span><span class="p">.</span><span class="nx">m_groundBody</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">x1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">p1</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p1</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">x2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">x2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">p2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">p2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">drawShape</span><span class="p">(</span><span class="nx">shape</span><span class="p">,</span> <span class="nx">context</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">strokeStyle</span> <span class="o">=</span> <span class="s1">&#39;#ffffff&#39;</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">density</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>      <span class="nx">context</span><span class="p">.</span><span class="nx">fillStyle</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">beginPath</span><span class="p">();</span>
</span><span class='line'>  <span class="k">switch</span> <span class="p">(</span><span class="nx">shape</span><span class="p">.</span><span class="nx">m_type</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">case</span> <span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_circleShape</span><span class="o">:</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">circle</span> <span class="o">=</span> <span class="nx">shape</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">m_position</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">m_radius</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">segments</span> <span class="o">=</span> <span class="mf">16.0</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">theta</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">dtheta</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">PI</span> <span class="o">/</span> <span class="nx">segments</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// draw circle</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">segments</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">cos</span><span class="p">(</span><span class="nx">theta</span><span class="p">),</span> <span class="nx">r</span> <span class="o">*</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">sin</span><span class="p">(</span><span class="nx">theta</span><span class="p">));</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">pos</span><span class="p">,</span> <span class="nx">d</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>              <span class="nx">theta</span> <span class="o">+=</span> <span class="nx">dtheta</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// draw radius</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">ax</span> <span class="o">=</span> <span class="nx">circle</span><span class="p">.</span><span class="nx">m_R</span><span class="p">.</span><span class="nx">col1</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">pos2</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="nx">pos</span><span class="p">.</span><span class="nx">x</span> <span class="o">+</span> <span class="nx">r</span> <span class="o">*</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span> <span class="o">+</span> <span class="nx">r</span> <span class="o">*</span> <span class="nx">ax</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">pos2</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">pos2</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="k">case</span> <span class="nx">b2Shape</span><span class="p">.</span><span class="nx">e_polyShape</span><span class="o">:</span>
</span><span class='line'>      <span class="p">{</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">poly</span> <span class="o">=</span> <span class="nx">shape</span><span class="p">;</span>
</span><span class='line'>          <span class="kd">var</span> <span class="nx">tV</span> <span class="o">=</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_position</span><span class="p">,</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2MulMV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_R</span><span class="p">,</span> <span class="nx">poly</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="mi">0</span><span class="p">]));</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">moveTo</span><span class="p">(</span><span class="nx">tV</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">tV</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">poly</span><span class="p">.</span><span class="nx">m_vertexCount</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">AddVV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_position</span><span class="p">,</span> <span class="nx">b2Math</span><span class="p">.</span><span class="nx">b2MulMV</span><span class="p">(</span><span class="nx">poly</span><span class="p">.</span><span class="nx">m_R</span><span class="p">,</span> <span class="nx">poly</span><span class="p">.</span><span class="nx">m_vertices</span><span class="p">[</span><span class="nx">i</span><span class="p">]));</span>
</span><span class='line'>              <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">v</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">v</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>          <span class="nx">context</span><span class="p">.</span><span class="nx">lineTo</span><span class="p">(</span><span class="nx">tV</span><span class="p">.</span><span class="nx">x</span><span class="p">,</span> <span class="nx">tV</span><span class="p">.</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>      <span class="k">break</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">fill</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">context</span><span class="p">.</span><span class="nx">stroke</span><span class="p">();</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Above are the body drawing functions: drawJoint() and drawShape().  I&#8217;m not going to get into much detail here, but just know that these functions are responsible for taking the physics bodies and giving them a visual representation.  They make calls to the canvas context 2D drawing API to create the shapes that give us our falling rectangles and circles.  This is the simplest case and requires no external dependencies.  In practical cases though, you will more likely find images or other more clever uses like this one:</p>

<object width="640" height="390"><param name="movie" value="http://www.youtube.com/v/ZTwrQSOHdX0&hl=en_US&feature=player_embedded&version=3"></param><param name="allowFullScreen" value="true"></param><param name="allowScriptAccess" value="always"></param><embed src="http://www.youtube.com/v/ZTwrQSOHdX0&hl=en_US&feature=player_embedded&version=3" type="application/x-shockwave-flash" allowfullscreen="true" allowScriptAccess="always" width="640" height="390"></embed></object>


<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">createWorld</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">worldAABB</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2AABB</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">worldAABB</span><span class="p">.</span><span class="nx">minVertex</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="o">-</span><span class="mi">1000</span><span class="p">,</span> <span class="o">-</span><span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">worldAABB</span><span class="p">.</span><span class="nx">maxVertex</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="mi">1000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">gravity</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2Vec2</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">300</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">doSleep</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">world</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2World</span><span class="p">(</span><span class="nx">worldAABB</span><span class="p">,</span> <span class="nx">gravity</span><span class="p">,</span> <span class="nx">doSleep</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createGround</span><span class="p">(</span><span class="nx">world</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">world</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is where the Box2D JS physics world is created.  We define the bounds for the AABB physics with the minVertex and maxVertex properties and set the vector of gravity.  After we create those we apply them to a newly created world and create the ground that will be the base of our scene.</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">createGround</span><span class="p">(</span><span class="nx">world</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">groundSd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BoxDef</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">groundSd</span><span class="p">.</span><span class="nx">extents</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">30</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">groundSd</span><span class="p">.</span><span class="nx">restitution</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">groundBd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BodyDef</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">groundBd</span><span class="p">.</span><span class="nx">AddShape</span><span class="p">(</span><span class="nx">groundSd</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">groundBd</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="mi">470</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">groundBd</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">function</span> <span class="nx">createBall</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ballSd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2CircleDef</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">ballSd</span><span class="p">.</span><span class="nx">density</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">ballSd</span><span class="p">.</span><span class="nx">radius</span> <span class="o">=</span> <span class="mi">20</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">ballSd</span><span class="p">.</span><span class="nx">restitution</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">ballSd</span><span class="p">.</span><span class="nx">friction</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">ballBd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BodyDef</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">ballBd</span><span class="p">.</span><span class="nx">AddShape</span><span class="p">(</span><span class="nx">ballSd</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">ballBd</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">ballBd</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">function</span> <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">x</span><span class="p">,</span> <span class="nx">y</span><span class="p">,</span> <span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">,</span> <span class="nx">fixed</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="nx">fixed</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="nx">fixed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">boxSd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BoxDef</span><span class="p">();</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">fixed</span><span class="p">)</span> <span class="nx">boxSd</span><span class="p">.</span><span class="nx">density</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">boxSd</span><span class="p">.</span><span class="nx">restitution</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">boxSd</span><span class="p">.</span><span class="nx">friction</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">boxSd</span><span class="p">.</span><span class="nx">extents</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">width</span><span class="p">,</span> <span class="nx">height</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">boxBd</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">b2BodyDef</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">boxBd</span><span class="p">.</span><span class="nx">AddShape</span><span class="p">(</span><span class="nx">boxSd</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">boxBd</span><span class="p">.</span><span class="nx">position</span><span class="p">.</span><span class="nx">Set</span><span class="p">(</span><span class="nx">x</span><span class="p">,</span><span class="nx">y</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="nx">world</span><span class="p">.</span><span class="nx">CreateBody</span><span class="p">(</span><span class="nx">boxBd</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Above we have the body create functions: createGround(), createBall(), and createBox().  Other than the obvious, let&#8217;s talk about a few things going on here.  Each body is defined by a shape definition, and each shape definition has a number of properties that dictate how it will behave in the Box2D JS world  (see the <a href="http://www.kyucon.com/doc/box2d/" target="_blank">Box2D docs</a> for details).  Restitution, friction, and density affect how the shapes fall, move, and react.</p>

<p>The extents define the dimensions of the shapes, but probably not how you are accustomed.  Extents represent the distance from one corner of the shape to its center.  So a 100x100 box is actually defined by the extents shapeDef.extents.Set(50,50).</p>

<p>The shape definition is then used to define a body definition.  The body is then positioned in the world.  The positioning, like extents, is also based on the center of the body, not its corner.  Finally, the newly defined body, based on the shape definition, is added the world with the CreateBody() function.</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">createHelloWorld</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="c1">// H</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">70</span><span class="p">,</span> <span class="mi">395</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">370</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// E</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">140</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// L</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// L</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">250</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// O</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">285</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">315</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// W</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">420</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">415</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// O</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">460</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">445</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">475</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">460</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// R</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">495</span><span class="p">,</span> <span class="mi">410</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">518</span><span class="p">,</span> <span class="mi">425</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">515</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">525</span><span class="p">,</span> <span class="mi">390</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">510</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// L</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">560</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">545</span><span class="p">,</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// D</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">435</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">595</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">625</span><span class="p">,</span> <span class="mi">405</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">610</span><span class="p">,</span> <span class="mi">375</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// !</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">430</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="mi">650</span><span class="p">,</span> <span class="mi">380</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here&#8217;s my addition to the Box2D JS code.  By using a series of stacked boxes I create the infamous programmer&#8217;s first message, &#8220;Hello World!&#8221; (minus the comma, sorry).  No science or mystery here, just a lot of extents and positions for the boxes that compose my message.  And yes, I did cheat on the &#8220;E&#8221; and make it fixed, but not even I can defy the laws of physics for the sake of a code demo.</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="kd">function</span> <span class="nx">step</span><span class="p">(</span><span class="nx">cnt</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">stepping</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">timeStep</span> <span class="o">=</span> <span class="mf">1.0</span><span class="o">/</span><span class="mi">60</span><span class="p">;</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">iteration</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="nx">world</span><span class="p">.</span><span class="nx">Step</span><span class="p">(</span><span class="nx">timeStep</span><span class="p">,</span> <span class="nx">iteration</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">ctx</span><span class="p">.</span><span class="nx">clearRect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">canvasWidth</span><span class="p">,</span> <span class="nx">canvasHeight</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">drawWorld</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">ctx</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">setTimeout</span><span class="p">(</span><span class="s1">&#39;step(&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="nx">cnt</span> <span class="o">||</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&#39;</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The step() function is the what makes the whole thing work.  step() is called over and over, at specified intervals, to create the animation of our scene on the canvas.  The world&#8217;s Step() function is first called to apply one iteration of physics to our world&#8217;s bodies.  Next we clear the visual representation of the scene so that it can be redrawn by our drawWorld() function.  Finally we set the interval timer so that step() will be called again.  Again, Flash devs will recognize this as a similar methodology as using the ENTER_FRAME event.</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="c1">// main entry point</span>
</span><span class='line'><span class="nx">Event</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="nx">world</span> <span class="o">=</span> <span class="nx">createWorld</span><span class="p">();</span>
</span><span class='line'>  <span class="nx">ctx</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">).</span><span class="nx">getContext</span><span class="p">(</span><span class="s1">&#39;2d&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="kd">var</span> <span class="nx">canvasElm</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">canvasWidth</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">canvasHeight</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">canvasTop</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span><span class="p">);</span>
</span><span class='line'>  <span class="nx">canvasLeft</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">canvasElm</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">createHelloWorld</span><span class="p">();</span>
</span><span class='line'>
</span><span class='line'>  <span class="nx">Event</span><span class="p">.</span><span class="nx">observe</span><span class="p">(</span><span class="s1">&#39;canvas&#39;</span><span class="p">,</span> <span class="s1">&#39;click&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="c1">//createBox(world, Event.pointerX(e), Event.pointerY(e), 10, 10, false);</span>
</span><span class='line'>              <span class="nx">createBox</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
</span><span class='line'>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="nx">createBall</span><span class="p">(</span><span class="nx">world</span><span class="p">,</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">pointerX</span><span class="p">(</span><span class="nx">e</span><span class="p">),</span> <span class="nx">Event</span><span class="p">.</span><span class="nx">pointerY</span><span class="p">(</span><span class="nx">e</span><span class="p">));</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>  <span class="p">});</span>
</span><span class='line'>  <span class="nx">step</span><span class="p">();</span>
</span><span class='line'><span class="p">});</span>
</span><span class='line'><span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And this is where we kick everything off.  We use the Prototype event handling mechanism to wait until the window is loaded to start our code.  We first create the Box2D JS world and get the 2D context, dimensions, and position of our canvas.  After that I create the boxes that make up the Hello World message.  To finish up we listen for mouse clicks so that we can add more falling objects to the scene, since what good is a meticulously stacked Hello World if you can&#8217;t turn it into a pile of rubble?  The first step() is kicked off and our scene is ready to go!</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='html'><span class='line'><span class="nt">&lt;/head&gt;</span>
</span><span class='line'><span class="nt">&lt;body</span> <span class="na">style=</span><span class="s">&quot;margin:0px;&quot;</span><span class="nt">&gt;</span>
</span><span class='line'>    <span class="nt">&lt;canvas</span> <span class="na">id=</span><span class="s">&quot;canvas&quot;</span> <span class="na">width=</span><span class="s">&#39;800&#39;</span> <span class="na">height=</span><span class="s">&#39;500&#39;</span> <span class="na">style=</span><span class="s">&quot;background-color:#eeeeee;&quot;</span><span class="nt">&gt;&lt;/canvas&gt;</span>
</span><span class='line'><span class="nt">&lt;/body&gt;</span>
</span><span class='line'> <span class="nt">&lt;/html&gt;</span>
</span></code></pre></td></tr></table></div></figure>


<p>And to round out the breakdown, here&#8217;s the actual instance of the canvas element.  Its a very simple container and allows for all the heavy lifting to be done in the Javascript.  Just a reminder, the canvas element will NOT work in Internet Explorer unless you have the conditional check that includes excanvas if necessary, or if you happen to be test driving the IE9 beta.</p>

<h2>The Summary</h2>

<p>OK, well that turned out a lot longer and wordier than I was expecting, but 2D physics being utilized in HTML5 and Javascript is a simple topic.  Hopefully, though, if you made it all the way through you have a much better understanding of how they all play together and how you will create Newtonian worlds of your own.</p>

<p><strong><small_rant></strong>The difference in performance between different browsers is enough to drive you crazy.  In my personal experience, Chrome > Firefox > IE.  I know its early in the game and that <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie-9/home" target="_blank">IE 9</a> and <a href="http://www.mozilla.com/en-US/firefox/beta/" target="_blank">Firefox 4</a> will likely be right up to par with Chrome, but its this lag and inconsistency across the board that has me spending most of my web development time in Flash and AS3.</p>

<p>Also, I had trouble making this work in all versions of IE, so if you run into any problems with a particular browser, please let me know.<strong></small_rant></strong></p>

<p><strong>NOTE:</strong> The concatenated version of Box2D JS is a convenience I offer so that you don&#8217;t have to do all the individual includes shown on the Box2D JS site&#8217;s demos.  The minified version is that same concatenated version run through <a href="http://www.crockford.com/javascript/jsmin.html" target="_blank">JSMin</a>.  Both versions are based on version 0.1.0 of Box2D JS.  I am not a contributor to the Box2D JS project, just someone making it simpler to get into.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/17/packet-capture-with-c----amp--linux/">Packet capture with C++ &amp; Linux</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-17T11:28:00-05:00" pubdate data-updated="true">Nov 17<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>As part of a larger project I&#8217;m working on I need to refamiliarize myself with some old friends: C and <a href="http://www.tcpdump.org/" target="_blank">libcap</a>.  While I do have a healthy dislike for coding in C, I have a much healthier respect for those who have used it to create some pretty fantastic stuff.  It still takes conscious effort to not spend all my time wrapping C code in C++ objects, but I digress.</p>

<p>libpcap is a C library used to capture and analyze network packets off the wire, otherwise known as packet sniffing.  Some of the more prominent applications out there using it right now are <a href="http://www.snort.org/" target="_blank">Snort intrusion detection system</a>, <a href="http://www.wireshark.org/" target="_blank">Wireshark network analyzer</a> (formerly known as Ethereal), and the proprietor of libpcap, <a href="http://www.tcpdump.org/" target="_blank">tcpdump</a>.</p>

<p>Why would you want to be able to analyze packets in code and not use one of these applications?  Because packet sniffing, in the hands of someone knowledgeable in network protocols, can be a great, non-intrusive way to gather discrete or statistical information and tie it to other coded business logic.  There&#8217;s also that little, evil, <a href="http://www.blackhat.com/" target="_blank">don-your-black-hat</a>, I-wanna-be-a-hacker kind of feel to seeing packets you have no explicit reason to see.  Motives aside, let&#8217;s see a simple example of how it works in Linux with a little C++ tacked on.</p>

<h2>The Code</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;pcap.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">packetCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="nf">packetHandler</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pcap_pkthdr</span><span class="o">*</span> <span class="n">pkthdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u_char</span><span class="o">*</span> <span class="n">packet</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">++</span><span class="n">packetCount</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; packet(s) captured&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
</span><span class='line'>  <span class="n">pcap_t</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">errbuf</span><span class="p">[</span><span class="n">PCAP_ERRBUF_SIZE</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">dev</span> <span class="o">=</span> <span class="n">pcap_lookupdev</span><span class="p">(</span><span class="n">errbuf</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">dev</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_lookupdev() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">errbuf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">descr</span> <span class="o">=</span> <span class="n">pcap_open_live</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BUFSIZ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">errbuf</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">descr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_open_live() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">errbuf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">pcap_loop</span><span class="p">(</span><span class="n">descr</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">packetHandler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_loop() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pcap_geterr</span><span class="p">(</span><span class="n">descr</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;capture finished&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Output</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>1 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>2 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>3 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>4 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>5 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>6 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>7 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>8 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>9 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>10 packet<span class="o">(</span>s<span class="o">)</span> captured
</span><span class='line'>capture finished
</span></code></pre></td></tr></table></div></figure>


<p>In this very basic example we are simply setting up a network interface to use libpcap, capturing a few packets, and exiting with a message.  Pretty vanilla, but there&#8217;s a good bit going on here.  let&#8217;s break it down in more detail.</p>

<h2>The Breakdown</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;pcap.h&gt;</span>
</span><span class='line'><span class="n">using</span> <span class="n">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here along with standard includes we also include pcap.h.  This is the header file that is necessary for all libpcap operations and constants.</p>

<hr><br><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">static</span> <span class="kt">int</span> <span class="n">packetCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="kt">void</span> <span class="nf">packetHandler</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pcap_pkthdr</span><span class="o">*</span> <span class="n">pkthdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u_char</span><span class="o">*</span> <span class="n">packet</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="o">++</span><span class="n">packetCount</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; packet(s) captured&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is the callback packet handler function that will do all the heavy lifting when it comes to network analysis.  This callback is referenced later by the <a href="http://www.manpagez.com/man/3/pcap_loop/" target="_blank">pcap_loop()</a> function.  Every packet that pcap receives will be passed to this function.  Here&#8217;s the explanation of the parameters:</p>

<ul>
    <li><strong>userData </strong>- a pointer to user defined data that can be passed into each callback, as defined in the <a href="http://www.manpagez.com/man/3/pcap_loop/" target="_blank">pcap_loop()</a> call&#8217;s 4th parameter.</li>
    <li><strong>pkthdr </strong>- the pcap packet header that includes relevant information about the packet as it relates to pcap&#8217;s capture.</li>
    <li><strong>packet </strong>- a pointer to the actual packet that will be analyzed.</li>
</ul>


<p>For the sake of this example, we won&#8217;t be doing any protocol analysis and will simply be counting the number of packets that pass over our listening interface.</p>

<hr><br><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="kt">char</span> <span class="o">*</span><span class="n">dev</span><span class="p">;</span>
</span><span class='line'>  <span class="n">pcap_t</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">errbuf</span><span class="p">[</span><span class="n">PCAP_ERRBUF_SIZE</span><span class="p">];</span>
</span></code></pre></td></tr></table></div></figure>


<p>The start of our packet capture program.</p>

<ul>
<li><strong>dev</strong> - this will hold the name of the interface on which we will sniff</li>
<li><strong>descr</strong> - The descriptor, or handle, for the libpcap packet capture</li>
<li><strong>errbuf</strong> - a character buffer to contain any potential errors from libpcap.  The max error size is defined by <strong>PCAP_ERRBUF_SIZE</strong> in pcap.h.</li>
</ul>


<hr><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">dev</span> <span class="o">=</span> <span class="n">pcap_lookupdev</span><span class="p">(</span><span class="n">errbuf</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">dev</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_lookupdev() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">errbuf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we use <a href="http://www.manpagez.com/man/3/pcap_lookupdev/" target="_blank">pcap_lookupdev()</a> to find an available network interface on which to sniff.  The name of the interface is returned in the <strong>dev</strong> character array.  If there is an error or if no interface is available, <a href="http://www.manpagez.com/man/3/pcap_lookupdev/" target="_blank">pcap_lookupdev()</a> returns a NULL value and fills the <strong>errbuf</strong> with the relevant error information.  Returning a failure value then populating an error buffer is common practice for libpcap functions that end in error.</p>

<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="n">descr</span> <span class="o">=</span> <span class="n">pcap_open_live</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">BUFSIZ</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">errbuf</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">descr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_open_live() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">errbuf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Next we create our packet capture descriptor using <a href="http://www.manpagez.com/man/3/pcap_open_live/" target="_blank">pcap_open_live()</a>.  This is how we will enable our target network interface for sniffing.  It will return a valid descriptor on success, a NULL on failure.  The parameters are as follows:</p>

<ul>
<li><strong>device</strong> - the name of the network interface to be used by libpcap for sniffing.  We found it using <a href="http://www.manpagez.com/man/3/pcap_lookupdev/" target="_blank">pcap_lookupdev()</a>.</li>
<li><strong>snaplen</strong> - the maximum snap length, or packet size, to be handled by this descriptor.  We using the system defined <strong>BUFSIZ</strong> constant.</li>
<li><strong>promisc</strong> - Determines whether or not the interface will listen in <a href="http://en.wikipedia.org/wiki/Promiscuous_mode" target="_blank">promiscuous mode</a>.  Promiscuous mode will analyze packets not specifically addressed for your machine, like if you were attached to a hub or a <a href="http://en.wikipedia.org/wiki/Port_mirroring" target="_blank">mirrored switch port</a>.  1 turns it on, 0 turns it off.</li>
<li><strong>to_ms</strong> - this is the packet read timeout in milliseconds.  Specify -1 for no timeout.</li>
<li><strong>errbuf</strong> - In case of an error, this is where a descriptive message will be left.</li>
</ul>


<hr>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='c'><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">pcap_loop</span><span class="p">(</span><span class="n">descr</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="n">packetHandler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_loop() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pcap_geterr</span><span class="p">(</span><span class="n">descr</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;capture finished&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And here&#8217;s the call we&#8217;ve been waiting for: <a href="http://www.manpagez.com/man/3/pcap_loop/" target="_blank">pcap_loop()</a>.  This will take our pcap descriptor and start sniffing packets, sending them all to our packet handler callback function, aptly named packetHandler().  Here&#8217;s <a href="http://www.manpagez.com/man/3/pcap_loop/" target="_blank">pcap_loop()&#8217;s</a> parameters:</p>

<ul>
<li><strong>descr</strong> - the packet capture descriptor that we have initialized in the previous steps.</li>
<li><strong>count</strong> - the number of packets to capture before <a href="http://www.manpagez.com/man/3/pcap_loop/" target="_blank">pcap_loop()</a> exits.  Use -1 or 0 to use no limit.</li>
<li><strong>callback</strong> - this is the callback function that is called every time pcap sniffs a packet.  As specified above in the packetHandler() function, it receives relevant user data, pcap headers, and full packet data.  It is the work horse of the packet analysis process.  If creating a callback of your own, be sure to follow the function signature given in packetHandler().</li>
<li><strong>userData</strong> - this is an array of unsigned bytes to be sent in with each packet.  You can use it to hold any relevant user data you would like to send to the callback as its first paramater.   You can also specify NULL if you wish to pass no user data to the callback.</li>
</ul>


<hr>


<h2>The Summary</h2>

<p>With this basic example you can now use C/C++ to capture network packets.  But keeping a count of packets isn&#8217;t terribly interesting, is it?  No, I don&#8217;t think so either.  So what should I do next?  If you managed to make it all the way to this summary, you can help me decide what aspects of packet capture or C/C++ to show case next.  Comment on one of the following or ad your own idea and I&#8217;ll probably do it next!</p>

<ul><li>Learn how to use <a href="http://en.wikipedia.org/wiki/Berkeley_Packet_Filter" target="_blank">Berkeley packet filters</a> to focus and make more efficient your packet sniffing.</li>
<li>Process offline packet capture dumps from some of the other programs I mentioned earlier.  It&#8217;s a critical skill for testing.</li>
<li>Use libpcap to learn more about the interfaces on your system?</li>
<li>Wrap this ugly C code in some much more developer friendly C++ objects.</li>
<li>Get right into the nitty gritty and start learning how to analyze packet data.</li>
</ul>


<p>The choice is your&#8217;s guys.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/11/11/setting-up-wireless-on-centos-5/">Setting Up Wireless on Centos 5</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-11-11T20:40:00-05:00" pubdate data-updated="true">Nov 11<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Centos isn&#8217;t exactly the best Linux desktop distro.  <a href="http://www.ubuntu.com/" target="_blank">Ubuntu</a>, <a href="http://fedoraproject.org/get-fedora" target="_blank">Fedora</a>, or <a href="http://www.linuxmint.com/" target="_blank">Mint</a> jump to mind as better alternatives.  But that&#8217;s not Centos&#8217;s fault as its core focus is stability.  For this reason, Centos is purposely a bit behind the times and only adds proven functionality to its core, as well as its published package repositories.</p>

<p>Unfortunately, though, I need a C++ development environment that will suit a Centos server project I&#8217;m working on.  Wireless network connectivity was the first hurdle I ran into.  No out of the box support for my HP laptop.  In fact, when trying to enable the wireless interface on my laptop I got nothing but a very cryptic error message:</p>

<pre lang="dos">[root@localhost ~]# ifup wlan0
Determining IP information for wlan0...SIOCSIFFLAGS: No such file or directory.</pre>


<p>Helpful, I know.  But with a little bit of research I found the <a href="http://wiki.centos.org/HowTos/Laptops/Wireless" target="_blank">setting up wireless</a> section of the Centos laptop FAQs.  In here it states Centos does not come with the required wireless firmware for any laptops that don&#8217;t allow its free distribution.  This then leaves it up to us, the users, to track it down and install it.  Here&#8217;s how:</p>

<ol>
    <li>Open up your <strong><em>/etc/sysconfig/hwconf</em></strong> and find the entry for your wireless card. Â You can speed this up by searching for the device name of your card, <strong>wlan0</strong> in my case, or entries that have the class <strong>NETWORK</strong>.  The entry you want will look something like this:

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class: NETWORK
</span><span class='line'>bus: PCI
</span><span class='line'>detached: 0
</span><span class='line'>device: wlan0
</span><span class='line'>driver: iwl3945
</span><span class='line'>desc: "Intel Corporation PRO/Wireless 3945ABG [Golan] Network Connection"
</span><span class='line'>network.hwaddr: xx:xx:xx:xx:xx:xx
</span><span class='line'>vendorId: 8086
</span><span class='line'>deviceId: 4222
</span><span class='line'>subVendorId: 103c
</span><span class='line'>subDeviceId: 135b
</span><span class='line'>pciType: 1
</span><span class='line'>pcidom:    0
</span><span class='line'>pcibus:  2
</span><span class='line'>pcidev:  0
</span><span class='line'>pcifn:  0</span></code></pre></td></tr></table></div></figure>

</li>
    <li>In your wireless card&#8217;s entry, locate the name of the driver used. Â In my case it was <strong>iwl3945</strong>.
<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>driver: iwl3945</span></code></pre></td></tr></table></div></figure>

</li>
    <li>Goto <a href="http://wiki.centos.org/HowTos/Laptops/Wireless">http://wiki.centos.org/HowTos/Laptops/Wireless</a> and follow the instructions for your particular wireless driver. Â In most cases this involves <a href="http://wiki.centos.org/AdditionalResources/Repositories/RPMForge?action=show&amp;redirect=Repositories/RPMForge" target="_blank">setting up RPMForge for yum</a>, using yum to install driver firmware, then enabling the driver module.</li>
    <li>(OPTIONAL) Disable your network and wpa_supplicant services and enable the NetworkManager.

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[root@localhost ~]# chkconfig network off
</span><span class='line'>[root@localhost ~]# service network stop
</span><span class='line'>[root@localhost ~]# chkconfig wpa_supplicant off
</span><span class='line'>[root@localhost ~]# service wpa_supplicant stop
</span><span class='line'>[root@localhost ~]# chkconfig NetworkManager on
</span><span class='line'>[root@localhost ~]# service NetworkManager start</span></code></pre></td></tr></table></div></figure>

</li>
</ol>


<p>And there you have it, wireless connectivity on your Centos 5 desktop.  Not exactly a breeze, but it&#8217;s not rocket science either once you know the steps involved.  Why do I have a feeling this will soon become a series or articles related to things that should be easy but aren&#8217;t on desktop Centos?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/15/away3d-drunk-simulator/">Away3D Drunk Simulator</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-15T12:59:00-04:00" pubdate data-updated="true">Oct 15<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/away3d_drunk/away3d_drunk.html" class="fancybox.iframe"><img title="away3d_drunk" src="/images/drunk.jpg" alt="" width="638" height="478" /></a></p>


<p>&rarr; <a href="/demos/away3d_drunk/away3d_drunk.html" class="fancybox.iframe">Click here</a> or the image above for the demo.
&rarr; View the <a href="/demos/away3d_drunk/srcview/index.html">source code</a>.</p>

<p>I decided to have a little more fun with the motion blur technique that I posted about earlier this week.  Rather than blur individual objects in the scene, I blurred the entire scene giving a you a view through beer goggles engineered in Actionscript.  And to get in the mood I poured myself a glass of Single Barrel Jack Daniel&#8217;s.  OK, probably wasn&#8217;t necessary, but Jack Daniel&#8217;s is like bacon: it makes everything better.</p>

<p>Be sure to play with the slider at the top of the demo.  Moving it from left to right will gradually increase your level of intoxication, making the motion blur more extreme and longer lasting.  This in turn has the effect of making the frame rate really low, but it actually works well in the demo because it also simulates the delayed reflexes of being wasted.  At least thats how I plan to explain away occasional single digit FPS.</p>

<p>Having fun haphazardly swaying through my little 3d scene.  While this seems like a goofy effect, it probably has some pretty interesting applications in games.  It seems like a great way to simulate a &#8220;shell shocked&#8221; effect in a battle or perhaps blurred vision when moving at extremely fast speeds.  Got any other idea?</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/14/away3d-motion-blur/">Away3D Motion Blur</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-14T08:47:00-04:00" pubdate data-updated="true">Oct 14<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/away3d_motion/away3d_motion.html" class="fancybox.iframe"><img title="away3d_motion" src="/images/motionblur.jpg" alt="" width="445" height="331" /></a></p>


<p>â†’ <a class="fancybox.iframe" href="/demos/away3d_motion/away3d_motion.html">Click here</a> or the image above for the demo.
â†’ View the <a href="/demos/away3d_motion/srcview/index.html">source code</a>.</p>

<p>This was a just for fun idea that popped into my head yesterday.  I&#8217;m always trying to find programmatic ways to add to the appeal of some of my 3D effects.  What better way to jazz up some 3D objects than to view them as though you&#8217;re wasted?!</p>

<p>I&#8217;ve got a lot of irons in the fire lately, so this one was quick and dirty. Â Basically I create an extra View3D in which to render the &#8220;blurred&#8221; objects. Â I take a snapshot of this view (50 in fact), overlay it on a separate background View3D, and use <a href="http://www.greensock.com/tweenlite/" target="_blank">TweenLite</a> to gradually fade the opacity of each snapshot.</p>

<p>In the end you get this pretty neat motion blur effect on your 3D objects.  There&#8217;s a lot more that could be added to this to spice it up.  If I had more time to devote to it I would add a BlurFilter toggle, which makes the motion blur look better but affects performance.  Other settings you could vary to alter the effect are:</p>

<ul>
    <li>The speed of the objects</li>
    <li>The number of snapshots taken</li>
    <li>How fast the snapshots fade</li>
    <li>The scale of the fading snapshots</li>
</ul>


<p>and I&#8217;m sure there&#8217;s more. Â Try it out. Â You could give your scenes a truly inebriated look by using only one View3D. Â By doing this you&#8217;ll motion blur the entire viewable scene. Â Maybe I&#8217;ll strap on some Away3D beer goggles in the future and give that a shot! Â Let me know if you beat me to it.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/10/04/away3d-morphing-with-heightmapmodifier/">Away3D Morphing with HeightMapModifier</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-10-04T07:38:00-04:00" pubdate data-updated="true">Oct 4<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/away3d_HeightMapModifier/away3d_HeightMapModifier.html" class="fancybox.iframe"><img title="away3d_HeightMapModifier" src="/images/hmm.jpg" alt="" width="560" height="417" /></a></p>


<p>&rarr; <a href="/demos/away3d_HeightMapModifier/away3d_HeightMapModifier.html">Click here</a> or the image above for the demo.
&rarr; View the <a href="/demos/away3d_HeightMapModifier/srcview/index.html">source code</a>.</p>

<p>As usual, shortly after finishing an Away3D demo an Away3d dev (this time <a href="http://www.closier.nl/blog/" target="_blank">Fabrice Closier</a>) suggests a better way to do it.  In my previous 2 demos I created fluid and morphing effects on planar meshes using a modified version of the SkinExtrude class.</p>

<p>As per Fabrice&#8217;s suggestion, this time I did the same using the HeightMapModifier class.  No modifications to Away3D source code necessary and it works on any mesh, planar or otherwise.  In this example I apply dynamic height maps to a sphere to create some pretty wild meshes.  Be sure to toggle to wireframe mode so that you can get a good look at how the vertices move with each height map transition.  Here&#8217;s a snippet of how it works:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class='as3'><span class='line'><span class="o">[</span><span class="n">Embed</span><span class="o">(</span><span class="s2">&quot;heightmap.jpg&quot;</span><span class="o">)]</span> <span class="kd">private</span> <span class="kd">var</span> <span class="n">hmImage</span><span class="p">:</span><span class="kt">Class</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="kd">var</span> <span class="n">heightData</span><span class="p">:</span><span class="kt">BitmapData</span> <span class="o">=</span> <span class="n">Cast</span><span class="o">.</span><span class="na">bitmap</span><span class="o">(</span><span class="n">hmImage</span><span class="o">);</span>
</span><span class='line'><span class="kd">var</span> <span class="n">sphere</span><span class="p">:</span><span class="kt">Sphere</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">Sphere</span><span class="o">();</span>
</span><span class='line'><span class="kd">var</span> <span class="n">heightMapModifier</span><span class="p">:</span><span class="kt">HeightMapModifier</span> <span class="o">=</span> <span class="k">new</span> <span class="kt">HeightMapModifier</span><span class="o">(</span><span class="n">sphere</span><span class="o">,</span> <span class="n">heightData</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// offset determines the minimum height value of each vertice</span>
</span><span class='line'><span class="n">heightMapModifier</span><span class="o">.</span><span class="na">offset</span> <span class="o">=</span> <span class="mi">300</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// scale is the multiplier for the calculated height values</span>
</span><span class='line'><span class="n">heightMapModifier</span><span class="o">.</span><span class="na">scale</span> <span class="o">=</span> <span class="n">ELEVATION_HEIGHT</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// execute the modifier</span>
</span><span class='line'><span class="n">heightMapModifier</span><span class="o">.</span><span class="na">execute</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>One other cool note to remember is that you can also use negative values for scale.  By doing so you can create indents rather than bumps on your mesh.  See what happens when you turn the &#8220;Elevation height&#8221; all the way down on this demo.</p>

<p>Also in the example I utilize the EnviroBitmapMaterial to give our target mesh a shiny, reflective appearance.  True reflection is very processor intensive and is outside the realm of feasibility right now for 3D Flash.  But by using environment materials, we can &#8220;fake&#8221; a reflective surface by using an environment map that closely matches the Away3D scene.  In this case the environment map I used for the EnviroBitmapMaterial is one of the images I used to create the skybox for the scene.  You&#8217;ll notice the reflective effect even more as the mesh morphs or when you orbit around it.</p>

<p>There you have it, mesh morphing and reflective materials in Away3D.  With a little luck, this&#8217;ll be the last time you have to hear me talk about it for a while!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/30/away3d-mesh-morphing/">Away3D Mesh Morphing</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-30T08:50:00-04:00" pubdate data-updated="true">Sep 30<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/away3d_morph/away3d_morph.html" class="fancybox.iframe"><img title="away3d_morph" src="/images/morph.jpg" alt="" width="561" height="355" /></a></p>


<p>â†’ <a class="fancybox.iframe" href="/demos/away3d_morph/away3d_morph.html">Click here</a> or the image above for the demo.
â†’ View the <a href="/demos/away3d_morph/srcview/index.html">source code</a>.</p>

<p>As I have a way of doing, I immediately started working on a better demo upon finishing the last one on height maps in Away3D.  In this demo I use simple bitmap transitioning and my modified Away3D SkinExtrude class (SavageLookSkinExtrude) to create a morphing effect.  Basically one mesh&#8217;s vertices will smoothly transition to the position of the next mesh&#8217;s vertices based on the given height maps.</p>

<p>I mentioned <a href="http://exey.ru/blog/home/fluid-simulation-pv3d-and-away3d" target="_blank">Exey Panteleev&#8217;s fluid simulation in PaperVision3D and Away3D</a> in my last post as a method superior to dynamic height maps for creating a flowing, fluid mesh in Away3D.  I still stand by the point.  But as shown in this demo, dynamic height maps offer many more possibilities as provided by the control you have over the 2D height maps.  In fact, you can have a designer, with no knowledge of Away3D of 3D math, create your height maps and you can handle the morphing.</p>

<p>The shapes you can morph are only limited by your imagination&#8230; OK, that&#8217;s not entirely true.  The shapes will be limited by your ability to create, or find, height maps that suit your needs.  Also, with this method you are limited to morphing the plane that is the base of the SkinExtrude, or in this case the SavageLookSkinExtrude.  Morphing other 3D meshes or primitives is beyond the scope of this technique, and to be honest, beyond my expertise at this point in time.</p>

<p>Even with those limitations, though, this method offers some really eye catching dimension to the toolkit of a hopelessly code driven 3D artist like myself.  Play around with it and let me know if you come up with something cool.  I&#8217;d love to see this method work with some more interesting height maps, like facial maps.</p>

<p><strong>NOTE:</strong> I&#8217;m currently inquiring on the <a href="http://groups.google.com/group/away3d-dev/browse_thread/thread/f5dd17752c1d051f" target="_blank">Away3D Dev list</a> how to get the subdivision size of the SkinExtrude smaller so that I can get more accuracy and precision.  Unfortunately as it stands triangles start to disappear when the subdivision size goes lower than 20.  I&#8217;ll update this post if we come up with a solution.  Please let me know if you come up with one yourself.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2010/09/29/dynamic-heightmaps-in-away3d/">Dynamic Heightmaps in Away3D</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-09-29T07:42:00-04:00" pubdate data-updated="true">Sep 29<span>th</span>, 2010</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p style="text-align: center;"><a href="/demos/away3d_heightmap/away3d_heightmap.html" class="fancybox.iframe"><img title="away3d_heightmap" src="/images/water.jpg" alt="" width="561" height="420" /></a></p>


<p>â†’ Click the image above for the demo (or <a class="fancybox.iframe" href="/demos/away3d_heightmap/away3d_heightmap.html">click here</a>).
â†’ View the <a href="/demos/away3d_heightmap/srcview/index.html">source code</a>.</p>

<p>While there might be other simpler ways to do it (<a href="http://code.google.com/p/as3dmod/" target="_blank">AS3Mod</a> comes to mind), I found myself working with the Elevation and SkinExtrude classes in Away3D and created some cool flowing effects. Â The basic idea is that you dynamically create a gradient bitmap in AS3, tween its appearance on each frame, and use that bitmap as a heightmap for a SkinExtrude. Â This will give you the effects shown in the demo above.</p>

<p>I had to make a few slight changes to the existing SkinExtrude class in order to make it more efficient to reuse in each frame. Â This is the <a href="/demos/away3d_heightmap/srcview/" target="_self">SavageLookSkinExtrude class</a> found in the source code. Â It is identical to the SkinExtrude class found in away3d.extrusions, except for the annotated sections that allow me to generate the heightmap extrusion more than once per instantiation.</p>

<p>The inspiration for this demo came from 2 places.  The first is <a href="http://exey.ru/blog/home/fluid-simulation-pv3d-and-away3d" target="_blank">Exey Panteleev&#8217;s (much better) fluid simulation</a>. The code displayed on his page is for PaperVision3D, but there&#8217;s a link for the Away3D code as well.  All things being equal, you should be following the footsteps of Exey since his solution performs much better than mine. Â  I just did this demo cause frankly I&#8217;m not that good at 3D math and I could barely understand the math involved in his solution. The only real advantage of my method is that you have more control over the pattern as it is driven by the bitmap.</p>

<p>My other source of inspiration, as well as pure tutelage with Away3D height maps and SkinExtrude, is <a href="http://jasonbejot.com/?p=307" target="_blank">Jason Bejot&#8217;s &#8220;Create Terrain in Away3D&#8221; tutorial</a>.  Jason gives a very easy to follow and concise look at how you can use Away3D&#8217;s Elevation and SkinExtrude classes in conjunction with grayscale height maps to create realistic terrain.  I basically just took his method and put it in motion.</p>

<p>As you can see, there&#8217;s more than one way to skin this cat. Â Play around with it and see what kind of creations you can make with heightmaps and SkinExtrude. Â I don&#8217;t have the time to play with it now, but I feel like bitmaps given the PixelBender treatment might create some pretty wild 3D objects.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/blog/page/9/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/blog/page/7/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
<section>
	<span>
		<img src="http://www.gravatar.com/avatar/39ebccd822b6fb533e004ee722c38e9d?s=150" alt="Gravatar of Tony Lukasavage " title="Gravatar of Tony Lukasavage" />
	</span>
</section>


  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tonylukasavage" class="twitter-follow-button" data-show-count="true">Follow @tonylukasavage</a>
  

<link href="/stylesheets/github-buttons.css" media="screen, projection" rel="stylesheet" type="text/css">
<span class="github-btn" data-user="tonylukasavage" data-type="follow" data-count="1"></span>
<script type="text/javascript" src="/javascripts/github-buttons.js"></script><style type="text/css">
.gittip-img {
	background-image: url(/images/gittip.png);
	background-repeat: no-repeat;
  background-position: 0 0;
  background-color: transparent;
	display: inline-block;
	height: 24px;
	width: 24px;
	margin-right: 3px;
}
</style>
<p><span class="gittip-img"></span>
<script data-gittip-username="Tony Lukasavage"
        data-gittip-widget="button"
        src="//gttp.co/v1.js"></script></p><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/24/good-bye-appcelerator/">Good-bye Appcelerator</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/24/optional-callbacks-for-flexible-apis-in-javascript/">Callback Spotting: Flexible APIs in Javascript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/21/appcelerator-api-builder-demo/">Appcelerator API Builder Demo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/29/custom-assertions-in-should-dot-js/">Custom assertions in should.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/24/f-ck-you/">F*ck You, Show Me</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating&#8230;</li>
  </ul>
  
  <a href="https://github.com/tonylukasavage">@tonylukasavage</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tonylukasavage',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

 <section>
     <h1>Twitter</h1>
     <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/tonylukasavage" data-widget-id="422932897931083776">Tweets by @tonylukasavage</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>


 </section>




  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Tony Lukasavage -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'tonylukasavage';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<!-- Add jQuery library -->
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript">
jQuery.noConflict();
</script>

<!-- Add github repo widget -->
<script type="text/javascript" src="/javascripts/jquery.githubRepoWidget.min.js"></script>

<!-- Add fancyBox main JS file -->
<script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.4"></script>

<!-- fire up fancybox -->
<script type="text/javascript">
(function($) {
	$(function() {
		$('[class*=fancybox]').fancybox();
	});
})(jQuery);
</script>

</body>
</html>
