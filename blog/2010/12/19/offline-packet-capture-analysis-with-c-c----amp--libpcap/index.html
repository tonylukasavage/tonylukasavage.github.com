
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Offline packet capture analysis with C/C++ &amp; libpcap - Tony Lukasavage</title>
  <meta name="author" content="Tony Lukasavage">

  
  <meta name="description" content="The Overview At the request of one of my faithful readers in my original article on packet capture with libpcap, I decided to post a guide to offline &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://tonylukasavage.github.com/blog/2010/12/19/offline-packet-capture-analysis-with-c-c----amp--libpcap/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/stylesheets/data-table.css" media="screen, projection" rel="stylesheet" type="text/css" />
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Tony Lukasavage" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="/fancybox/source/jquery.fancybox.css?v=2.1.4" media="screen" />

<style type="text/css">
ul#grid {
  padding: 0;
  list-style: none;
  margin: 20px auto 0;
  width: 100%;  
  }

#grid li {
  float: left;
  padding: 0;
  margin: 0 5px 10px 5px;
  } 

#grid li a {
  display: block;
  }

#grid li img {
  background-color: white;
  padding: 7px; margin: 0;
  border: 1px dotted #58595b;
  width: 140px;
  height: 120px;
  }
</style>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-39965828-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <header role="banner"><hgroup id="theHeader">
  <h1><a href="/">Tony Lukasavage</a></h1>
  
    <h2>Caffeine. Whiskey. Code. Mostly the last one.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:tonylukasavage.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Offline packet capture analysis with C/C++ &amp; libpcap</h1>
    
    
      <p class="meta">
        








  


<time datetime="2010-12-19T21:49:00-05:00" pubdate data-updated="true">Dec 19<span>th</span>, 2010</time>
        
      </p>
    
  </header>


<div class="entry-content"><h2>The Overview</h2>

<p>At the request of one of my faithful readers in my original article on packet capture with libpcap, I decided to post a guide to offline packet capture processing.  Why is this useful?  Because popular packet capture programs like <a href="http://www.wireshark.org/">Wireshark</a> or <a href="http://www.tcpdump.org/">tcpdump</a> can save captures to files that can be processed later.  You can then apply your specialized code to these previously captured packets.</p>

<h2>The Code</h2>

<p><strong>NOTE:</strong> This program makes use of the <a href="http://wiki.wireshark.org/SampleCaptures?action=AttachFile&do=view&target=http.cap">http.cap</a> Wireshark packet capture sample.</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;pcap.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;net/ethernet.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;netinet/ip.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;netinet/in.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;netinet/tcp.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;arpa/inet.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">packetHandler</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pcap_pkthdr</span><span class="o">*</span> <span class="n">pkthdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u_char</span><span class="o">*</span> <span class="n">packet</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">pcap_t</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">errbuf</span><span class="p">[</span><span class="n">PCAP_ERRBUF_SIZE</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// open capture file for offline processing</span>
</span><span class='line'>  <span class="n">descr</span> <span class="o">=</span> <span class="n">pcap_open_offline</span><span class="p">(</span><span class="s">&quot;http.cap&quot;</span><span class="p">,</span> <span class="n">errbuf</span><span class="p">);</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">descr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_open_live() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">errbuf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="c1">// start packet processing loop, just like live capture</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">pcap_loop</span><span class="p">(</span><span class="n">descr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">packetHandler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_loop() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pcap_geterr</span><span class="p">(</span><span class="n">descr</span><span class="p">);</span>
</span><span class='line'>      <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;capture finished&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">packetHandler</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pcap_pkthdr</span><span class="o">*</span> <span class="n">pkthdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u_char</span><span class="o">*</span> <span class="n">packet</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="k">const</span> <span class="k">struct</span> <span class="n">ether_header</span><span class="o">*</span> <span class="n">ethernetHeader</span><span class="p">;</span>
</span><span class='line'>  <span class="k">const</span> <span class="k">struct</span> <span class="n">ip</span><span class="o">*</span> <span class="n">ipHeader</span><span class="p">;</span>
</span><span class='line'>  <span class="k">const</span> <span class="k">struct</span> <span class="n">tcphdr</span><span class="o">*</span> <span class="n">tcpHeader</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">sourceIp</span><span class="p">[</span><span class="n">INET_ADDRSTRLEN</span><span class="p">];</span>
</span><span class='line'>  <span class="kt">char</span> <span class="n">destIp</span><span class="p">[</span><span class="n">INET_ADDRSTRLEN</span><span class="p">];</span>
</span><span class='line'>  <span class="n">u_int</span> <span class="n">sourcePort</span><span class="p">,</span> <span class="n">destPort</span><span class="p">;</span>
</span><span class='line'>  <span class="n">u_char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span><span class='line'>  <span class="kt">int</span> <span class="n">dataLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'>  <span class="n">string</span> <span class="n">dataStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">ethernetHeader</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="o">*</span><span class="p">)</span><span class="n">packet</span><span class="p">;</span>
</span><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">ntohs</span><span class="p">(</span><span class="n">ethernetHeader</span><span class="o">-&gt;</span><span class="n">ether_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">ETHERTYPE_IP</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">ipHeader</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="o">*</span><span class="p">)(</span><span class="n">packet</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">));</span>
</span><span class='line'>      <span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ipHeader</span><span class="o">-&gt;</span><span class="n">ip_src</span><span class="p">),</span> <span class="n">sourceIp</span><span class="p">,</span> <span class="n">INET_ADDRSTRLEN</span><span class="p">);</span>
</span><span class='line'>      <span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ipHeader</span><span class="o">-&gt;</span><span class="n">ip_dst</span><span class="p">),</span> <span class="n">destIp</span><span class="p">,</span> <span class="n">INET_ADDRSTRLEN</span><span class="p">);</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">ipHeader</span><span class="o">-&gt;</span><span class="n">ip_p</span> <span class="o">==</span> <span class="n">IPPROTO_TCP</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">tcpHeader</span> <span class="o">=</span> <span class="p">(</span><span class="n">tcphdr</span><span class="o">*</span><span class="p">)(</span><span class="n">packet</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">));</span>
</span><span class='line'>          <span class="n">sourcePort</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">tcpHeader</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">);</span>
</span><span class='line'>          <span class="n">destPort</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">tcpHeader</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">);</span>
</span><span class='line'>          <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_char</span><span class="o">*</span><span class="p">)(</span><span class="n">packet</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">));</span>
</span><span class='line'>          <span class="n">dataLength</span> <span class="o">=</span> <span class="n">pkthdr</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">));</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// convert non-printable characters, other than carriage return, line feed,</span>
</span><span class='line'>          <span class="c1">// or tab into periods when displayed.</span>
</span><span class='line'>          <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dataLength</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">32</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">126</span><span class="p">)</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">dataStr</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>              <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>                  <span class="n">dataStr</span> <span class="o">+=</span> <span class="s">&quot;.&quot;</span><span class="p">;</span>
</span><span class='line'>              <span class="p">}</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>          <span class="c1">// print the results</span>
</span><span class='line'>          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sourceIp</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sourcePort</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; -&gt; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">destIp</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">destPort</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">(</span><span class="n">dataLength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">dataStr</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<h2>The Breakdown</h2>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="cp">#include &lt;iostream&gt;</span>
</span><span class='line'><span class="cp">#include &lt;pcap.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;net/ethernet.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;netinet/ip.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;netinet/in.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;netinet/tcp.h&gt;</span>
</span><span class='line'><span class="cp">#include &lt;arpa/inet.h&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="kt">void</span> <span class="n">packetHandler</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pcap_pkthdr</span><span class="o">*</span> <span class="n">pkthdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u_char</span><span class="o">*</span> <span class="n">packet</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>These are the includes and declarations necessary for reading the packet captures.  The first 2 are self explanatory, the following 5 includes might be less so.  These are used for parsing and transforming data found in packets.  The functions and structures included in these headers are integral to packet processing and are available natively on Linux systems (Ubuntu in this case).</p>

<hr><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">int</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
</span><span class='line'><span class="n">pcap_t</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>
</span><span class='line'><span class="kt">char</span> <span class="n">errbuf</span><span class="p">[</span><span class="n">PCAP_ERRBUF_SIZE</span><span class="p">];</span>
</span><span class='line'>
</span><span class='line'><span class="c1">// open capture file for offline processing</span>
</span><span class='line'><span class="n">descr</span> <span class="o">=</span> <span class="n">pcap_open_offline</span><span class="p">(</span><span class="s">&quot;http.cap&quot;</span><span class="p">,</span> <span class="n">errbuf</span><span class="p">);</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">descr</span> <span class="o">==</span> <span class="nb">NULL</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_open_live() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">errbuf</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>After entering the main execution, we go straight to opening our target packet capture file, <a href="http://wiki.wireshark.org/SampleCaptures?action=AttachFile&do=view&target=http.cap">http.cap</a>.  To do this we use <a href="http://www.manpagez.com/man/3/pcap_open_offline/">pcap_open_offline()</a> and give it the capture filename and an error buffer as parameters.  If all goes well, we get a pcap_t descriptor returned.  If not, check the error buffer for details.</p>

<hr><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'>    <span class="c1">// start packet processing loop, just like live capture</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">pcap_loop</span><span class="p">(</span><span class="n">descr</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">packetHandler</span><span class="p">,</span> <span class="nb">NULL</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;pcap_loop() failed: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">pcap_geterr</span><span class="p">(</span><span class="n">descr</span><span class="p">);</span>
</span><span class='line'>  <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;capture finished&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>
</span><span class='line'><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Just like in a live packet capture, we use <a href="http://www.manpagez.com/man/3/pcap_loop/">pcap_loop()</a> to set up a handler callback for each packet to be processed. We give it the following:</p>

<ul>
<li>descr - the descriptor we just created with <a href="http://www.manpagez.com/man/3/pcap_open_offline/">pcap_open_offline()</a></li>
<li>count - 0 (zero), to indicate there is no limit to the number of packets we want to process</li>
<li>callback - The name of our packet handler function</li>
<li>userdata - NULL, to indicate that we will be passing no user defined data to the callack</li>
</ul>


<p>When the entire file has been processed, we will print the &#8220;capture complete&#8221; message and then exit.</p>

<hr><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'><span class="kt">void</span> <span class="n">packetHandler</span><span class="p">(</span><span class="n">u_char</span> <span class="o">*</span><span class="n">userData</span><span class="p">,</span> <span class="k">const</span> <span class="k">struct</span> <span class="n">pcap_pkthdr</span><span class="o">*</span> <span class="n">pkthdr</span><span class="p">,</span> <span class="k">const</span> <span class="n">u_char</span><span class="o">*</span> <span class="n">packet</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'><span class="k">const</span> <span class="k">struct</span> <span class="n">ether_header</span><span class="o">*</span> <span class="n">ethernetHeader</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="k">struct</span> <span class="n">ip</span><span class="o">*</span> <span class="n">ipHeader</span><span class="p">;</span>
</span><span class='line'><span class="k">const</span> <span class="k">struct</span> <span class="n">tcphdr</span><span class="o">*</span> <span class="n">tcpHeader</span><span class="p">;</span>
</span><span class='line'><span class="kt">char</span> <span class="n">sourceIp</span><span class="p">[</span><span class="n">INET_ADDRSTRLEN</span><span class="p">];</span>
</span><span class='line'><span class="kt">char</span> <span class="n">destIp</span><span class="p">[</span><span class="n">INET_ADDRSTRLEN</span><span class="p">];</span>
</span><span class='line'><span class="n">u_int</span> <span class="n">sourcePort</span><span class="p">,</span> <span class="n">destPort</span><span class="p">;</span>
</span><span class='line'><span class="n">u_char</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span><span class='line'><span class="kt">int</span> <span class="n">dataLength</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span><span class='line'><span class="n">string</span> <span class="n">dataStr</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="p">;</span>
</span></code></pre></td></tr></table></div></figure>


<p>Here we define the packet handler callback, as per the libpcap specifications.  For more details, check out my <a href="http://savagelook.com/blog/code/packet-capture-with-c-linux">original post on packet capture</a>.  The following declarations define variables that will help us parse meaningful data out of the packets.  These include packet header data, IP addresses, source/destination ports, and payload data.</p>

<p>There&#8217;s LOTS more useful information to be analyzed from the average packet.  Check out the structure defined in the network includes at the beginning of the code for more details.  Actually, it would probably be a hell of a lot easier to just download and fire up <a href="http://www.wireshark.org/">Wireshark</a>.  It will give you a greater appreciation for what can be learned from a packet.</p>

<hr><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'>    <span class="n">ethernetHeader</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="o">*</span><span class="p">)</span><span class="n">packet</span><span class="p">;</span>
</span><span class='line'><span class="k">if</span> <span class="p">(</span><span class="n">ntohs</span><span class="p">(</span><span class="n">ethernetHeader</span><span class="o">-&gt;</span><span class="n">ether_type</span><span class="p">)</span> <span class="o">==</span> <span class="n">ETHERTYPE_IP</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>  <span class="n">ipHeader</span> <span class="o">=</span> <span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="o">*</span><span class="p">)(</span><span class="n">packet</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">));</span>
</span><span class='line'>  <span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ipHeader</span><span class="o">-&gt;</span><span class="n">ip_src</span><span class="p">),</span> <span class="n">sourceIp</span><span class="p">,</span> <span class="n">INET_ADDRSTRLEN</span><span class="p">);</span>
</span><span class='line'>  <span class="n">inet_ntop</span><span class="p">(</span><span class="n">AF_INET</span><span class="p">,</span> <span class="o">&amp;</span><span class="p">(</span><span class="n">ipHeader</span><span class="o">-&gt;</span><span class="n">ip_dst</span><span class="p">),</span> <span class="n">destIp</span><span class="p">,</span> <span class="n">INET_ADDRSTRLEN</span><span class="p">);</span>
</span></code></pre></td></tr></table></div></figure>


<p>I&#8217;m not going to delve to deeply into the specifics of network protocols, as that could be a post&#8230; check that&#8230; that could be a book of its own.  Basically here we are parsing the ethernet header from the packet and using its type to determine if it is an IP packet or not.  We use the <a href="http://linux.about.com/library/cmd/blcmdl3_ntohs.htm">ntohs()</a> to convert the type from network byte order to host byte order.</p>

<p>If it is an IP packet, we parse out the IP header and use the <a href="http://pubs.opengroup.org/onlinepubs/009695399/functions/inet_ntop.html">inet_ntop()</a> function to convert the IP addresses found in the IP header into a human readable format (i.e., xxx.xxx.xxx.xxx).  <span style="color:#ff0000">In a lot of older examples you&#8217;ll see the use of <a href="http://beej.us/guide/bgnet/output/html/multipage/inet_ntoaman.html">inet_ntoa()</a>, but this is not thread-safe and is deprecated.</span></p>

<hr><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'>  <span class="k">if</span> <span class="p">(</span><span class="n">ipHeader</span><span class="o">-&gt;</span><span class="n">ip_p</span> <span class="o">==</span> <span class="n">IPPROTO_TCP</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>      <span class="n">tcpHeader</span> <span class="o">=</span> <span class="p">(</span><span class="n">tcphdr</span><span class="o">*</span><span class="p">)(</span><span class="n">packet</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">));</span>
</span><span class='line'>      <span class="n">sourcePort</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">tcpHeader</span><span class="o">-&gt;</span><span class="n">source</span><span class="p">);</span>
</span><span class='line'>      <span class="n">destPort</span> <span class="o">=</span> <span class="n">ntohs</span><span class="p">(</span><span class="n">tcpHeader</span><span class="o">-&gt;</span><span class="n">dest</span><span class="p">);</span>
</span><span class='line'>      <span class="n">data</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_char</span><span class="o">*</span><span class="p">)(</span><span class="n">packet</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">));</span>
</span><span class='line'>      <span class="n">dataLength</span> <span class="o">=</span> <span class="n">pkthdr</span><span class="o">-&gt;</span><span class="n">len</span> <span class="o">-</span> <span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ether_header</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">ip</span><span class="p">)</span> <span class="o">+</span> <span class="k">sizeof</span><span class="p">(</span><span class="k">struct</span> <span class="n">tcphdr</span><span class="p">));</span>
</span></code></pre></td></tr></table></div></figure>


<p>Similar to above, I use the IP header to determine if this is a TCP packet (they all should be since its a HTTP capture) and then parse out the TCP header.  With the TCP header we can then determine the source and destination ports, with <a href="http://linux.about.com/library/cmd/blcmdl3_ntohs.htm">ntohs()</a> again, and then determine the contents of the packet payload.</p>

<hr><br>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='cpp'><span class='line'>      <span class="c1">// convert non-printable characters, other than carriage return, line feed,</span>
</span><span class='line'>      <span class="c1">// or tab into periods when displayed.</span>
</span><span class='line'>      <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">dataLength</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="k">if</span> <span class="p">((</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">32</span> <span class="o">&amp;&amp;</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">126</span><span class="p">)</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">10</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span> <span class="o">||</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">13</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">dataStr</span> <span class="o">+=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span><span class='line'>          <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span><span class='line'>              <span class="n">dataStr</span> <span class="o">+=</span> <span class="s">&quot;.&quot;</span><span class="p">;</span>
</span><span class='line'>          <span class="p">}</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1">// print the results</span>
</span><span class='line'>      <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">sourceIp</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">sourcePort</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; -&gt; &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">destIp</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;:&quot;</span> <span class="o">&lt;&lt;</span> <span class="n">destPort</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>      <span class="k">if</span> <span class="p">(</span><span class="n">dataLength</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span><span class='line'>          <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">dataStr</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span><span class='line'>      <span class="p">}</span>
</span><span class='line'>  <span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>In the final step of the packet handler we display the results of our rudimentary analysis.  First we iterate through the bytes of the payload and save it in a format that is human friendly.  If you try to print it out with the non-printable characters in there you will get some very messy results in your console.  After this cleanup we simply output the packet data we have extracted and display it in the console.</p>

<h2>The Summary</h2>

<p>So now that you can process packets offline, what do you want to do with them?  I don&#8217;t know about you, but aside from obvious applications to network analysis, <span style="color:#ff0000;">I&#8217;d like to use this data for trending, visualization, or even generative art and sound</span>.  But then again I&#8217;m weird.  What are you gonna do?</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Tony Lukasavage</span></span>

      








  


<time datetime="2010-12-19T21:49:00-05:00" pubdate data-updated="true">Dec 19<span>th</span>, 2010</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/archive/'>archive</a>, <a class='category' href='/blog/categories/c-/'>c++</a>, <a class='category' href='/blog/categories/c-c-/'>c/c++</a>, <a class='category' href='/blog/categories/libpcap/'>libpcap</a>, <a class='category' href='/blog/categories/linux/'>linux</a>, <a class='category' href='/blog/categories/packet-capture/'>packet capture</a>, <a class='category' href='/blog/categories/programming/'>programming</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2010/12/15/quick-tip--deserializing-xml-to-objects-in-c-/" title="Previous Post: Quick Tip: Deserializing XML to objects in C#">&laquo; Quick Tip: Deserializing XML to objects in C#</a>
      
      
        <a class="basic-alignment right" href="/blog/2010/12/20/quick-tip---c--property-with-abstract-getter--concrete-setter/" title="Next Post: Quick Tip - C# property with abstract getter, concrete setter">Quick Tip - C# property with abstract getter, concrete setter &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    
<section>
	<span>
		<img src="http://www.gravatar.com/avatar/39ebccd822b6fb533e004ee722c38e9d?s=150" alt="Gravatar of Tony Lukasavage " title="Gravatar of Tony Lukasavage" />
	</span>
</section>


  <script src="/javascripts/twitter.js" type="text/javascript"> </script>
  
    <a href="http://twitter.com/tonylukasavage" class="twitter-follow-button" data-show-count="true">Follow @tonylukasavage</a>
  

<link href="/stylesheets/github-buttons.css" media="screen, projection" rel="stylesheet" type="text/css">
<span class="github-btn" data-user="tonylukasavage" data-type="follow" data-count="1"></span>
<script type="text/javascript" src="/javascripts/github-buttons.js"></script><style type="text/css">
.gittip-img {
	background-image: url(/images/gittip.png);
	background-repeat: no-repeat;
  background-position: 0 0;
  background-color: transparent;
	display: inline-block;
	height: 24px;
	width: 24px;
	margin-right: 3px;
}
</style>
<p><span class="gittip-img"></span>
<script data-gittip-username="Tony Lukasavage"
        data-gittip-widget="button"
        src="//gttp.co/v1.js"></script></p><section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/03/24/good-bye-appcelerator/">Good-bye Appcelerator</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/09/24/optional-callbacks-for-flexible-apis-in-javascript/">Callback Spotting: Flexible APIs in Javascript</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/07/21/appcelerator-api-builder-demo/">Appcelerator API Builder Demo</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/05/29/custom-assertions-in-should-dot-js/">Custom assertions in should.js</a>
      </li>
    
      <li class="post">
        <a href="/blog/2014/01/24/f-ck-you/">F*ck You, Show Me</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/tonylukasavage">@tonylukasavage</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'tonylukasavage',
            count: 3,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>

 <section>
     <h1>Twitter</h1>
     <a class="twitter-timeline" data-dnt="true" href="https://twitter.com/tonylukasavage" data-widget-id="422932897931083776">Tweets by @tonylukasavage</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>


 </section>




  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Tony Lukasavage -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>




<!-- Add jQuery library -->
<script type="text/javascript" src="http://code.jquery.com/jquery-latest.min.js"></script>
<script type="text/javascript">
jQuery.noConflict();
</script>

<!-- Add github repo widget -->
<script type="text/javascript" src="/javascripts/jquery.githubRepoWidget.min.js"></script>

<!-- Add fancyBox main JS file -->
<script type="text/javascript" src="/fancybox/source/jquery.fancybox.pack.js?v=2.1.4"></script>

<!-- fire up fancybox -->
<script type="text/javascript">
(function($) {
	$(function() {
		$('[class*=fancybox]').fancybox();
	});
})(jQuery);
</script>

</body>
</html>
