<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>box2d.as</title>
<link rel="stylesheet" type="text/css" href="../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptComment">/*
     * Tony Lukasavage - SavageLook.com - 8/18/2010
     * Box2DFlashAS3 2.1a HelloWorld example, minus the need for an accompanying FLA
     *
     * This the basic Box2DFlashAS3 HelloWorld.as file from the source distribution
     * with some adjustments made so that you do not need an FLA file to compile and
     * run the code.  A simple bonus for us pure AS3 guys.  Also a few minor modifications
     * are made to account for changes between version 2.0 and 2.1, like adding a type
     * for body definitions.  Finally, I threw in an click handler to toggle between
     * normal and debug drawing.
     *
     */</span>
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span>.<span class="ActionScriptDefault_Text">Collision</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span>.<span class="ActionScriptDefault_Text">Collision</span>.<span class="ActionScriptDefault_Text">Shapes</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span>.<span class="ActionScriptDefault_Text">Common</span>.<span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">Box2D</span>.<span class="ActionScriptDefault_Text">Dynamics</span>.<span class="ActionScriptOperator">*</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">__AS3__</span>.<span class="ActionScriptDefault_Text">vec</span>.<span class="ActionScriptDefault_Text">Vector</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">adobe</span>.<span class="ActionScriptDefault_Text">viewsource</span>.<span class="ActionScriptDefault_Text">ViewSource</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptDefault_Text">Sprite</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">Event</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">MouseEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Matrix</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">text</span>.<span class="ActionScriptDefault_Text">TextField</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">text</span>.<span class="ActionScriptDefault_Text">TextFormat</span>;

    <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">SWF</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;800&quot;</span>, <span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;600&quot;</span>, <span class="ActionScriptDefault_Text">frameRate</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&quot;30&quot;</span><span class="ActionScriptBracket/Brace">)]</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">box2d</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">Sprite</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_world</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2World</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_velocityIterations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 10;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_positionIterations</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 10;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_timeStep</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1.0 <span class="ActionScriptOperator">/</span> 30.0;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_showDebug</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_debugSprite</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Sprite</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_bodySprites</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">()</span>;
 
        <span class="ActionScriptComment">// Box2D uses meters for measurement, AS3 uses pixels.  1 meter = 30 pixels
</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_worldRatio</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 30;
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">box2d</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>            
            <span class="ActionScriptComment">// Add event for main loop
</span>            <span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span>.<span class="ActionScriptDefault_Text">ENTER_FRAME</span>, <span class="ActionScriptDefault_Text">Update</span>, <span class="ActionScriptReserved">false</span>, 0, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MouseEvent</span>.<span class="ActionScriptDefault_Text">CLICK</span>, <span class="ActionScriptDefault_Text">onClick</span> <span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptComment">// add background gradient
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bg</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Sprite</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Matrix</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Matrix</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">matrix</span>.<span class="ActionScriptDefault_Text">createGradientBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageWidth</span>, <span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageHeight</span>, <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptOperator">/</span>2, 0, 0<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">bg</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">beginGradientFill</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;linear&quot;</span>, <span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptDefault_Text">x9999ff</span>, 0<span class="ActionScriptDefault_Text">xffffff</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptBracket/Brace">[</span>1, 1<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptBracket/Brace">[</span>0, 255<span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">matrix</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">bg</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">drawRect</span><span class="ActionScriptBracket/Brace">(</span>0, 0, <span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageWidth</span>, <span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageHeight</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">bg</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">endFill</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bg</span><span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptComment">// Define the gravity vector
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">gravity</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2Vec2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2Vec2</span><span class="ActionScriptBracket/Brace">(</span>0.0, 10.0<span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptComment">// Allow bodies to sleep
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">doSleep</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
 
            <span class="ActionScriptComment">// Construct a world object
</span>            <span class="ActionScriptDefault_Text">_world</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2World</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">gravity</span>, <span class="ActionScriptDefault_Text">doSleep</span><span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptComment">// set debug draw
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">debugDraw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2DebugDraw</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2DebugDraw</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_debugSprite</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_debugSprite</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">debugDraw</span>.<span class="ActionScriptDefault_Text">SetSprite</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_debugSprite</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">debugDraw</span>.<span class="ActionScriptDefault_Text">SetDrawScale</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_worldRatio</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">debugDraw</span>.<span class="ActionScriptDefault_Text">SetFillAlpha</span><span class="ActionScriptBracket/Brace">(</span>0.5<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">debugDraw</span>.<span class="ActionScriptDefault_Text">SetLineThickness</span><span class="ActionScriptBracket/Brace">(</span>2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">debugDraw</span>.<span class="ActionScriptDefault_Text">SetAlpha</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">debugDraw</span>.<span class="ActionScriptDefault_Text">SetFlags</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b2DebugDraw</span>.<span class="ActionScriptDefault_Text">e_shapeBit</span> <span class="ActionScriptOperator">|</span> <span class="ActionScriptDefault_Text">b2DebugDraw</span>.<span class="ActionScriptDefault_Text">e_jointBit</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_world</span>.<span class="ActionScriptDefault_Text">SetDebugDraw</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">debugDraw</span><span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptComment">// Vars used to create bodies
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">body</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2Body</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bodyDef</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2BodyDef</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">boxShape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2PolygonShape</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">circleShape</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2CircleShape</span>;
 
            <span class="ActionScriptComment">// Adding sprite variable for dynamically creating body userData
</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sprite</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Sprite</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">groundHeight</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 60;
 
            <span class="ActionScriptDefault_Text">sprite</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">beginFill</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x444444</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">drawRect</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageWidth</span><span class="ActionScriptOperator">/</span>2, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">groundHeight</span><span class="ActionScriptOperator">/</span>2, <span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageWidth</span>, <span class="ActionScriptDefault_Text">groundHeight</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">endFill</span><span class="ActionScriptBracket/Brace">()</span>;
 
            <span class="ActionScriptDefault_Text">bodyDef</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2BodyDef</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Body</span>.<span class="ActionScriptDefault_Text">b2_staticBody</span>;
            <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">position</span>.<span class="ActionScriptDefault_Text">Set</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageWidth</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_worldRatio</span> <span class="ActionScriptOperator">/</span> 2, <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stage</span>.<span class="ActionScriptDefault_Text">stageHeight</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">_worldRatio</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">userData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sprite</span>;
            <span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">userData</span><span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptDefault_Text">boxShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">boxShape</span>.<span class="ActionScriptDefault_Text">SetAsBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_worldRatio</span><span class="ActionScriptOperator">/</span>2, <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_worldRatio</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fixtureDef</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2FixtureDef</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2FixtureDef</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">shape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">boxShape</span>;
            <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">friction</span> <span class="ActionScriptOperator">=</span> 0.3;
            <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">density</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptComment">// static bodies require zero density
</span> 
            <span class="ActionScriptDefault_Text">body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_world</span>.<span class="ActionScriptDefault_Text">CreateBody</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bodyDef</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">body</span>.<span class="ActionScriptDefault_Text">CreateFixture</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fixtureDef</span><span class="ActionScriptBracket/Brace">)</span>;
 
            <span class="ActionScriptComment">// Add some objects
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 1; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> 20; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">// create generic body definition
</span>                <span class="ActionScriptDefault_Text">bodyDef</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2BodyDef</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b2Body</span>.<span class="ActionScriptDefault_Text">b2_dynamicBody</span>;
                <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">position</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">*</span> 15 <span class="ActionScriptOperator">+</span> 5;
                <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">position</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">*</span> 10;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">+</span> 0.5;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">rY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">+</span> 1;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">spriteX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rX</span> <span class="ActionScriptOperator">*</span> 30 <span class="ActionScriptOperator">*</span> 2;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">spriteY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">rY</span> <span class="ActionScriptOperator">*</span> 30 <span class="ActionScriptOperator">*</span> 2;
 
                <span class="ActionScriptComment">// Box
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">random</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">&lt;</span> 0.5<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">sprite</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">beginFill</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">xff6666</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">drawRect</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">spriteX</span><span class="ActionScriptOperator">/</span>2, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">spriteY</span><span class="ActionScriptOperator">/</span>2, <span class="ActionScriptDefault_Text">spriteX</span>, <span class="ActionScriptDefault_Text">spriteY</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">endFill</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">userData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sprite</span>;
 
                    <span class="ActionScriptDefault_Text">boxShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2PolygonShape</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">boxShape</span>.<span class="ActionScriptDefault_Text">SetAsBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rX</span>, <span class="ActionScriptDefault_Text">rY</span><span class="ActionScriptBracket/Brace">)</span>;
 
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">shape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">boxShape</span>;
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">density</span> <span class="ActionScriptOperator">=</span> 1.0;
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">friction</span> <span class="ActionScriptOperator">=</span> 0.5;
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">restitution</span> <span class="ActionScriptOperator">=</span> 0.2;
 
                    <span class="ActionScriptDefault_Text">body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_world</span>.<span class="ActionScriptDefault_Text">CreateBody</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bodyDef</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">body</span>.<span class="ActionScriptDefault_Text">CreateFixture</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fixtureDef</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptComment">// Circle
</span>                <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">sprite</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">lineStyle</span><span class="ActionScriptBracket/Brace">(</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">beginFill</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptDefault_Text">x44ff44</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">drawCircle</span><span class="ActionScriptBracket/Brace">(</span>0, 0, <span class="ActionScriptDefault_Text">spriteX</span><span class="ActionScriptOperator">/</span>2<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">endFill</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">userData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">sprite</span>;
 
                    <span class="ActionScriptDefault_Text">circleShape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">b2CircleShape</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">rX</span><span class="ActionScriptBracket/Brace">)</span>;
 
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">shape</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">circleShape</span>;
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">density</span> <span class="ActionScriptOperator">=</span> 1.0;
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">friction</span> <span class="ActionScriptOperator">=</span> 0.5;
                    <span class="ActionScriptDefault_Text">fixtureDef</span>.<span class="ActionScriptDefault_Text">restitution</span> <span class="ActionScriptOperator">=</span> 0.2;
 
                    <span class="ActionScriptDefault_Text">body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_world</span>.<span class="ActionScriptDefault_Text">CreateBody</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bodyDef</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">body</span>.<span class="ActionScriptDefault_Text">CreateFixture</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fixtureDef</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
 
                <span class="ActionScriptDefault_Text">_bodySprites</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">userData</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bodyDef</span>.<span class="ActionScriptDefault_Text">userData</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            
            <span class="ActionScriptComment">// enable view source 
</span>            <span class="ActionScriptDefault_Text">ViewSource</span>.<span class="ActionScriptDefault_Text">addMenuItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>, <span class="ActionScriptString">&quot;http://savagelook.com/demos/box2d/srcview/index.html&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">text</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">TextField</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">TextField</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">text</span>.<span class="ActionScriptDefault_Text">text</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;Right click to view source&quot;</span>;
            <span class="ActionScriptDefault_Text">text</span>.<span class="ActionScriptDefault_Text">setTextFormat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">TextFormat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;arial&quot;</span>, 14, 0, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">))</span>;
            <span class="ActionScriptDefault_Text">text</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> 20;
            <span class="ActionScriptDefault_Text">text</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> 20;
            <span class="ActionScriptDefault_Text">text</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">=</span> 200;
            <span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">text</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onClick</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MouseEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_showDebug</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_showDebug</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">_showDebug</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_debugSprite</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sprite</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Sprite</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_bodySprites</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">_showDebug</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
 
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">Update</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span><span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_world</span>.<span class="ActionScriptDefault_Text">Step</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_timeStep</span>, <span class="ActionScriptDefault_Text">_velocityIterations</span>, <span class="ActionScriptDefault_Text">_positionIterations</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_showDebug</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">_world</span>.<span class="ActionScriptDefault_Text">DrawDebugData</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
 
            <span class="ActionScriptComment">// Go through body list and update sprite positions/rotations
</span>            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">b2Body</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_world</span>.<span class="ActionScriptDefault_Text">GetBodyList</span><span class="ActionScriptBracket/Brace">()</span>; <span class="ActionScriptDefault_Text">bb</span>; <span class="ActionScriptDefault_Text">bb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bb</span>.<span class="ActionScriptDefault_Text">GetNext</span><span class="ActionScriptBracket/Brace">()){</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">bb</span>.<span class="ActionScriptDefault_Text">GetUserData</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">){</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sprite</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Sprite</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bb</span>.<span class="ActionScriptDefault_Text">GetUserData</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Sprite</span>;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bb</span>.<span class="ActionScriptDefault_Text">GetPosition</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">*</span> 30;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bb</span>.<span class="ActionScriptDefault_Text">GetPosition</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">*</span> 30;
                    <span class="ActionScriptDefault_Text">sprite</span>.<span class="ActionScriptDefault_Text">rotation</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">bb</span>.<span class="ActionScriptDefault_Text">GetAngle</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptBracket/Brace">(</span>180<span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">PI</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span>
</pre></body>
</html>
