<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>MQO.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">loaders</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">arcane</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">containers</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">base</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">loaders</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptOperator">*</span>;

    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptOperator">*</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;

    <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;

    <span class="ActionScriptASDoc">/**
     * Metasequoia
     * @author katopz@sleepydesign.com
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">MQO</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AbstractParser</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/** @private */</span>
        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prepareData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">mqo</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mqo</span>.<span class="ActionScriptDefault_Text">readMultiByte</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mqo</span>.<span class="ActionScriptDefault_Text">length</span>, <span class="ActionScriptDefault_Text">charset</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;\r\n&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0;

            <span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseMaterialChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>, 0<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseObjectChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>, <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">//build the meshes
</span>            <span class="ActionScriptDefault_Text">buildMeshes</span><span class="ActionScriptBracket/Brace">()</span>;

            <span class="ActionScriptComment">//build materials
</span>            <span class="ActionScriptDefault_Text">buildMaterials</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mqo</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialData</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_meshData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MeshData</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_geometryData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">GeometryData</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_moveVector</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_materialNames</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;

        <span class="ActionScriptASDoc">/**
         * Array of mesh data objects used for storing the parsed 3ds data structure.
         */</span>
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">meshDataList</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getMaterialChunkLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">startLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">startLine</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">lines</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Material&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseMaterialChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">startLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getMaterialChunkLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>, <span class="ActionScriptDefault_Text">startLine</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">line</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">]</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>9<span class="ActionScriptBracket/Brace">))</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">isNaN</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num</span><span class="ActionScriptBracket/Brace">))</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;

            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">l</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">endLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">endLine</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">line</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">]</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nameBeginIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;\&quot;&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nameEndIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;\&quot;&quot;</span>, <span class="ActionScriptDefault_Text">nameBeginIndex</span> <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptDefault_Text">_materialData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialLibrary</span>.<span class="ActionScriptDefault_Text">addMaterial</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nameBeginIndex</span> <span class="ActionScriptOperator">+</span> 1, <span class="ActionScriptDefault_Text">nameEndIndex</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptDefault_Text">_materialNames</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_materialData</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>, <span class="ActionScriptString">&quot;tex&quot;</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tex</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">TEXTURE_MATERIAL</span>;

                    <span class="ActionScriptDefault_Text">tex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tex</span>.<span class="ActionScriptDefault_Text">substr</span><span class="ActionScriptBracket/Brace">(</span>1, <span class="ActionScriptDefault_Text">tex</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptBracket/Brace">)</span>;

                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">tex</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\.tga$/</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">tex</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\.bmp$/</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptComment">//TODO : someone really need TGA, BMP on web?
</span>                        <span class="ActionScriptComment">//_material = loadTGAMaterial(path + tex);
</span>
                        <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; ! Error : TGA, BMP not support.&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot; &lt; Try : .png with same name...&quot;</span><span class="ActionScriptBracket/Brace">)</span>;

                        <span class="ActionScriptDefault_Text">tex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tex</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\.tga$/</span>, <span class="ActionScriptString">&quot;.png&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">tex</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tex</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\.bmp$/</span>, <span class="ActionScriptString">&quot;.png&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>

                    <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">textureFileName</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tex</span>;

                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">colorstr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>, <span class="ActionScriptString">&quot;col&quot;</span><span class="ActionScriptBracket/Brace">)</span>;

                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">colorstr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">color</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">colorstr</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\d+\.\d+/</span><span class="ActionScriptDefault_Text">g</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">r</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> 255;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">g</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> 255;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> 255;
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">color</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">])</span>;

                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">shading</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">SHADING_MATERIAL</span>;
                        <span class="ActionScriptReserved">else</span>
                            <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">COLOR_MATERIAL</span>;

                        <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">diffuseColor</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">r</span> <span class="ActionScriptOperator">&lt;&lt;</span> 16<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">|</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">g</span> <span class="ActionScriptOperator">&lt;&lt;</span> 8<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">|</span> <span class="ActionScriptDefault_Text">b</span>;
                        <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">alpha</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">a</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_materialData</span>.<span class="ActionScriptDefault_Text">materialType</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">MaterialData</span>.<span class="ActionScriptDefault_Text">WIREFRAME_MATERIAL</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">l</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">endLine</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getObjectChunkLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">startLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">startLine</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">lines</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Object&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">==</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseObjectChunk</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">startLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span>1;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getObjectChunkLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>, <span class="ActionScriptDefault_Text">startLine</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">line</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">]</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>8, <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;\&quot;&quot;</span>, 8<span class="ActionScriptBracket/Brace">))</span>;

            <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">l</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vline</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getChunkLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>, <span class="ActionScriptString">&quot;vertex&quot;</span>, <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vline</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">()</span>;

            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">vline</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">line</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">props</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">RegExp</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/^\s*([\w]+)\s+(.*)$/</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">exec</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">props</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">props</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">l</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">line</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">]</span>;
            <span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vline</span> <span class="ActionScriptOperator">+</span> 1;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numVertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;vertex&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 7<span class="ActionScriptBracket/Brace">))</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertexEndLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">numVertices</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">firstVertexIndex</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span>;

            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">vertexEndLine</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">line</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">coords</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/(-?\d+\.\d+)/</span><span class="ActionScriptDefault_Text">g</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coords</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scaling</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coords</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scaling</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">z</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">coords</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">*</span> <span class="ActionScriptDefault_Text">scaling</span>;
                <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">l</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getChunkLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span>, <span class="ActionScriptString">&quot;face&quot;</span>, <span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;

            <span class="ActionScriptDefault_Text">line</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">]</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">numFaces</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;face&quot;</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> 5<span class="ActionScriptBracket/Brace">))</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">faceEndLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">numFaces</span>;

            <span class="ActionScriptDefault_Text">_meshData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MeshData</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">name</span>;

            <span class="ActionScriptDefault_Text">_geometryData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryLibrary</span>.<span class="ActionScriptDefault_Text">addGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">l</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">faceEndLine</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;visible&quot;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;15&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">l</span><span class="ActionScriptBracket/Brace">]</span>, <span class="ActionScriptDefault_Text">vertices</span>, <span class="ActionScriptDefault_Text">firstVertexIndex</span>, <span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">l</span>;
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptComment">//ignore bone data
</span>            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptDefault_Text">meshDataList</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_meshData</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptComment">//TODO : do we need this?
</span>            <span class="ActionScriptComment">/*
            // Resolve parent-child relationship.
            var depth:int;
            try
            {
                depth = parseInt(properties[&quot;depth&quot;]);
            }
            catch (e:Error)
            {
                depth = 0;
            }
            var parentMesh:ObjectContainer3D = _prevMesh;
            if (depth &lt;= 0)
            {
                parentMesh = this;
                depth = 0;
            }
            else
            {
                while (depth &lt;= _prevDepth)
                {
                    parentMesh = ObjectContainer3D(parentMesh).parent;
                    --_prevDepth;
                }
            }
            parentMesh.addChild(mesh);
            _prevMesh = mesh;
            _prevDepth = depth;
            */</span>

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">faceEndLine</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">parseFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialData</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vstr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>, <span class="ActionScriptString">&quot;V&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mstr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>, <span class="ActionScriptString">&quot;M&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvstr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span>, <span class="ActionScriptString">&quot;UV&quot;</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vstr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">vstr</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/\d+/</span><span class="ActionScriptDefault_Text">g</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">[]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uvstr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">uvstr</span>.<span class="ActionScriptDefault_Text">match</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">/-?\d+\.\d+/</span><span class="ActionScriptDefault_Text">g</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptBracket/Brace">[]</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_material</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MaterialData</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvA</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvB</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvC</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">uvD</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 3<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptBracket/Brace">]</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mstr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">_material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialNames</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mstr</span><span class="ActionScriptBracket/Brace">)]</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">uvC</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]))</span>;
                    <span class="ActionScriptDefault_Text">uvB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]))</span>;
                    <span class="ActionScriptDefault_Text">uvA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]))</span>;
                    <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">b</span>, <span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">uvA</span>, <span class="ActionScriptDefault_Text">uvB</span>, <span class="ActionScriptDefault_Text">uvC</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">b</span>, <span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span>0, 0<span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span>1, 0<span class="ActionScriptBracket/Brace">)</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span>0, 1<span class="ActionScriptBracket/Brace">))</span>;
                <span class="ActionScriptBracket/Brace">}</span>


                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mirror&quot;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;1&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">mirrorAxis</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mirror_axis&quot;</span><span class="ActionScriptBracket/Brace">])</span>;
                    <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span>, <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">b</span>, <span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">uvC</span>, <span class="ActionScriptDefault_Text">uvB</span>, <span class="ActionScriptDefault_Text">uvA</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">==</span> 4<span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">])</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vertexOffset</span><span class="ActionScriptBracket/Brace">]</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mstr</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptDefault_Text">_material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialNames</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mstr</span><span class="ActionScriptBracket/Brace">)]</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">uvD</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>1<span class="ActionScriptBracket/Brace">]))</span>;
                    <span class="ActionScriptDefault_Text">uvC</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>2<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>3<span class="ActionScriptBracket/Brace">]))</span>;
                    <span class="ActionScriptDefault_Text">uvB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>4<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>5<span class="ActionScriptBracket/Brace">]))</span>;
                    <span class="ActionScriptDefault_Text">uvA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>6<span class="ActionScriptBracket/Brace">])</span>, <span class="ActionScriptDefault_Text">parseFloat</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv</span><span class="ActionScriptBracket/Brace">[</span>7<span class="ActionScriptBracket/Brace">]))</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">uvD</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span>1, 1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">uvC</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span>0, 1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">uvB</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span>1, 0<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">uvA</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(</span>0, 0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">b</span>, <span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">uvA</span>, <span class="ActionScriptDefault_Text">uvB</span>, <span class="ActionScriptDefault_Text">uvC</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">d</span>, <span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">uvC</span>, <span class="ActionScriptDefault_Text">uvD</span>, <span class="ActionScriptDefault_Text">uvA</span><span class="ActionScriptBracket/Brace">)</span>;

                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mirror&quot;</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptString">&quot;1&quot;</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">mirrorAxis</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">parseInt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">properties</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">&quot;mirror_axis&quot;</span><span class="ActionScriptBracket/Brace">])</span>;
                    <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span>, <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">d</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span>, <span class="ActionScriptDefault_Text">mirrorAxis</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">b</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">b</span>, <span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">uvC</span>, <span class="ActionScriptDefault_Text">uvB</span>, <span class="ActionScriptDefault_Text">uvA</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">a</span>, <span class="ActionScriptDefault_Text">d</span>, <span class="ActionScriptDefault_Text">c</span>, <span class="ActionScriptDefault_Text">uvA</span>, <span class="ActionScriptDefault_Text">uvD</span>, <span class="ActionScriptDefault_Text">uvC</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_material</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">mirrorVertex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>, <span class="ActionScriptDefault_Text">axis</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">(((</span><span class="ActionScriptDefault_Text">axis</span> <span class="ActionScriptOperator">&amp;</span> 1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">axis</span> <span class="ActionScriptOperator">&amp;</span> 2<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">axis</span> <span class="ActionScriptOperator">&amp;</span> 4<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">v</span>.<span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getChunkLine</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>, <span class="ActionScriptDefault_Text">chunkName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">startLine</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> 0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">uint</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">startLine</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">lines</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptOperator">++</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lines</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">chunkName</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptOperator">-</span>1;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getParam</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">line</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">paramName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">prefix</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">paramName</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&quot;(&quot;</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">prefixLen</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">prefix</span>.<span class="ActionScriptDefault_Text">length</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">begin</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">prefix</span>, 0<span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">begin</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;)&quot;</span>, <span class="ActionScriptDefault_Text">begin</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">prefixLen</span><span class="ActionScriptBracket/Brace">)</span>;

            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">end</span> <span class="ActionScriptOperator">==</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;

            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">line</span>.<span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">begin</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">prefixLen</span>, <span class="ActionScriptDefault_Text">end</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">n</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span>1;

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addFace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">v0</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>, <span class="ActionScriptDefault_Text">v1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>, <span class="ActionScriptDefault_Text">v2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>, <span class="ActionScriptDefault_Text">uv0</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>, <span class="ActionScriptDefault_Text">uv1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span>, <span class="ActionScriptDefault_Text">uv2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector3D</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v0</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v0</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">v0</span>.<span class="ActionScriptDefault_Text">z</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v1</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v1</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">v1</span>.<span class="ActionScriptDefault_Text">z</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v2</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">v2</span>.<span class="ActionScriptDefault_Text">y</span>, <span class="ActionScriptDefault_Text">v2</span>.<span class="ActionScriptDefault_Text">z</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">uvtData</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">uv0</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">uv0</span>.<span class="ActionScriptDefault_Text">y</span>, 1, <span class="ActionScriptDefault_Text">uv1</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">uv1</span>.<span class="ActionScriptDefault_Text">y</span>, 1, <span class="ActionScriptDefault_Text">uv2</span>.<span class="ActionScriptDefault_Text">x</span>, <span class="ActionScriptDefault_Text">uv2</span>.<span class="ActionScriptDefault_Text">y</span>, 1<span class="ActionScriptBracket/Brace">)</span>;
            
            <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">+=</span> 3;
            
            <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">indices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">n</span>, <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">-</span> 1, <span class="ActionScriptDefault_Text">n</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">faceLengths</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>

        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">buildMeshes</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>

            <span class="ActionScriptReserved">for</span> <span class="ActionScriptReserved">each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_meshData</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MeshData</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">meshDataList</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptComment">//create Mesh object
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Mesh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Mesh</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptComment">//mesh.name = _meshData.name;
</span>                
                <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">material</span>.<span class="ActionScriptDefault_Text">meshes</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;
                
                <span class="ActionScriptDefault_Text">_geometryData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_meshData</span>.<span class="ActionScriptDefault_Text">geometry</span>;
                <span class="ActionScriptComment">/*
                   var geometry:Geometry = _geometryData.geometry;

                   if (!geometry) {
                   geometry = _geometryData.geometry = new Geometry();

                   mesh.geometry = geometry;

                   //set materialdata for each face
                   for each (var _meshMaterialData:MeshMaterialData in _geometryData.materials) {
                   for each (var _faceListIndex:int in _meshMaterialData.faceList) {
                   var _faceData:FaceData = _geometryData.faces[_faceListIndex] as FaceData;
                   _faceData.materialData = materialLibrary[_meshMaterialData.symbol];
                   }
                   }

                   for each(_faceData in _geometryData.faces) {

                   if (_faceData.materialData)
                   _faceMaterial = _faceData.materialData.material as ITriangleMaterial;
                   else
                   _faceMaterial = null;

                   var _face:Face = new Face(_geometryData.vertices[_faceData.v0],
                   _geometryData.vertices[_faceData.v1],
                   _geometryData.vertices[_faceData.v2],
                   _faceMaterial,
                   _geometryData.uvs[_faceData.v0],
                   _geometryData.uvs[_faceData.v1],
                   _geometryData.uvs[_faceData.v2]);
                   geometry.addFace(_face);

                   if (_faceData.materialData)
                   _faceData.materialData.elements.push(_face);
                   }
                   } else {
                   mesh.geometry = geometry;
                   }
                 */</span>
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">vertices</span>;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">uvtData</span>;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_indices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">indices</span>;
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_faceLengths</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">faceLengths</span>;
                
                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">buildFaces</span><span class="ActionScriptBracket/Brace">()</span>;
                
                <span class="ActionScriptComment">//center vertex points in mesh for better bounding radius calulations
</span>                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerMeshes</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">/</span> 3;
                    <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">minX</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 2;
                    <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">minY</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 2;
                    <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">z</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">_geometryData</span>.<span class="ActionScriptDefault_Text">minZ</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">/</span> 2;
                    <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">*</span> 3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">x</span>;
                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">*</span> 3 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">y</span>;
                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">*</span> 3 <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">z</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">_moveVector</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">transform</span>.<span class="ActionScriptDefault_Text">matrix3D</span>.<span class="ActionScriptDefault_Text">transformVector</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_moveVector</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">transform</span>.<span class="ActionScriptDefault_Text">matrix3D</span>.<span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_moveVector</span>.<span class="ActionScriptDefault_Text">clone</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>

                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;.mqo&quot;</span>;
                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_container</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>


        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">charset</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;shift_jis&quot;</span>;

        <span class="ActionScriptASDoc">/**
         * Controls the use of shading materials when color textures are encountered. Defaults to false.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">shading</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">false</span>;

        <span class="ActionScriptASDoc">/**
         * A scaling factor for all geometry in the model. Defaults to 1.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;

        <span class="ActionScriptASDoc">/**
         * Controls the automatic centering of geometry data in the model, improving culling and the accuracy of bounding dimension values.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerMeshes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;

        <span class="ActionScriptASDoc">/**
         * Creates a new &lt;code&gt;MQO&lt;/code&gt; object.
         */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">MQO</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">()</span>;

            <span class="ActionScriptDefault_Text">_container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ObjectContainer3D</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_container</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;mqo&quot;</span>;

            <span class="ActionScriptDefault_Text">_container</span>.<span class="ActionScriptDefault_Text">materialLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_materialLibrary</span>;
            <span class="ActionScriptDefault_Text">_container</span>.<span class="ActionScriptDefault_Text">geometryLibrary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_geometryLibrary</span>;

            <span class="ActionScriptDefault_Text">binary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
