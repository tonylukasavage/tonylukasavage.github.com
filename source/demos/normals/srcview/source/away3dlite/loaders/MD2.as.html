<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>MD2.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">loaders</span><span class="ActionScriptBracket/Brace">{</span>    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">animators</span>.<span class="ActionScriptOperator">*</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">animators</span>.<span class="ActionScriptDefault_Text">frames</span>.<span class="ActionScriptDefault_Text">Frame</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">arcane</span>;    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">away3dlite</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;        <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">utils</span>.<span class="ActionScriptOperator">*</span>;        <span class="ActionScriptReserved">use</span> <span class="ActionScriptReserved">namespace</span> <span class="ActionScriptDefault_Text">arcane</span>;        <span class="ActionScriptASDoc">/**    * File loader for the Md2 file format.    */</span>    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">MD2</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">AbstractParser</span>    <span class="ActionScriptBracket/Brace">{</span>        <span class="ActionScriptASDoc">/** @private */</span>        <span class="ActionScriptDefault_Text">arcane</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">prepareData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">md2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Cast</span>.<span class="ActionScriptDefault_Text">bytearray</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">a</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">b</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">ta</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">tb</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">tc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">i3</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[]</span>;                        <span class="ActionScriptComment">// Make sure to have this in Little Endian or you will hate you life.</span>            <span class="ActionScriptComment">// At least I did the first time I did this for a while.</span>            <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">endian</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Endian</span>.<span class="ActionScriptDefault_Text">LITTLE_ENDIAN</span>;            <span class="ActionScriptComment">// Read the header and make sure it is valid MD2 file</span>            <span class="ActionScriptDefault_Text">readMd2Header</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md2</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ident</span> <span class="ActionScriptOperator">!=</span> 844121161 <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">version</span> <span class="ActionScriptOperator">!=</span> 8<span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptReserved">throw</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;Error loading MD2 file: Not a valid MD2 file/bad version&quot;</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptComment">// UV coordinates</span>            <span class="ActionScriptComment">//        Load them!</span>            <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">offset_st</span>;            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">num_st</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptDefault_Text">uvs</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readShort</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">skinwidth</span>, <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readShort</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">/</span> <span class="ActionScriptDefault_Text">skinheight</span><span class="ActionScriptBracket/Brace">))</span>;                            <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">num_tris</span><span class="ActionScriptOperator">*</span>9;            <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">num_tris</span><span class="ActionScriptOperator">*</span>3;                        <span class="ActionScriptComment">// Faces</span>            <span class="ActionScriptComment">//        Creates the faces with the proper references to vertices</span>            <span class="ActionScriptComment">//        NOTE: DO NOT change the order of the variable assignments here, </span>            <span class="ActionScriptComment">//              or nothing will work.</span>            <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">offset_tris</span>;            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">num_tris</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">*</span>3;                <span class="ActionScriptDefault_Text">i2</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">+</span> 1;                <span class="ActionScriptDefault_Text">i3</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">i1</span> <span class="ActionScriptOperator">+</span> 2;                                <span class="ActionScriptComment">//collect vertices</span>                <span class="ActionScriptDefault_Text">a</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">b</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">c</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">a</span>;                <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">b</span>;                <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i3</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">c</span>;                                <span class="ActionScriptComment">//collect indices</span>                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_indices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i3</span>, <span class="ActionScriptDefault_Text">i2</span>, <span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptBracket/Brace">)</span>;                                <span class="ActionScriptComment">//collect face lengths</span>                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_faceLengths</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span>3<span class="ActionScriptBracket/Brace">)</span>;                                <span class="ActionScriptComment">//collect uvData </span>                <span class="ActionScriptDefault_Text">ta</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">tb</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">tc</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">readUnsignedShort</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ta</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">]</span>;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">ta</span><span class="ActionScriptOperator">*</span>2 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i1</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tb</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">]</span>;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tb</span><span class="ActionScriptOperator">*</span>2 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i2</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i3</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tc</span><span class="ActionScriptOperator">*</span>2<span class="ActionScriptBracket/Brace">]</span>;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i3</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">uvs</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tc</span><span class="ActionScriptOperator">*</span>2 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_uvtData</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i3</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> 1;            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptComment">// Frame animation data</span>            <span class="ActionScriptComment">//        This part is a little funky.</span>            <span class="ActionScriptDefault_Text">md2</span>.<span class="ActionScriptDefault_Text">position</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">offset_frames</span>;            <span class="ActionScriptDefault_Text">readFrames</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">md2</span><span class="ActionScriptBracket/Brace">)</span>;                        <span class="ActionScriptComment">//setup vertices for the first frame</span>            <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span>.<span class="ActionScriptDefault_Text">length</span>;            <span class="ActionScriptDefault_Text">vertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">frames</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">vertices</span>;            <span class="ActionScriptReserved">while</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">--</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">_vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">material</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">material</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">material</span>;                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">buildFaces</span><span class="ActionScriptBracket/Brace">()</span>;                        <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">type</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptString">&quot;.Md2&quot;</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">md2</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ident</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">version</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">skinwidth</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">skinheight</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">framesize</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num_skins</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num_vertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num_st</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num_tris</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num_glcmds</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">num_frames</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offset_skins</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offset_st</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offset_tris</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offset_frames</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offset_glcmds</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">offset_end</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mesh</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MovieMesh</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">()</span>;        <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">minX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Infinity</span>, <span class="ActionScriptDefault_Text">maxX</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Infinity</span>, <span class="ActionScriptDefault_Text">minY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Infinity</span>, <span class="ActionScriptDefault_Text">maxY</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Infinity</span>, <span class="ActionScriptDefault_Text">minZ</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Infinity</span>, <span class="ActionScriptDefault_Text">maxZ</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptOperator">-</span><span class="ActionScriptDefault_Text">Infinity</span>;                <span class="ActionScriptASDoc">/**         * Reads in all the frames         */</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readFrames</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">sy</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">sz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tx</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">ty</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>, <span class="ActionScriptDefault_Text">tz</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span>, <span class="ActionScriptDefault_Text">frame</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Frame</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tvertices</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span>;            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">char</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;                        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">num_frames</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>                <span class="ActionScriptDefault_Text">tvertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">fvertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Vector</span>.<span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">num_tris</span><span class="ActionScriptOperator">*</span>9, <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptDefault_Text">frame</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Frame</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;&quot;</span>, <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">)</span>;                <span class="ActionScriptDefault_Text">sx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">sy</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">sz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">tx</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">ty</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">()</span>;                <span class="ActionScriptDefault_Text">tz</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readFloat</span><span class="ActionScriptBracket/Brace">()</span>;                                <span class="ActionScriptComment">//read frame name</span>                <span class="ActionScriptDefault_Text">k</span> <span class="ActionScriptOperator">=</span> 0;                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> 16; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptDefault_Text">char</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readUnsignedByte</span><span class="ActionScriptBracket/Brace">()</span>;                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">char</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptDefault_Text">x30</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">char</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;=</span> 0<span class="ActionScriptDefault_Text">x7A</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">k</span> <span class="ActionScriptOperator">&lt;</span> 3<span class="ActionScriptBracket/Brace">)</span>                        <span class="ActionScriptDefault_Text">frame</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">+=</span> <span class="ActionScriptDefault_Text">String</span>.<span class="ActionScriptDefault_Text">fromCharCode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">char</span><span class="ActionScriptBracket/Brace">)</span>;                                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">char</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&gt;=</span> 0<span class="ActionScriptDefault_Text">x30</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">int</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">char</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&lt;=</span> 0<span class="ActionScriptDefault_Text">x39</span><span class="ActionScriptBracket/Brace">)</span>                        <span class="ActionScriptDefault_Text">k</span><span class="ActionScriptOperator">++</span>;                 <span class="ActionScriptBracket/Brace">}</span>                                <span class="ActionScriptComment">// Note, the extra data.position++ in the for loop is there </span>                <span class="ActionScriptComment">// to skip over a byte that holds the &quot;vertex normal index&quot;</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">num_vertices</span>; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span>, <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">position</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>                    <span class="ActionScriptDefault_Text">tvertices</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">sx</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readUnsignedByte</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tx</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sy</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readUnsignedByte</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ty</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span>, <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">sz</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readUnsignedByte</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">tz</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">*</span><span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptBracket/Brace">)</span>;                                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">num_tris</span><span class="ActionScriptOperator">*</span>3; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>                 <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span>;                    <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span>;                    <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">tvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">vertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span>;                                        <span class="ActionScriptComment">//collect min/max for 1 frame only</span>                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerMeshes</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span>                    <span class="ActionScriptBracket/Brace">{</span>                        <span class="ActionScriptDefault_Text">minX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">minX</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">minX</span>;                        <span class="ActionScriptDefault_Text">minY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">minY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">minY</span>;                        <span class="ActionScriptDefault_Text">minZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">minZ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">minZ</span>;                        <span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">maxX</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">maxX</span>;                        <span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">maxY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>1<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">maxY</span>;                        <span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptDefault_Text">maxZ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">?</span><span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptOperator">+</span>2<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">maxZ</span>;                    <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptBracket/Brace">}</span>                                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">centerMeshes</span><span class="ActionScriptBracket/Brace">)</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">=</span> 0; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">num_tris</span><span class="ActionScriptOperator">*</span>3; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>                 <span class="ActionScriptBracket/Brace">{</span>                    <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">maxX</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">minX</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;                    <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 1<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">maxY</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">minY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;                    <span class="ActionScriptDefault_Text">fvertices</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">*</span>3 <span class="ActionScriptOperator">+</span> 2<span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">-=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">maxZ</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">minZ</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">/</span>2;                <span class="ActionScriptBracket/Brace">}</span>                                <span class="ActionScriptDefault_Text">mesh</span>.<span class="ActionScriptDefault_Text">addFrame</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">frame</span><span class="ActionScriptBracket/Brace">)</span>;            <span class="ActionScriptBracket/Brace">}</span>                        <span class="ActionScriptDefault_Text">vertices</span>.<span class="ActionScriptDefault_Text">fixed</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;        <span class="ActionScriptBracket/Brace">}</span>        <span class="ActionScriptASDoc">/**         * Reads in all that MD2 Header data that is declared as private variables.         * I know its a lot, and it looks ugly, but only way to do it in Flash         */</span>        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">readMd2Header</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ByteArray</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">ident</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">version</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">skinwidth</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">skinheight</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">framesize</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">num_skins</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">num_vertices</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">num_st</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">num_tris</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">num_glcmds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">num_frames</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">offset_skins</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">offset_st</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">offset_tris</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">offset_frames</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">offset_glcmds</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;            <span class="ActionScriptDefault_Text">offset_end</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">readInt</span><span class="ActionScriptBracket/Brace">()</span>;        <span class="ActionScriptBracket/Brace">}</span>                <span class="ActionScriptASDoc">/**         * A scaling factor for all geometry in the model. Defaults to 1.         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">scaling</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptOperator">=</span> 1;                <span class="ActionScriptASDoc">/**         * Controls the automatic centering of geometry data in the model, improving culling and the accuracy of bounding dimension values.         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">centerMeshes</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;                <span class="ActionScriptASDoc">/**         * Creates a new &lt;code&gt;Md2&lt;/code&gt; object.         */</span>        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">MD2</span><span class="ActionScriptBracket/Brace">()</span>        <span class="ActionScriptBracket/Brace">{</span>            <span class="ActionScriptDefault_Text">mesh</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_container</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MovieMesh</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MovieMesh</span>;                        <span class="ActionScriptDefault_Text">binary</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">true</span>;        <span class="ActionScriptBracket/Brace">}</span>    <span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
